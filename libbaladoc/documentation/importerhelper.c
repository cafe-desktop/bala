/* importerhelper.c generated by balac, the Bala compiler
 * generated from importerhelper.bala, do not modify */

/* importhelper.bala
 *
 * Copyright (C) 2014 Florian Brosch
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 * Author:
 *  Florian Brosch <flo.brosch@gmail.com>
 */

#include "baladoc.h"
#include <stdlib.h>
#include <string.h>
#include <glib.h>
#include <balagee.h>
#include <glib-object.h>

#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _bala_iterable_unref0(var) ((var == NULL) ? NULL : (var = (bala_iterable_unref (var), NULL)))
#define _bala_iterator_unref0(var) ((var == NULL) ? NULL : (var = (bala_iterator_unref (var), NULL)))

G_GNUC_INTERNAL gchar* baladoc_importer_helper_resolve_parameter_ctype (BaladocApiTree* tree,
                                                        BaladocApiNode* element,
                                                        const gchar* parameter_name,
                                                        gchar* * param_name,
                                                        gchar* * param_array_name,
                                                        gboolean* is_return_type_len);
G_GNUC_INTERNAL gchar** baladoc_importer_helper_split_type_name (const gchar* id,
                                                 gint* result_length1);
G_GNUC_INTERNAL const gchar* baladoc_api_parameter_get_implicit_array_length_cparameter_name (BaladocApiParameter* self);
G_GNUC_INTERNAL const gchar* baladoc_api_callable_get_implicit_array_length_cparameter_name (BaladocApiCallable* self);
G_GNUC_INTERNAL void baladoc_importer_helper_extract_short_desc (BaladocContentComment* comment,
                                                 BaladocContentContentFactory* factory);
G_GNUC_INTERNAL BaladocContentParagraph* baladoc_importer_helper_split_paragraph (BaladocContentParagraph* p,
                                                                  BaladocContentContentFactory* factory);
G_GNUC_INTERNAL BaladocContentText* baladoc_importer_helper_split_text (BaladocContentText* text,
                                                        BaladocContentContentFactory* factory);
G_GNUC_INTERNAL BaladocContentRun* baladoc_importer_helper_split_run (BaladocContentRun* run,
                                                      BaladocContentContentFactory* factory);
G_GNUC_INTERNAL BaladocContentInline* baladoc_importer_helper_split_inline (BaladocContentInline* item,
                                                            BaladocContentContentFactory* factory);
static void _bala_array_destroy (gpointer array,
                          gint array_length,
                          GDestroyNotify destroy_func);
static void _bala_array_free (gpointer array,
                       gint array_length,
                       GDestroyNotify destroy_func);

static gpointer
_g_object_ref0 (gpointer self)
{
	return self ? g_object_ref (self) : NULL;
}

G_GNUC_INTERNAL gchar*
baladoc_importer_helper_resolve_parameter_ctype (BaladocApiTree* tree,
                                                 BaladocApiNode* element,
                                                 const gchar* parameter_name,
                                                 gchar* * param_name,
                                                 gchar* * param_array_name,
                                                 gboolean* is_return_type_len)
{
	gchar* _bala_param_name = NULL;
	gchar* _bala_param_array_name = NULL;
	gboolean _bala_is_return_type_len = FALSE;
	gchar** parts = NULL;
	gint _tmp0_ = 0;
	gchar** _tmp1_;
	gint parts_length1;
	gint _parts_size_;
	BaladocApiParameter* param = NULL;
	gboolean _tmp26_ = FALSE;
	gchar** _tmp31_;
	gint _tmp31__length1;
	BaladocApiItem* inner = NULL;
	gboolean _tmp33_ = FALSE;
	const gchar* _tmp34_;
	BaladocApiItem* _tmp57_;
	gchar* cname = NULL;
	BaladocApiItem* _tmp59_;
	gchar** _tmp71_;
	gint _tmp71__length1;
	gchar* _tmp72_;
	const gchar* _tmp73_;
	gchar* _tmp74_;
	gchar* _tmp75_;
	gchar** _tmp76_;
	gint _tmp76__length1;
	const gchar* _tmp77_;
	gchar* _tmp78_;
	gchar* _tmp79_;
	gchar** _tmp80_;
	gint _tmp80__length1;
	const gchar* _tmp81_;
	gchar* _tmp82_;
	gchar* _tmp83_;
	gchar* result = NULL;
	g_return_val_if_fail (tree != NULL, NULL);
	g_return_val_if_fail (element != NULL, NULL);
	g_return_val_if_fail (parameter_name != NULL, NULL);
	_tmp1_ = baladoc_importer_helper_split_type_name (parameter_name, &_tmp0_);
	parts = _tmp1_;
	parts_length1 = _tmp0_;
	_parts_size_ = parts_length1;
	_bala_is_return_type_len = FALSE;
	_g_free0 (_bala_param_array_name);
	_bala_param_array_name = NULL;
	param = NULL;
	{
		BalaList* _node_list = NULL;
		BalaList* _tmp2_;
		gint _node_size = 0;
		BalaList* _tmp3_;
		gint _tmp4_;
		gint _tmp5_;
		gint _node_index = 0;
		_tmp2_ = baladoc_api_node_get_children_by_type (element, BALADOC_API_NODE_TYPE_FORMAL_PARAMETER, FALSE);
		_node_list = _tmp2_;
		_tmp3_ = _node_list;
		_tmp4_ = bala_collection_get_size ((BalaCollection*) _tmp3_);
		_tmp5_ = _tmp4_;
		_node_size = _tmp5_;
		_node_index = -1;
		while (TRUE) {
			gint _tmp6_;
			gint _tmp7_;
			BaladocApiNode* node = NULL;
			BalaList* _tmp8_;
			gpointer _tmp9_;
			BaladocApiNode* _tmp10_;
			const gchar* _tmp11_;
			const gchar* _tmp12_;
			gchar** _tmp13_;
			gint _tmp13__length1;
			const gchar* _tmp14_;
			BaladocApiNode* _tmp17_;
			const gchar* _tmp18_;
			const gchar* _tmp19_;
			gchar** _tmp20_;
			gint _tmp20__length1;
			const gchar* _tmp21_;
			_node_index = _node_index + 1;
			_tmp6_ = _node_index;
			_tmp7_ = _node_size;
			if (!(_tmp6_ < _tmp7_)) {
				break;
			}
			_tmp8_ = _node_list;
			_tmp9_ = bala_list_get (_tmp8_, _node_index);
			node = (BaladocApiNode*) _tmp9_;
			_tmp10_ = node;
			_tmp11_ = baladoc_api_node_get_name (_tmp10_);
			_tmp12_ = _tmp11_;
			_tmp13_ = parts;
			_tmp13__length1 = parts_length1;
			_tmp14_ = _tmp13_[0];
			if (g_strcmp0 (_tmp12_, _tmp14_) == 0) {
				BaladocApiNode* _tmp15_;
				BaladocApiParameter* _tmp16_;
				_tmp15_ = node;
				_tmp16_ = _g_object_ref0 (BALADOC_API_IS_PARAMETER (_tmp15_) ? ((BaladocApiParameter*) _tmp15_) : NULL);
				_g_object_unref0 (param);
				param = _tmp16_;
				_g_object_unref0 (node);
				break;
			}
			_tmp17_ = node;
			_tmp18_ = baladoc_api_parameter_get_implicit_array_length_cparameter_name (G_TYPE_CHECK_INSTANCE_CAST (_tmp17_, BALADOC_API_TYPE_PARAMETER, BaladocApiParameter));
			_tmp19_ = _tmp18_;
			_tmp20_ = parts;
			_tmp20__length1 = parts_length1;
			_tmp21_ = _tmp20_[0];
			if (g_strcmp0 (_tmp19_, _tmp21_) == 0) {
				BaladocApiNode* _tmp22_;
				const gchar* _tmp23_;
				const gchar* _tmp24_;
				gchar* _tmp25_;
				_tmp22_ = node;
				_tmp23_ = baladoc_api_node_get_name ((BaladocApiNode*) G_TYPE_CHECK_INSTANCE_CAST (_tmp22_, BALADOC_API_TYPE_PARAMETER, BaladocApiParameter));
				_tmp24_ = _tmp23_;
				_tmp25_ = g_strdup (_tmp24_);
				_g_free0 (_bala_param_array_name);
				_bala_param_array_name = _tmp25_;
				_g_object_unref0 (node);
				break;
			}
			_g_object_unref0 (node);
		}
		_bala_iterable_unref0 (_node_list);
	}
	if (BALADOC_API_IS_CALLABLE (element)) {
		const gchar* _tmp27_;
		const gchar* _tmp28_;
		gchar** _tmp29_;
		gint _tmp29__length1;
		const gchar* _tmp30_;
		_tmp27_ = baladoc_api_callable_get_implicit_array_length_cparameter_name (G_TYPE_CHECK_INSTANCE_CAST (element, BALADOC_API_TYPE_CALLABLE, BaladocApiCallable));
		_tmp28_ = _tmp27_;
		_tmp29_ = parts;
		_tmp29__length1 = parts_length1;
		_tmp30_ = _tmp29_[0];
		_tmp26_ = g_strcmp0 (_tmp28_, _tmp30_) == 0;
	} else {
		_tmp26_ = FALSE;
	}
	if (_tmp26_) {
		_bala_is_return_type_len = TRUE;
	}
	_tmp31_ = parts;
	_tmp31__length1 = parts_length1;
	if (_tmp31__length1 == 1) {
		gchar* _tmp32_;
		_tmp32_ = g_strdup (parameter_name);
		_g_free0 (_bala_param_name);
		_bala_param_name = _tmp32_;
		result = NULL;
		_g_object_unref0 (param);
		parts = (_bala_array_free (parts, parts_length1, (GDestroyNotify) g_free), NULL);
		if (param_name) {
			*param_name = _bala_param_name;
		} else {
			_g_free0 (_bala_param_name);
		}
		if (param_array_name) {
			*param_array_name = _bala_param_array_name;
		} else {
			_g_free0 (_bala_param_array_name);
		}
		if (is_return_type_len) {
			*is_return_type_len = _bala_is_return_type_len;
		}
		return result;
	}
	inner = NULL;
	_tmp34_ = _bala_param_array_name;
	if (_tmp34_ != NULL) {
		_tmp33_ = TRUE;
	} else {
		_tmp33_ = _bala_is_return_type_len;
	}
	if (_tmp33_) {
		BaladocApiNode* _tmp35_;
		_tmp35_ = baladoc_api_tree_search_symbol_str (tree, NULL, "int");
		_g_object_unref0 (inner);
		inner = (BaladocApiItem*) _tmp35_;
	} else {
		BaladocApiParameter* _tmp36_;
		_tmp36_ = param;
		if (_tmp36_ != NULL) {
			BaladocApiParameter* _tmp37_;
			BaladocApiTypeReference* _tmp38_;
			BaladocApiTypeReference* _tmp39_;
			BaladocApiItem* _tmp40_;
			_tmp37_ = param;
			_tmp38_ = baladoc_api_parameter_get_parameter_type (_tmp37_);
			_tmp39_ = _tmp38_;
			_tmp40_ = _g_object_ref0 ((BaladocApiItem*) _tmp39_);
			_g_object_unref0 (inner);
			inner = _tmp40_;
		}
	}
	while (TRUE) {
		BaladocApiItem* _tmp41_;
		BaladocApiItem* _tmp42_;
		_tmp41_ = inner;
		if (!(_tmp41_ != NULL)) {
			break;
		}
		_tmp42_ = inner;
		if (BALADOC_API_IS_TYPEREFERENCE (_tmp42_)) {
			BaladocApiItem* _tmp43_;
			BaladocApiItem* _tmp44_;
			BaladocApiItem* _tmp45_;
			BaladocApiItem* _tmp46_;
			_tmp43_ = inner;
			_tmp44_ = baladoc_api_typereference_get_data_type (G_TYPE_CHECK_INSTANCE_CAST (_tmp43_, BALADOC_API_TYPE_TYPEREFERENCE, BaladocApiTypeReference));
			_tmp45_ = _tmp44_;
			_tmp46_ = _g_object_ref0 (_tmp45_);
			_g_object_unref0 (inner);
			inner = _tmp46_;
		} else {
			BaladocApiItem* _tmp47_;
			_tmp47_ = inner;
			if (BALADOC_API_IS_POINTER (_tmp47_)) {
				BaladocApiItem* _tmp48_;
				BaladocApiItem* _tmp49_;
				BaladocApiItem* _tmp50_;
				BaladocApiItem* _tmp51_;
				_tmp48_ = inner;
				_tmp49_ = baladoc_api_pointer_get_data_type (G_TYPE_CHECK_INSTANCE_CAST (_tmp48_, BALADOC_API_TYPE_POINTER, BaladocApiPointer));
				_tmp50_ = _tmp49_;
				_tmp51_ = _g_object_ref0 (_tmp50_);
				_g_object_unref0 (inner);
				inner = _tmp51_;
			} else {
				BaladocApiItem* _tmp52_;
				_tmp52_ = inner;
				if (BALADOC_API_IS_ARRAY (_tmp52_)) {
					BaladocApiItem* _tmp53_;
					BaladocApiItem* _tmp54_;
					BaladocApiItem* _tmp55_;
					BaladocApiItem* _tmp56_;
					_tmp53_ = inner;
					_tmp54_ = baladoc_api_array_get_data_type (G_TYPE_CHECK_INSTANCE_CAST (_tmp53_, BALADOC_API_TYPE_ARRAY, BaladocApiArray));
					_tmp55_ = _tmp54_;
					_tmp56_ = _g_object_ref0 (_tmp55_);
					_g_object_unref0 (inner);
					inner = _tmp56_;
				} else {
					break;
				}
			}
		}
	}
	_tmp57_ = inner;
	if (_tmp57_ == NULL) {
		gchar* _tmp58_;
		_tmp58_ = g_strdup (parameter_name);
		_g_free0 (_bala_param_name);
		_bala_param_name = _tmp58_;
		result = NULL;
		_g_object_unref0 (inner);
		_g_object_unref0 (param);
		parts = (_bala_array_free (parts, parts_length1, (GDestroyNotify) g_free), NULL);
		if (param_name) {
			*param_name = _bala_param_name;
		} else {
			_g_free0 (_bala_param_name);
		}
		if (param_array_name) {
			*param_array_name = _bala_param_array_name;
		} else {
			_g_free0 (_bala_param_array_name);
		}
		if (is_return_type_len) {
			*is_return_type_len = _bala_is_return_type_len;
		}
		return result;
	}
	cname = NULL;
	_tmp59_ = inner;
	if (BALADOC_API_IS_ERROR_DOMAIN (_tmp59_)) {
		BaladocApiItem* _tmp60_;
		gchar* _tmp61_;
		_tmp60_ = inner;
		_tmp61_ = baladoc_api_error_domain_get_cname (G_TYPE_CHECK_INSTANCE_CAST (_tmp60_, BALADOC_API_TYPE_ERROR_DOMAIN, BaladocApiErrorDomain));
		_g_free0 (cname);
		cname = _tmp61_;
	} else {
		BaladocApiItem* _tmp62_;
		_tmp62_ = inner;
		if (BALADOC_API_IS_STRUCT (_tmp62_)) {
			BaladocApiItem* _tmp63_;
			gchar* _tmp64_;
			_tmp63_ = inner;
			_tmp64_ = baladoc_api_struct_get_cname (G_TYPE_CHECK_INSTANCE_CAST (_tmp63_, BALADOC_API_TYPE_STRUCT, BaladocApiStruct));
			_g_free0 (cname);
			cname = _tmp64_;
		} else {
			BaladocApiItem* _tmp65_;
			_tmp65_ = inner;
			if (BALADOC_API_IS_CLASS (_tmp65_)) {
				BaladocApiItem* _tmp66_;
				gchar* _tmp67_;
				_tmp66_ = inner;
				_tmp67_ = baladoc_api_class_get_cname (G_TYPE_CHECK_INSTANCE_CAST (_tmp66_, BALADOC_API_TYPE_CLASS, BaladocApiClass));
				_g_free0 (cname);
				cname = _tmp67_;
			} else {
				BaladocApiItem* _tmp68_;
				_tmp68_ = inner;
				if (BALADOC_API_IS_ENUM (_tmp68_)) {
					BaladocApiItem* _tmp69_;
					gchar* _tmp70_;
					_tmp69_ = inner;
					_tmp70_ = baladoc_api_enum_get_cname (G_TYPE_CHECK_INSTANCE_CAST (_tmp69_, BALADOC_API_TYPE_ENUM, BaladocApiEnum));
					_g_free0 (cname);
					cname = _tmp70_;
				} else {
					g_assert_not_reached ();
				}
			}
		}
	}
	_tmp71_ = parts;
	_tmp71__length1 = parts_length1;
	_tmp72_ = _tmp71_[0];
	_tmp71_[0] = NULL;
	_g_free0 (_bala_param_name);
	_bala_param_name = _tmp72_;
	_tmp73_ = cname;
	_tmp74_ = g_strconcat ("c::", _tmp73_, NULL);
	_tmp75_ = _tmp74_;
	_tmp76_ = parts;
	_tmp76__length1 = parts_length1;
	_tmp77_ = _tmp76_[1];
	_tmp78_ = g_strconcat (_tmp75_, _tmp77_, NULL);
	_tmp79_ = _tmp78_;
	_tmp80_ = parts;
	_tmp80__length1 = parts_length1;
	_tmp81_ = _tmp80_[2];
	_tmp82_ = g_strconcat (_tmp79_, _tmp81_, NULL);
	_tmp83_ = _tmp82_;
	_g_free0 (_tmp79_);
	_g_free0 (_tmp75_);
	result = _tmp83_;
	_g_free0 (cname);
	_g_object_unref0 (inner);
	_g_object_unref0 (param);
	parts = (_bala_array_free (parts, parts_length1, (GDestroyNotify) g_free), NULL);
	if (param_name) {
		*param_name = _bala_param_name;
	} else {
		_g_free0 (_bala_param_name);
	}
	if (param_array_name) {
		*param_array_name = _bala_param_array_name;
	} else {
		_g_free0 (_bala_param_array_name);
	}
	if (is_return_type_len) {
		*is_return_type_len = _bala_is_return_type_len;
	}
	return result;
}

static gunichar
string_get_char (const gchar* self,
                 glong index)
{
	gunichar result = 0U;
	g_return_val_if_fail (self != NULL, 0U);
	result = g_utf8_get_char (((gchar*) self) + index);
	return result;
}

static glong
string_strnlen (gchar* str,
                glong maxlen)
{
	gchar* end = NULL;
	gchar* _tmp0_;
	gchar* _tmp1_;
	glong result = 0L;
	_tmp0_ = memchr (str, 0, (gsize) maxlen);
	end = _tmp0_;
	_tmp1_ = end;
	if (_tmp1_ == NULL) {
		result = maxlen;
		return result;
	} else {
		gchar* _tmp2_;
		_tmp2_ = end;
		result = (glong) (_tmp2_ - str);
		return result;
	}
}

static gchar*
string_substring (const gchar* self,
                  glong offset,
                  glong len)
{
	glong string_length = 0L;
	gboolean _tmp0_ = FALSE;
	gchar* _tmp3_;
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	if (offset >= ((glong) 0)) {
		_tmp0_ = len >= ((glong) 0);
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		string_length = string_strnlen ((gchar*) self, offset + len);
	} else {
		gint _tmp1_;
		gint _tmp2_;
		_tmp1_ = strlen (self);
		_tmp2_ = _tmp1_;
		string_length = (glong) _tmp2_;
	}
	if (offset < ((glong) 0)) {
		offset = string_length + offset;
		g_return_val_if_fail (offset >= ((glong) 0), NULL);
	} else {
		g_return_val_if_fail (offset <= string_length, NULL);
	}
	if (len < ((glong) 0)) {
		len = string_length - offset;
	}
	g_return_val_if_fail ((offset + len) <= string_length, NULL);
	_tmp3_ = g_strndup (((gchar*) self) + offset, (gsize) len);
	result = _tmp3_;
	return result;
}

G_GNUC_INTERNAL gchar**
baladoc_importer_helper_split_type_name (const gchar* id,
                                         gint* result_length1)
{
	gunichar c = 0U;
	gchar* _tmp33_;
	gchar** _tmp34_;
	gchar** _tmp35_;
	gint _tmp35__length1;
	gchar** result = NULL;
	g_return_val_if_fail (id != NULL, NULL);
	{
		const gchar* pos = NULL;
		pos = id;
		{
			gboolean _tmp0_ = FALSE;
			_tmp0_ = TRUE;
			while (TRUE) {
				const gchar* _tmp3_;
				if (!_tmp0_) {
					const gchar* _tmp1_;
					const gchar* _tmp2_;
					_tmp1_ = pos;
					_tmp2_ = g_utf8_next_char (_tmp1_);
					pos = _tmp2_;
				}
				_tmp0_ = FALSE;
				_tmp3_ = pos;
				c = string_get_char (_tmp3_, (glong) 0);
				if (!(c != ((gunichar) '\0'))) {
					break;
				}
				switch (c) {
					case '-':
					{
						const gchar* _tmp4_;
						gchar* _tmp5_;
						gchar* _tmp6_;
						const gchar* _tmp7_;
						gchar* _tmp8_;
						gchar** _tmp9_;
						gchar** _tmp10_;
						gint _tmp10__length1;
						_tmp4_ = pos;
						_tmp5_ = string_substring (id, (glong) 0, (glong) (((gchar*) _tmp4_) - ((gchar*) id)));
						_tmp6_ = g_strdup ("->");
						_tmp7_ = pos;
						_tmp8_ = g_strdup ((const gchar*) (((gchar*) _tmp7_) + 2));
						_tmp9_ = g_new0 (gchar*, 3 + 1);
						_tmp9_[0] = _tmp5_;
						_tmp9_[1] = _tmp6_;
						_tmp9_[2] = _tmp8_;
						_tmp10_ = _tmp9_;
						_tmp10__length1 = 3;
						if (result_length1) {
							*result_length1 = _tmp10__length1;
						}
						result = _tmp10_;
						return result;
					}
					case ':':
					{
						const gchar* _tmp11_ = NULL;
						const gchar* _tmp12_;
						const gchar* _tmp13_;
						gchar* sep = NULL;
						gchar* _tmp14_;
						const gchar* _tmp15_;
						gchar* _tmp16_;
						const gchar* _tmp17_;
						gchar* _tmp18_;
						const gchar* _tmp19_;
						const gchar* _tmp20_;
						gint _tmp21_;
						gint _tmp22_;
						gchar* _tmp23_;
						gchar** _tmp24_;
						gchar** _tmp25_;
						gint _tmp25__length1;
						_tmp12_ = pos;
						_tmp13_ = g_utf8_next_char (_tmp12_);
						if (string_get_char (_tmp13_, (glong) 0) == ((gunichar) ':')) {
							_tmp11_ = "::";
						} else {
							_tmp11_ = ":";
						}
						_tmp14_ = g_strdup (_tmp11_);
						sep = _tmp14_;
						_tmp15_ = pos;
						_tmp16_ = string_substring (id, (glong) 0, (glong) (((gchar*) _tmp15_) - ((gchar*) id)));
						_tmp17_ = sep;
						_tmp18_ = g_strdup (_tmp17_);
						_tmp19_ = pos;
						_tmp20_ = sep;
						_tmp21_ = strlen (_tmp20_);
						_tmp22_ = _tmp21_;
						_tmp23_ = g_strdup ((const gchar*) (((gchar*) _tmp19_) + _tmp22_));
						_tmp24_ = g_new0 (gchar*, 3 + 1);
						_tmp24_[0] = _tmp16_;
						_tmp24_[1] = _tmp18_;
						_tmp24_[2] = _tmp23_;
						_tmp25_ = _tmp24_;
						_tmp25__length1 = 3;
						if (result_length1) {
							*result_length1 = _tmp25__length1;
						}
						result = _tmp25_;
						_g_free0 (sep);
						return result;
					}
					case '.':
					{
						const gchar* _tmp26_;
						gchar* _tmp27_;
						gchar* _tmp28_;
						const gchar* _tmp29_;
						gchar* _tmp30_;
						gchar** _tmp31_;
						gchar** _tmp32_;
						gint _tmp32__length1;
						_tmp26_ = pos;
						_tmp27_ = string_substring (id, (glong) 0, (glong) (((gchar*) _tmp26_) - ((gchar*) id)));
						_tmp28_ = g_strdup (".");
						_tmp29_ = pos;
						_tmp30_ = g_strdup ((const gchar*) (((gchar*) _tmp29_) + 1));
						_tmp31_ = g_new0 (gchar*, 3 + 1);
						_tmp31_[0] = _tmp27_;
						_tmp31_[1] = _tmp28_;
						_tmp31_[2] = _tmp30_;
						_tmp32_ = _tmp31_;
						_tmp32__length1 = 3;
						if (result_length1) {
							*result_length1 = _tmp32__length1;
						}
						result = _tmp32_;
						return result;
					}
					default:
					break;
				}
			}
		}
	}
	_tmp33_ = g_strdup (id);
	_tmp34_ = g_new0 (gchar*, 1 + 1);
	_tmp34_[0] = _tmp33_;
	_tmp35_ = _tmp34_;
	_tmp35__length1 = 1;
	if (result_length1) {
		*result_length1 = _tmp35__length1;
	}
	result = _tmp35_;
	return result;
}

G_GNUC_INTERNAL void
baladoc_importer_helper_extract_short_desc (BaladocContentComment* comment,
                                            BaladocContentContentFactory* factory)
{
	BalaList* _tmp0_;
	BalaList* _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	BaladocContentParagraph* first_paragraph = NULL;
	BalaList* _tmp4_;
	BalaList* _tmp5_;
	gpointer _tmp6_;
	BaladocContentBlock* _tmp7_;
	BaladocContentParagraph* _tmp8_;
	BaladocContentParagraph* _tmp9_;
	BaladocContentParagraph* _tmp14_;
	BaladocContentParagraph* _tmp15_;
	BaladocContentParagraph* _tmp16_;
	BaladocContentParagraph* second_paragraph = NULL;
	BaladocContentParagraph* _tmp17_;
	BaladocContentParagraph* _tmp18_;
	BaladocContentParagraph* _tmp19_;
	BaladocContentParagraph* _tmp20_;
	g_return_if_fail (comment != NULL);
	g_return_if_fail (factory != NULL);
	_tmp0_ = baladoc_content_block_content_get_content ((BaladocContentBlockContent*) comment);
	_tmp1_ = _tmp0_;
	_tmp2_ = bala_collection_get_size ((BalaCollection*) _tmp1_);
	_tmp3_ = _tmp2_;
	if (_tmp3_ == 0) {
		return;
	}
	_tmp4_ = baladoc_content_block_content_get_content ((BaladocContentBlockContent*) comment);
	_tmp5_ = _tmp4_;
	_tmp6_ = bala_list_get (_tmp5_, 0);
	_tmp7_ = (BaladocContentBlock*) _tmp6_;
	_tmp8_ = BALADOC_CONTENT_IS_PARAGRAPH (_tmp7_) ? ((BaladocContentParagraph*) _tmp7_) : NULL;
	if (_tmp8_ == NULL) {
		_g_object_unref0 (_tmp7_);
	}
	first_paragraph = _tmp8_;
	_tmp9_ = first_paragraph;
	if (_tmp9_ == NULL) {
		BalaList* _tmp10_;
		BalaList* _tmp11_;
		BaladocContentParagraph* _tmp12_;
		BaladocContentParagraph* _tmp13_;
		_tmp10_ = baladoc_content_block_content_get_content ((BaladocContentBlockContent*) comment);
		_tmp11_ = _tmp10_;
		_tmp12_ = baladoc_content_content_factory_create_paragraph (factory);
		_tmp13_ = _tmp12_;
		bala_list_insert (_tmp11_, 1, (BaladocContentBlock*) _tmp13_);
		_g_object_unref0 (_tmp13_);
		_g_object_unref0 (first_paragraph);
		return;
	}
	_tmp14_ = first_paragraph;
	baladoc_content_style_attributes_set_horizontal_align ((BaladocContentStyleAttributes*) _tmp14_, BALADOC_CONTENT_HORIZONTAL_ALIGN_NONE);
	_tmp15_ = first_paragraph;
	baladoc_content_style_attributes_set_vertical_align ((BaladocContentStyleAttributes*) _tmp15_, BALADOC_CONTENT_VERTICAL_ALIGN_NONE);
	_tmp16_ = first_paragraph;
	baladoc_content_style_attributes_set_style ((BaladocContentStyleAttributes*) _tmp16_, NULL);
	_tmp17_ = first_paragraph;
	_tmp18_ = baladoc_importer_helper_split_paragraph (_tmp17_, factory);
	second_paragraph = _tmp18_;
	_tmp19_ = second_paragraph;
	if (_tmp19_ == NULL) {
		_g_object_unref0 (second_paragraph);
		_g_object_unref0 (first_paragraph);
		return;
	}
	_tmp20_ = second_paragraph;
	if (baladoc_content_content_element_is_empty ((BaladocContentContentElement*) _tmp20_) == FALSE) {
		BalaList* _tmp21_;
		BalaList* _tmp22_;
		BaladocContentParagraph* _tmp23_;
		_tmp21_ = baladoc_content_block_content_get_content ((BaladocContentBlockContent*) comment);
		_tmp22_ = _tmp21_;
		_tmp23_ = second_paragraph;
		bala_list_insert (_tmp22_, 1, (BaladocContentBlock*) _tmp23_);
	}
	_g_object_unref0 (second_paragraph);
	_g_object_unref0 (first_paragraph);
}

static gint
string_index_of_char (const gchar* self,
                      gunichar c,
                      gint start_index)
{
	gchar* _result_ = NULL;
	gchar* _tmp0_;
	gchar* _tmp1_;
	gint result = 0;
	g_return_val_if_fail (self != NULL, 0);
	_tmp0_ = g_utf8_strchr (((gchar*) self) + start_index, (gssize) -1, c);
	_result_ = _tmp0_;
	_tmp1_ = _result_;
	if (_tmp1_ != NULL) {
		gchar* _tmp2_;
		_tmp2_ = _result_;
		result = (gint) (_tmp2_ - ((gchar*) self));
		return result;
	} else {
		result = -1;
		return result;
	}
}

static gchar
string_get (const gchar* self,
            glong index)
{
	gchar _tmp0_;
	gchar result = '\0';
	g_return_val_if_fail (self != NULL, '\0');
	_tmp0_ = ((gchar*) self)[index];
	result = _tmp0_;
	return result;
}

G_GNUC_INTERNAL inline BaladocContentText*
baladoc_importer_helper_split_text (BaladocContentText* text,
                                    BaladocContentContentFactory* factory)
{
	gint offset = 0;
	BaladocContentText* result = NULL;
	g_return_val_if_fail (text != NULL, NULL);
	g_return_val_if_fail (factory != NULL, NULL);
	offset = 0;
	while (TRUE) {
		const gchar* _tmp0_;
		const gchar* _tmp1_;
		const gchar* cmp0 = NULL;
		const gchar* _tmp10_;
		const gchar* _tmp11_;
		const gchar* _tmp12_;
		const gchar* _tmp13_;
		BaladocContentText* sec = NULL;
		const gchar* _tmp14_;
		const gchar* _tmp15_;
		gchar* _tmp16_;
		gchar* _tmp17_;
		BaladocContentText* _tmp18_;
		BaladocContentText* _tmp19_;
		const gchar* _tmp20_;
		const gchar* _tmp21_;
		gchar* _tmp22_;
		gchar* _tmp23_;
		_tmp0_ = baladoc_content_text_get_content (text);
		_tmp1_ = _tmp0_;
		offset = string_index_of_char (_tmp1_, (gunichar) '.', offset);
		if (!(offset >= 0)) {
			break;
		}
		if (offset >= 2) {
			const gchar* cmp4 = NULL;
			const gchar* _tmp2_;
			const gchar* _tmp3_;
			gboolean _tmp4_ = FALSE;
			const gchar* _tmp5_;
			gboolean _tmp7_ = FALSE;
			const gchar* _tmp8_;
			_tmp2_ = baladoc_content_text_get_content (text);
			_tmp3_ = _tmp2_;
			cmp4 = (const gchar*) ((((gchar*) _tmp3_) + offset) - 2);
			_tmp5_ = cmp4;
			if (g_str_has_prefix (_tmp5_, " e.g.")) {
				_tmp4_ = TRUE;
			} else {
				const gchar* _tmp6_;
				_tmp6_ = cmp4;
				_tmp4_ = g_str_has_prefix (_tmp6_, "(e.g.");
			}
			if (_tmp4_) {
				offset = offset + 3;
				continue;
			}
			_tmp8_ = cmp4;
			if (g_str_has_prefix (_tmp8_, " i.e.")) {
				_tmp7_ = TRUE;
			} else {
				const gchar* _tmp9_;
				_tmp9_ = cmp4;
				_tmp7_ = g_str_has_prefix (_tmp9_, "(i.e.");
			}
			if (_tmp7_) {
				offset = offset + 3;
				continue;
			}
		}
		_tmp10_ = baladoc_content_text_get_content (text);
		_tmp11_ = _tmp10_;
		cmp0 = (const gchar*) (((gchar*) _tmp11_) + offset);
		_tmp12_ = cmp0;
		if (g_str_has_prefix (_tmp12_, "...")) {
			offset = offset + 3;
			continue;
		}
		_tmp13_ = cmp0;
		if (g_ascii_isdigit (string_get (_tmp13_, (glong) 1))) {
			offset = offset + 2;
			continue;
		}
		_tmp14_ = baladoc_content_text_get_content (text);
		_tmp15_ = _tmp14_;
		_tmp16_ = string_substring (_tmp15_, (glong) (offset + 1), (glong) -1);
		_tmp17_ = _tmp16_;
		_tmp18_ = baladoc_content_content_factory_create_text (factory, _tmp17_);
		_tmp19_ = _tmp18_;
		_g_free0 (_tmp17_);
		sec = _tmp19_;
		_tmp20_ = baladoc_content_text_get_content (text);
		_tmp21_ = _tmp20_;
		_tmp22_ = string_substring (_tmp21_, (glong) 0, (glong) (offset + 1));
		_tmp23_ = _tmp22_;
		baladoc_content_text_set_content (text, _tmp23_);
		_g_free0 (_tmp23_);
		result = sec;
		return result;
	}
	result = NULL;
	return result;
}

G_GNUC_INTERNAL inline BaladocContentRun*
baladoc_importer_helper_split_run (BaladocContentRun* run,
                                   BaladocContentContentFactory* factory)
{
	BaladocContentRunStyle _tmp0_;
	BaladocContentRunStyle _tmp1_;
	BaladocContentRun* sec = NULL;
	BalaIterator* iter = NULL;
	BalaList* _tmp2_;
	BalaList* _tmp3_;
	BalaIterator* _tmp4_;
	BaladocContentRun* result = NULL;
	g_return_val_if_fail (run != NULL, NULL);
	g_return_val_if_fail (factory != NULL, NULL);
	_tmp0_ = baladoc_content_run_get_style (run);
	_tmp1_ = _tmp0_;
	if (_tmp1_ != BALADOC_CONTENT_RUN_STYLE_NONE) {
		result = NULL;
		return result;
	}
	sec = NULL;
	_tmp2_ = baladoc_content_inline_content_get_content ((BaladocContentInlineContent*) run);
	_tmp3_ = _tmp2_;
	_tmp4_ = bala_iterable_iterator ((BalaIterable*) _tmp3_);
	iter = _tmp4_;
	{
		gboolean has_next = FALSE;
		BalaIterator* _tmp5_;
		_tmp5_ = iter;
		has_next = bala_iterator_next (_tmp5_);
		{
			gboolean _tmp6_ = FALSE;
			_tmp6_ = TRUE;
			while (TRUE) {
				BaladocContentInline* item = NULL;
				BalaIterator* _tmp8_;
				gpointer _tmp9_;
				BaladocContentRun* _tmp10_;
				if (!_tmp6_) {
					BalaIterator* _tmp7_;
					_tmp7_ = iter;
					has_next = bala_iterator_next (_tmp7_);
				}
				_tmp6_ = FALSE;
				if (!has_next) {
					break;
				}
				_tmp8_ = iter;
				_tmp9_ = bala_iterator_get (_tmp8_);
				item = (BaladocContentInline*) _tmp9_;
				_tmp10_ = sec;
				if (_tmp10_ == NULL) {
					BaladocContentInline* tmp = NULL;
					BaladocContentInline* _tmp11_;
					BaladocContentInline* _tmp12_;
					BaladocContentInline* _tmp13_;
					_tmp11_ = item;
					_tmp12_ = baladoc_importer_helper_split_inline (_tmp11_, factory);
					tmp = _tmp12_;
					_tmp13_ = tmp;
					if (_tmp13_ != NULL) {
						BaladocContentRunStyle _tmp14_;
						BaladocContentRunStyle _tmp15_;
						BaladocContentRun* _tmp16_;
						BaladocContentRun* _tmp17_;
						BalaList* _tmp18_;
						BalaList* _tmp19_;
						BaladocContentInline* _tmp20_;
						_tmp14_ = baladoc_content_run_get_style (run);
						_tmp15_ = _tmp14_;
						_tmp16_ = baladoc_content_content_factory_create_run (factory, _tmp15_);
						_g_object_unref0 (sec);
						sec = _tmp16_;
						_tmp17_ = sec;
						_tmp18_ = baladoc_content_inline_content_get_content ((BaladocContentInlineContent*) _tmp17_);
						_tmp19_ = _tmp18_;
						_tmp20_ = tmp;
						bala_collection_add ((BalaCollection*) _tmp19_, _tmp20_);
					}
					_g_object_unref0 (tmp);
				} else {
					BaladocContentRun* _tmp21_;
					BalaList* _tmp22_;
					BalaList* _tmp23_;
					BaladocContentInline* _tmp24_;
					BalaIterator* _tmp25_;
					_tmp21_ = sec;
					_tmp22_ = baladoc_content_inline_content_get_content ((BaladocContentInlineContent*) _tmp21_);
					_tmp23_ = _tmp22_;
					_tmp24_ = item;
					bala_collection_add ((BalaCollection*) _tmp23_, _tmp24_);
					_tmp25_ = iter;
					bala_iterator_remove (_tmp25_);
				}
				_g_object_unref0 (item);
			}
		}
	}
	result = sec;
	_bala_iterator_unref0 (iter);
	return result;
}

G_GNUC_INTERNAL inline BaladocContentInline*
baladoc_importer_helper_split_inline (BaladocContentInline* item,
                                      BaladocContentContentFactory* factory)
{
	BaladocContentInline* result = NULL;
	g_return_val_if_fail (item != NULL, NULL);
	g_return_val_if_fail (factory != NULL, NULL);
	if (BALADOC_CONTENT_IS_TEXT (item)) {
		BaladocContentText* _tmp0_;
		_tmp0_ = baladoc_importer_helper_split_text (G_TYPE_CHECK_INSTANCE_CAST (item, BALADOC_CONTENT_TYPE_TEXT, BaladocContentText), factory);
		result = (BaladocContentInline*) _tmp0_;
		return result;
	} else {
		if (BALADOC_CONTENT_IS_RUN (item)) {
			BaladocContentRun* _tmp1_;
			_tmp1_ = baladoc_importer_helper_split_run (G_TYPE_CHECK_INSTANCE_CAST (item, BALADOC_CONTENT_TYPE_RUN, BaladocContentRun), factory);
			result = (BaladocContentInline*) _tmp1_;
			return result;
		}
	}
	result = NULL;
	return result;
}

G_GNUC_INTERNAL inline BaladocContentParagraph*
baladoc_importer_helper_split_paragraph (BaladocContentParagraph* p,
                                         BaladocContentContentFactory* factory)
{
	BaladocContentParagraph* sec = NULL;
	BalaIterator* iter = NULL;
	BalaList* _tmp0_;
	BalaList* _tmp1_;
	BalaIterator* _tmp2_;
	BaladocContentParagraph* result = NULL;
	g_return_val_if_fail (p != NULL, NULL);
	g_return_val_if_fail (factory != NULL, NULL);
	sec = NULL;
	_tmp0_ = baladoc_content_inline_content_get_content ((BaladocContentInlineContent*) p);
	_tmp1_ = _tmp0_;
	_tmp2_ = bala_iterable_iterator ((BalaIterable*) _tmp1_);
	iter = _tmp2_;
	{
		gboolean has_next = FALSE;
		BalaIterator* _tmp3_;
		_tmp3_ = iter;
		has_next = bala_iterator_next (_tmp3_);
		{
			gboolean _tmp4_ = FALSE;
			_tmp4_ = TRUE;
			while (TRUE) {
				BaladocContentInline* item = NULL;
				BalaIterator* _tmp6_;
				gpointer _tmp7_;
				BaladocContentParagraph* _tmp8_;
				if (!_tmp4_) {
					BalaIterator* _tmp5_;
					_tmp5_ = iter;
					has_next = bala_iterator_next (_tmp5_);
				}
				_tmp4_ = FALSE;
				if (!has_next) {
					break;
				}
				_tmp6_ = iter;
				_tmp7_ = bala_iterator_get (_tmp6_);
				item = (BaladocContentInline*) _tmp7_;
				_tmp8_ = sec;
				if (_tmp8_ == NULL) {
					BaladocContentInline* tmp = NULL;
					BaladocContentInline* _tmp9_;
					BaladocContentInline* _tmp10_;
					BaladocContentInline* _tmp11_;
					_tmp9_ = item;
					_tmp10_ = baladoc_importer_helper_split_inline (_tmp9_, factory);
					tmp = _tmp10_;
					_tmp11_ = tmp;
					if (_tmp11_ != NULL) {
						BaladocContentParagraph* _tmp12_;
						BaladocContentParagraph* _tmp13_;
						BaladocContentHorizontalAlign _tmp14_;
						BaladocContentHorizontalAlign _tmp15_;
						BaladocContentParagraph* _tmp16_;
						BaladocContentVerticalAlign _tmp17_;
						BaladocContentVerticalAlign _tmp18_;
						BaladocContentParagraph* _tmp19_;
						const gchar* _tmp20_;
						const gchar* _tmp21_;
						BaladocContentParagraph* _tmp22_;
						BalaList* _tmp23_;
						BalaList* _tmp24_;
						BaladocContentInline* _tmp25_;
						_tmp12_ = baladoc_content_content_factory_create_paragraph (factory);
						_g_object_unref0 (sec);
						sec = _tmp12_;
						_tmp13_ = sec;
						_tmp14_ = baladoc_content_style_attributes_get_horizontal_align ((BaladocContentStyleAttributes*) p);
						_tmp15_ = _tmp14_;
						baladoc_content_style_attributes_set_horizontal_align ((BaladocContentStyleAttributes*) _tmp13_, _tmp15_);
						_tmp16_ = sec;
						_tmp17_ = baladoc_content_style_attributes_get_vertical_align ((BaladocContentStyleAttributes*) p);
						_tmp18_ = _tmp17_;
						baladoc_content_style_attributes_set_vertical_align ((BaladocContentStyleAttributes*) _tmp16_, _tmp18_);
						_tmp19_ = sec;
						_tmp20_ = baladoc_content_style_attributes_get_style ((BaladocContentStyleAttributes*) p);
						_tmp21_ = _tmp20_;
						baladoc_content_style_attributes_set_style ((BaladocContentStyleAttributes*) _tmp19_, _tmp21_);
						_tmp22_ = sec;
						_tmp23_ = baladoc_content_inline_content_get_content ((BaladocContentInlineContent*) _tmp22_);
						_tmp24_ = _tmp23_;
						_tmp25_ = tmp;
						bala_collection_add ((BalaCollection*) _tmp24_, _tmp25_);
					}
					_g_object_unref0 (tmp);
				} else {
					BaladocContentParagraph* _tmp26_;
					BalaList* _tmp27_;
					BalaList* _tmp28_;
					BaladocContentInline* _tmp29_;
					BalaIterator* _tmp30_;
					_tmp26_ = sec;
					_tmp27_ = baladoc_content_inline_content_get_content ((BaladocContentInlineContent*) _tmp26_);
					_tmp28_ = _tmp27_;
					_tmp29_ = item;
					bala_collection_add ((BalaCollection*) _tmp28_, _tmp29_);
					_tmp30_ = iter;
					bala_iterator_remove (_tmp30_);
				}
				_g_object_unref0 (item);
			}
		}
	}
	result = sec;
	_bala_iterator_unref0 (iter);
	return result;
}

static void
_bala_array_destroy (gpointer array,
                     gint array_length,
                     GDestroyNotify destroy_func)
{
	if ((array != NULL) && (destroy_func != NULL)) {
		gint i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}

static void
_bala_array_free (gpointer array,
                  gint array_length,
                  GDestroyNotify destroy_func)
{
	_bala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}

