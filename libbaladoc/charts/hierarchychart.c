/* hierarchychart.c generated by balac, the Bala compiler
 * generated from hierarchychart.bala, do not modify */

/* hierarchychart.bala
 *
 * Copyright (C) 2008  Florian Brosch
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 * Author:
 * 	Florian Brosch <flo.brosch@gmail.com>
 */

#include "baladoc.h"
#include <glib.h>
#include <graphviz/gvc.h>
#include <balagee.h>
#include <glib-object.h>

enum  {
	BALADOC_CHARTS_HIERARCHY_0_PROPERTY,
	BALADOC_CHARTS_HIERARCHY_NUM_PROPERTIES
};
static GParamSpec* baladoc_charts_hierarchy_properties[BALADOC_CHARTS_HIERARCHY_NUM_PROPERTIES];
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _bala_iterator_unref0(var) ((var == NULL) ? NULL : (var = (bala_iterator_unref (var), NULL)))
#define _bala_iterable_unref0(var) ((var == NULL) ? NULL : (var = (bala_iterable_unref (var), NULL)))

static gpointer baladoc_charts_hierarchy_parent_class = NULL;

static void baladoc_charts_hierarchy_draw_implemented_interfaces (BaladocChartsHierarchy* self,
                                                           Agnode_t* child,
                                                           BalaCollection* interfaces);
static void baladoc_charts_hierarchy_draw_parent_classes (BaladocChartsHierarchy* self,
                                                   BaladocApiClass* item,
                                                   Agnode_t* child);
static void baladoc_charts_hierarchy_draw_parent_structs (BaladocChartsHierarchy* self,
                                                   BaladocApiStruct* item,
                                                   Agnode_t* child);
static void baladoc_charts_hierarchy_real_visit_interface (BaladocApiVisitor* base,
                                                    BaladocApiInterface* item);
static void baladoc_charts_hierarchy_real_visit_class (BaladocApiVisitor* base,
                                                BaladocApiClass* item);
static void baladoc_charts_hierarchy_real_visit_struct (BaladocApiVisitor* base,
                                                 BaladocApiStruct* item);
static GType baladoc_charts_hierarchy_get_type_once (void);

BaladocChartsHierarchy*
baladoc_charts_hierarchy_construct (GType object_type,
                                    BaladocChartsFactory* factory,
                                    BaladocApiNode* node)
{
	BaladocChartsHierarchy * self = NULL;
	g_return_val_if_fail (factory != NULL, NULL);
	g_return_val_if_fail (node != NULL, NULL);
	self = (BaladocChartsHierarchy*) baladoc_charts_chart_construct (object_type, factory, node);
	return self;
}

BaladocChartsHierarchy*
baladoc_charts_hierarchy_new (BaladocChartsFactory* factory,
                              BaladocApiNode* node)
{
	return baladoc_charts_hierarchy_construct (BALADOC_CHARTS_TYPE_HIERARCHY, factory, node);
}

static void
baladoc_charts_hierarchy_draw_implemented_interfaces (BaladocChartsHierarchy* self,
                                                      Agnode_t* child,
                                                      BalaCollection* interfaces)
{
	g_return_if_fail (self != NULL);
	g_return_if_fail (child != NULL);
	g_return_if_fail (interfaces != NULL);
	{
		BalaIterator* _typeref_it = NULL;
		BalaIterator* _tmp0_;
		_tmp0_ = bala_iterable_iterator ((BalaIterable*) interfaces);
		_typeref_it = _tmp0_;
		while (TRUE) {
			BalaIterator* _tmp1_;
			BaladocApiTypeReference* typeref = NULL;
			BalaIterator* _tmp2_;
			gpointer _tmp3_;
			Agnode_t* parent = NULL;
			BaladocChartsFactory* _tmp4_;
			Agraph_t* _tmp5_;
			BaladocApiTypeReference* _tmp6_;
			BaladocApiItem* _tmp7_;
			BaladocApiItem* _tmp8_;
			Agnode_t* _tmp9_;
			BaladocChartsFactory* _tmp10_;
			Agraph_t* _tmp11_;
			Agnode_t* _tmp12_;
			Agedge_t* _tmp13_;
			_tmp1_ = _typeref_it;
			if (!bala_iterator_next (_tmp1_)) {
				break;
			}
			_tmp2_ = _typeref_it;
			_tmp3_ = bala_iterator_get (_tmp2_);
			typeref = (BaladocApiTypeReference*) _tmp3_;
			_tmp4_ = ((BaladocChartsChart*) self)->factory;
			_tmp5_ = ((BaladocChartsChart*) self)->graph;
			_tmp6_ = typeref;
			_tmp7_ = baladoc_api_typereference_get_data_type (_tmp6_);
			_tmp8_ = _tmp7_;
			_tmp9_ = baladoc_charts_factory_create_interface (_tmp4_, _tmp5_, G_TYPE_CHECK_INSTANCE_CAST (_tmp8_, BALADOC_API_TYPE_INTERFACE, BaladocApiInterface));
			parent = _tmp9_;
			_tmp10_ = ((BaladocChartsChart*) self)->factory;
			_tmp11_ = ((BaladocChartsChart*) self)->graph;
			_tmp12_ = parent;
			_tmp13_ = baladoc_charts_factory_add_children (_tmp10_, _tmp11_, _tmp12_, child);
			_g_object_unref0 (typeref);
		}
		_bala_iterator_unref0 (_typeref_it);
	}
}

static void
baladoc_charts_hierarchy_draw_parent_classes (BaladocChartsHierarchy* self,
                                              BaladocApiClass* item,
                                              Agnode_t* child)
{
	Agnode_t* parent = NULL;
	BaladocChartsFactory* _tmp0_;
	Agraph_t* _tmp1_;
	Agnode_t* _tmp2_;
	BaladocApiTypeReference* _tmp7_;
	BaladocApiTypeReference* _tmp8_;
	Agnode_t* _tmp14_;
	BalaCollection* _tmp15_;
	BalaCollection* _tmp16_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (item != NULL);
	_tmp0_ = ((BaladocChartsChart*) self)->factory;
	_tmp1_ = ((BaladocChartsChart*) self)->graph;
	_tmp2_ = baladoc_charts_factory_create_class (_tmp0_, _tmp1_, item);
	parent = _tmp2_;
	if (child != NULL) {
		BaladocChartsFactory* _tmp3_;
		Agraph_t* _tmp4_;
		Agnode_t* _tmp5_;
		Agedge_t* _tmp6_;
		_tmp3_ = ((BaladocChartsChart*) self)->factory;
		_tmp4_ = ((BaladocChartsChart*) self)->graph;
		_tmp5_ = parent;
		_tmp6_ = baladoc_charts_factory_add_children (_tmp3_, _tmp4_, _tmp5_, child);
	}
	_tmp7_ = baladoc_api_class_get_base_type (item);
	_tmp8_ = _tmp7_;
	if (_tmp8_ != NULL) {
		BaladocApiTypeReference* _tmp9_;
		BaladocApiTypeReference* _tmp10_;
		BaladocApiItem* _tmp11_;
		BaladocApiItem* _tmp12_;
		Agnode_t* _tmp13_;
		_tmp9_ = baladoc_api_class_get_base_type (item);
		_tmp10_ = _tmp9_;
		_tmp11_ = baladoc_api_typereference_get_data_type (_tmp10_);
		_tmp12_ = _tmp11_;
		_tmp13_ = parent;
		baladoc_charts_hierarchy_draw_parent_classes (self, G_TYPE_CHECK_INSTANCE_CAST (_tmp12_, BALADOC_API_TYPE_CLASS, BaladocApiClass), _tmp13_);
	}
	_tmp14_ = parent;
	_tmp15_ = baladoc_api_class_get_implemented_interface_list (item);
	_tmp16_ = _tmp15_;
	baladoc_charts_hierarchy_draw_implemented_interfaces (self, _tmp14_, _tmp16_);
	_bala_iterable_unref0 (_tmp16_);
}

static void
baladoc_charts_hierarchy_draw_parent_structs (BaladocChartsHierarchy* self,
                                              BaladocApiStruct* item,
                                              Agnode_t* child)
{
	Agnode_t* parent = NULL;
	BaladocChartsFactory* _tmp0_;
	Agraph_t* _tmp1_;
	Agnode_t* _tmp2_;
	BaladocApiTypeReference* _tmp7_;
	BaladocApiTypeReference* _tmp8_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (item != NULL);
	_tmp0_ = ((BaladocChartsChart*) self)->factory;
	_tmp1_ = ((BaladocChartsChart*) self)->graph;
	_tmp2_ = baladoc_charts_factory_create_struct (_tmp0_, _tmp1_, item);
	parent = _tmp2_;
	if (child != NULL) {
		BaladocChartsFactory* _tmp3_;
		Agraph_t* _tmp4_;
		Agnode_t* _tmp5_;
		Agedge_t* _tmp6_;
		_tmp3_ = ((BaladocChartsChart*) self)->factory;
		_tmp4_ = ((BaladocChartsChart*) self)->graph;
		_tmp5_ = parent;
		_tmp6_ = baladoc_charts_factory_add_children (_tmp3_, _tmp4_, _tmp5_, child);
	}
	_tmp7_ = baladoc_api_struct_get_base_type (item);
	_tmp8_ = _tmp7_;
	if (_tmp8_ != NULL) {
		BaladocApiTypeReference* _tmp9_;
		BaladocApiTypeReference* _tmp10_;
		BaladocApiItem* _tmp11_;
		BaladocApiItem* _tmp12_;
		Agnode_t* _tmp13_;
		_tmp9_ = baladoc_api_struct_get_base_type (item);
		_tmp10_ = _tmp9_;
		_tmp11_ = baladoc_api_typereference_get_data_type (_tmp10_);
		_tmp12_ = _tmp11_;
		_tmp13_ = parent;
		baladoc_charts_hierarchy_draw_parent_structs (self, G_TYPE_CHECK_INSTANCE_CAST (_tmp12_, BALADOC_API_TYPE_STRUCT, BaladocApiStruct), _tmp13_);
	}
}

static void
baladoc_charts_hierarchy_real_visit_interface (BaladocApiVisitor* base,
                                               BaladocApiInterface* item)
{
	BaladocChartsHierarchy * self;
	Agnode_t* iface = NULL;
	BaladocChartsFactory* _tmp0_;
	Agraph_t* _tmp1_;
	Agnode_t* _tmp2_;
	BaladocApiTypeReference* _tmp3_;
	BaladocApiTypeReference* _tmp4_;
	Agnode_t* _tmp10_;
	BalaCollection* _tmp11_;
	BalaCollection* _tmp12_;
	self = (BaladocChartsHierarchy*) base;
	g_return_if_fail (item != NULL);
	_tmp0_ = ((BaladocChartsChart*) self)->factory;
	_tmp1_ = ((BaladocChartsChart*) self)->graph;
	_tmp2_ = baladoc_charts_factory_create_interface (_tmp0_, _tmp1_, item);
	iface = _tmp2_;
	_tmp3_ = baladoc_api_interface_get_base_type (item);
	_tmp4_ = _tmp3_;
	if (_tmp4_ != NULL) {
		BaladocApiTypeReference* _tmp5_;
		BaladocApiTypeReference* _tmp6_;
		BaladocApiItem* _tmp7_;
		BaladocApiItem* _tmp8_;
		Agnode_t* _tmp9_;
		_tmp5_ = baladoc_api_interface_get_base_type (item);
		_tmp6_ = _tmp5_;
		_tmp7_ = baladoc_api_typereference_get_data_type (_tmp6_);
		_tmp8_ = _tmp7_;
		_tmp9_ = iface;
		baladoc_charts_hierarchy_draw_parent_classes (self, G_TYPE_CHECK_INSTANCE_CAST (_tmp8_, BALADOC_API_TYPE_CLASS, BaladocApiClass), _tmp9_);
	}
	_tmp10_ = iface;
	_tmp11_ = baladoc_api_interface_get_implemented_interface_list (item);
	_tmp12_ = _tmp11_;
	baladoc_charts_hierarchy_draw_implemented_interfaces (self, _tmp10_, _tmp12_);
	_bala_iterable_unref0 (_tmp12_);
}

static void
baladoc_charts_hierarchy_real_visit_class (BaladocApiVisitor* base,
                                           BaladocApiClass* item)
{
	BaladocChartsHierarchy * self;
	self = (BaladocChartsHierarchy*) base;
	g_return_if_fail (item != NULL);
	baladoc_charts_hierarchy_draw_parent_classes (self, item, NULL);
}

static void
baladoc_charts_hierarchy_real_visit_struct (BaladocApiVisitor* base,
                                            BaladocApiStruct* item)
{
	BaladocChartsHierarchy * self;
	self = (BaladocChartsHierarchy*) base;
	g_return_if_fail (item != NULL);
	baladoc_charts_hierarchy_draw_parent_structs (self, item, NULL);
}

static void
baladoc_charts_hierarchy_class_init (BaladocChartsHierarchyClass * klass,
                                     gpointer klass_data)
{
	baladoc_charts_hierarchy_parent_class = g_type_class_peek_parent (klass);
	((BaladocApiVisitorClass *) klass)->visit_interface = (void (*) (BaladocApiVisitor*, BaladocApiInterface*)) baladoc_charts_hierarchy_real_visit_interface;
	((BaladocApiVisitorClass *) klass)->visit_class = (void (*) (BaladocApiVisitor*, BaladocApiClass*)) baladoc_charts_hierarchy_real_visit_class;
	((BaladocApiVisitorClass *) klass)->visit_struct = (void (*) (BaladocApiVisitor*, BaladocApiStruct*)) baladoc_charts_hierarchy_real_visit_struct;
}

static void
baladoc_charts_hierarchy_instance_init (BaladocChartsHierarchy * self,
                                        gpointer klass)
{
}

static GType
baladoc_charts_hierarchy_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (BaladocChartsHierarchyClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) baladoc_charts_hierarchy_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (BaladocChartsHierarchy), 0, (GInstanceInitFunc) baladoc_charts_hierarchy_instance_init, NULL };
	GType baladoc_charts_hierarchy_type_id;
	baladoc_charts_hierarchy_type_id = g_type_register_static (BALADOC_CHARTS_TYPE_CHART, "BaladocChartsHierarchy", &g_define_type_info, 0);
	return baladoc_charts_hierarchy_type_id;
}

GType
baladoc_charts_hierarchy_get_type (void)
{
	static volatile gsize baladoc_charts_hierarchy_type_id__volatile = 0;
	if (g_once_init_enter (&baladoc_charts_hierarchy_type_id__volatile)) {
		GType baladoc_charts_hierarchy_type_id;
		baladoc_charts_hierarchy_type_id = baladoc_charts_hierarchy_get_type_once ();
		g_once_init_leave (&baladoc_charts_hierarchy_type_id__volatile, baladoc_charts_hierarchy_type_id);
	}
	return baladoc_charts_hierarchy_type_id__volatile;
}

