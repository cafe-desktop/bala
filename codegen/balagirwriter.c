/* balagirwriter.c generated by balac, the Bala compiler
 * generated from balagirwriter.bala, do not modify */

/* balagirwriter.bala
 *
 * Copyright (C) 2008-2012  Jürg Billeter
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.

 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.

 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 * Author:
 * 	Jürg Billeter <j@bitron.ch>
 */

#include "balacodegen.h"
#include <bala.h>
#include <stdlib.h>
#include <string.h>
#include <glib.h>
#include <stdio.h>
#include <balagee.h>
#include <glib-object.h>
#include <glib/gstdio.h>

#define BALA_GIR_WRITER_TYPE_GIR_NAMESPACE (bala_gir_writer_gir_namespace_get_type ())
typedef struct _BalaGIRWriterGIRNamespace BalaGIRWriterGIRNamespace;
#define _bala_code_context_unref0(var) ((var == NULL) ? NULL : (var = (bala_code_context_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_string_free0(var) ((var == NULL) ? NULL : (var = (g_string_free (var, TRUE), NULL)))
#define _fclose0(var) ((var == NULL) ? NULL : (var = (fclose (var), NULL)))
#define _bala_iterable_unref0(var) ((var == NULL) ? NULL : (var = (bala_iterable_unref (var), NULL)))
#define _bala_code_node_unref0(var) ((var == NULL) ? NULL : (var = (bala_code_node_unref (var), NULL)))
#define _bala_gir_writer_gir_namespace_free0(var) ((var == NULL) ? NULL : (var = (bala_gir_writer_gir_namespace_free (var), NULL)))
#define _bala_source_file_unref0(var) ((var == NULL) ? NULL : (var = (bala_source_file_unref (var), NULL)))
#define _g_mapped_file_unref0(var) ((var == NULL) ? NULL : (var = (g_mapped_file_unref (var), NULL)))
#define _bala_iterator_unref0(var) ((var == NULL) ? NULL : (var = (bala_iterator_unref (var), NULL)))

struct _BalaGIRWriterGIRNamespace {
	gchar* ns;
	gchar* version;
};

struct _BalaGIRWriterPrivate {
	BalaCodeContext* context;
	gchar* directory;
	gchar* gir_namespace;
	gchar* gir_version;
	gchar* gir_shared_library;
	GString* buffer;
	FILE* stream;
	BalaHashSet* unannotated_namespaces;
	BalaHashSet* our_namespaces;
	BalaArrayList* hierarchy;
	BalaArrayList* deferred;
	gint indent;
	BalaTypeSymbol* gobject_type;
	BalaTypeSymbol* ginitiallyunowned_type;
	BalaTypeSymbol* gtypeinterface_type;
	BalaTypeSymbol* gtypeinstance_type;
	BalaTypeSymbol* gtype_type;
	BalaArrayList* externals;
	gint enum_value;
};

static gint BalaGIRWriter_private_offset;
static gpointer bala_gir_writer_parent_class = NULL;

static GType bala_gir_writer_gir_namespace_get_type (void) G_GNUC_CONST G_GNUC_UNUSED;
static BalaGIRWriterGIRNamespace* bala_gir_writer_gir_namespace_dup (const BalaGIRWriterGIRNamespace* self);
static void bala_gir_writer_gir_namespace_free (BalaGIRWriterGIRNamespace* self);
static void bala_gir_writer_gir_namespace_copy (const BalaGIRWriterGIRNamespace* self,
                                         BalaGIRWriterGIRNamespace* dest);
static void bala_gir_writer_gir_namespace_destroy (BalaGIRWriterGIRNamespace* self);
static gchar* bala_gir_writer_real_get_interface_comment (BalaGIRWriter* self,
                                                   BalaInterface* iface);
static gchar* bala_gir_writer_real_get_struct_comment (BalaGIRWriter* self,
                                                BalaStruct* st);
static gchar* bala_gir_writer_real_get_enum_comment (BalaGIRWriter* self,
                                              BalaEnum* en);
static gchar* bala_gir_writer_real_get_class_comment (BalaGIRWriter* self,
                                               BalaClass* c);
static gchar* bala_gir_writer_real_get_error_code_comment (BalaGIRWriter* self,
                                                    BalaErrorCode* ecode);
static gchar* bala_gir_writer_real_get_enum_value_comment (BalaGIRWriter* self,
                                                    BalaEnumValue* ev);
static gchar* bala_gir_writer_real_get_constant_comment (BalaGIRWriter* self,
                                                  BalaConstant* c);
static gchar* bala_gir_writer_real_get_error_domain_comment (BalaGIRWriter* self,
                                                      BalaErrorDomain* edomain);
static gchar* bala_gir_writer_real_get_field_comment (BalaGIRWriter* self,
                                               BalaField* f);
static gchar* bala_gir_writer_real_get_delegate_comment (BalaGIRWriter* self,
                                                  BalaDelegate* cb);
static gchar* bala_gir_writer_real_get_method_comment (BalaGIRWriter* self,
                                                BalaMethod* m);
static gchar* bala_gir_writer_real_get_property_comment (BalaGIRWriter* self,
                                                  BalaProperty* prop);
static gchar* bala_gir_writer_real_get_delegate_return_comment (BalaGIRWriter* self,
                                                         BalaDelegate* cb);
static gchar* bala_gir_writer_real_get_signal_return_comment (BalaGIRWriter* self,
                                                       BalaSignal* sig);
static gchar* bala_gir_writer_real_get_method_return_comment (BalaGIRWriter* self,
                                                       BalaMethod* m);
static gchar* bala_gir_writer_real_get_signal_comment (BalaGIRWriter* self,
                                                BalaSignal* sig);
static gchar* bala_gir_writer_real_get_parameter_comment (BalaGIRWriter* self,
                                                   BalaParameter* param);
static gboolean bala_gir_writer_gir_namespace_equal (BalaGIRWriterGIRNamespace *self,
                                              BalaGIRWriterGIRNamespace* g);
static void bala_gir_writer_write_indent_stream (BalaGIRWriter* self);
static void bala_gir_writer_write_package (BalaGIRWriter* self,
                                    const gchar* package);
static void bala_gir_writer_write_doc (BalaGIRWriter* self,
                                const gchar* comment);
static void bala_gir_writer_write_indent (BalaGIRWriter* self);
static void bala_gir_writer_write_c_includes (BalaGIRWriter* self,
                                       BalaNamespace* ns);
static void bala_gir_writer_write_c_include (BalaGIRWriter* self,
                                      const gchar* name);
static void bala_gir_writer_real_visit_source_file (BalaCodeVisitor* base,
                                             BalaSourceFile* source_file);
static void bala_gir_writer_real_visit_namespace (BalaCodeVisitor* base,
                                           BalaNamespace* ns);
static gboolean bala_gir_writer_is_visibility (BalaGIRWriter* self,
                                        BalaSymbol* sym);
static void bala_gir_writer_visit_deferred (BalaGIRWriter* self);
static void bala_gir_writer_write_symbol_attributes (BalaGIRWriter* self,
                                              BalaSymbol* symbol);
static gboolean bala_gir_writer_is_introspectable (BalaGIRWriter* self,
                                            BalaSymbol* sym);
static void bala_gir_writer_real_visit_class (BalaCodeVisitor* base,
                                       BalaClass* cl);
static gboolean bala_gir_writer_check_accessibility (BalaGIRWriter* self,
                                              BalaSymbol* sym);
static gboolean bala_gir_writer_has_namespace (BalaGIRWriter* self,
                                        BalaSymbol* sym);
static gchar* bala_gir_writer_get_gir_name (BalaGIRWriter* self,
                                     BalaSymbol* symbol);
static void bala_gir_writer_write_gtype_attributes (BalaGIRWriter* self,
                                             BalaTypeSymbol* symbol,
                                             gboolean symbol_prefix);
static gchar* bala_gir_writer_gi_type_name (BalaGIRWriter* self,
                                     BalaTypeSymbol* type_symbol);
static void bala_gir_writer_write_type_parameter (BalaGIRWriter* self,
                                           BalaTypeParameter* type_parameter,
                                           const gchar* tag_type);
static void bala_gir_writer_write_ctype_attributes (BalaGIRWriter* self,
                                             BalaTypeSymbol* symbol,
                                             const gchar* suffix,
                                             gboolean symbol_prefix);
static void bala_gir_writer_do_write_signature (BalaGIRWriter* self,
                                         BalaMethod* m,
                                         const gchar* tag_name,
                                         gboolean instance,
                                         const gchar* name,
                                         const gchar* cname,
                                         BalaList* params,
                                         BalaDataType* return_type,
                                         gboolean can_fail,
                                         gboolean write_comment,
                                         gboolean write_attributes);
static void bala_gir_writer_write_signature (BalaGIRWriter* self,
                                      BalaMethod* m,
                                      const gchar* tag_name,
                                      gboolean write_doc,
                                      gboolean instance,
                                      gboolean write_attributes);
static void bala_gir_writer_real_visit_struct (BalaCodeVisitor* base,
                                        BalaStruct* st);
static void bala_gir_writer_real_visit_interface (BalaCodeVisitor* base,
                                           BalaInterface* iface);
static void bala_gir_writer_real_visit_enum (BalaCodeVisitor* base,
                                      BalaEnum* en);
static void bala_gir_writer_real_visit_enum_value (BalaCodeVisitor* base,
                                            BalaEnumValue* ev);
static gchar* bala_gir_writer_literal_expression_to_value_string (BalaGIRWriter* self,
                                                           BalaExpression* literal);
static void bala_gir_writer_real_visit_error_domain (BalaCodeVisitor* base,
                                              BalaErrorDomain* edomain);
static void bala_gir_writer_real_visit_error_code (BalaCodeVisitor* base,
                                            BalaErrorCode* ecode);
static void bala_gir_writer_real_visit_constant (BalaCodeVisitor* base,
                                          BalaConstant* c);
static void bala_gir_writer_write_type (BalaGIRWriter* self,
                                 BalaDataType* type,
                                 gint index,
                                 BalaParameterDirection direction);
static void bala_gir_writer_real_visit_field (BalaCodeVisitor* base,
                                       BalaField* f);
static void bala_gir_writer_write_implicit_params (BalaGIRWriter* self,
                                            BalaDataType* type,
                                            gint* index,
                                            gboolean has_array_length,
                                            const gchar* name,
                                            BalaParameterDirection direction);
static void bala_gir_writer_write_param_or_return (BalaGIRWriter* self,
                                            BalaDataType* type,
                                            const gchar* tag,
                                            gint* index,
                                            gboolean has_array_length,
                                            const gchar* name,
                                            const gchar* comment,
                                            BalaParameterDirection direction,
                                            gboolean constructor,
                                            gboolean caller_allocates,
                                            gboolean ellipsis);
static void bala_gir_writer_skip_implicit_params (BalaGIRWriter* self,
                                           BalaDataType* type,
                                           gint* index,
                                           gboolean has_array_length);
static void bala_gir_writer_write_params_and_return (BalaGIRWriter* self,
                                              const gchar* tag_name,
                                              BalaList* params,
                                              BalaList* type_params,
                                              BalaDataType* return_type,
                                              gboolean return_array_length,
                                              const gchar* return_comment,
                                              gboolean constructor,
                                              BalaParameter* instance_param,
                                              gboolean user_data);
static void bala_gir_writer_real_visit_delegate (BalaCodeVisitor* base,
                                          BalaDelegate* cb);
static void bala_gir_writer_real_visit_method (BalaCodeVisitor* base,
                                        BalaMethod* m);
static gboolean bala_gir_writer_is_type_introspectable (BalaGIRWriter* self,
                                                 BalaDataType* type);
static gboolean bala_gir_writer_is_method_introspectable (BalaGIRWriter* self,
                                                   BalaMethod* m);
static void bala_gir_writer_real_visit_creation_method (BalaCodeVisitor* base,
                                                 BalaCreationMethod* m);
static void bala_gir_writer_real_visit_property (BalaCodeVisitor* base,
                                          BalaProperty* prop);
static void bala_gir_writer_real_visit_signal (BalaCodeVisitor* base,
                                        BalaSignal* sig);
static gchar* bala_gir_writer_get_full_gir_name (BalaGIRWriter* self,
                                          BalaSymbol* sym);
static void bala_gir_writer_gir_namespace_init (BalaGIRWriterGIRNamespace *self,
                                         const gchar* ns,
                                         const gchar* version);
static void bala_gir_writer_finalize (BalaCodeVisitor * obj);
static GType bala_gir_writer_get_type_once (void);
static void _bala_array_destroy (gpointer array,
                          gint array_length,
                          GDestroyNotify destroy_func);
static void _bala_array_free (gpointer array,
                       gint array_length,
                       GDestroyNotify destroy_func);
static gint _bala_array_length (gpointer array);

static inline gpointer
bala_gir_writer_get_instance_private (BalaGIRWriter* self)
{
	return G_STRUCT_MEMBER_P (self, BalaGIRWriter_private_offset);
}

static gchar*
bala_gir_writer_real_get_interface_comment (BalaGIRWriter* self,
                                            BalaInterface* iface)
{
	gchar* result = NULL;
	g_return_val_if_fail (iface != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_interface_comment (BalaGIRWriter* self,
                                       BalaInterface* iface)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_interface_comment (self, iface);
}

static gchar*
bala_gir_writer_real_get_struct_comment (BalaGIRWriter* self,
                                         BalaStruct* st)
{
	gchar* result = NULL;
	g_return_val_if_fail (st != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_struct_comment (BalaGIRWriter* self,
                                    BalaStruct* st)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_struct_comment (self, st);
}

static gchar*
bala_gir_writer_real_get_enum_comment (BalaGIRWriter* self,
                                       BalaEnum* en)
{
	gchar* result = NULL;
	g_return_val_if_fail (en != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_enum_comment (BalaGIRWriter* self,
                                  BalaEnum* en)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_enum_comment (self, en);
}

static gchar*
bala_gir_writer_real_get_class_comment (BalaGIRWriter* self,
                                        BalaClass* c)
{
	gchar* result = NULL;
	g_return_val_if_fail (c != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_class_comment (BalaGIRWriter* self,
                                   BalaClass* c)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_class_comment (self, c);
}

static gchar*
bala_gir_writer_real_get_error_code_comment (BalaGIRWriter* self,
                                             BalaErrorCode* ecode)
{
	gchar* result = NULL;
	g_return_val_if_fail (ecode != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_error_code_comment (BalaGIRWriter* self,
                                        BalaErrorCode* ecode)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_error_code_comment (self, ecode);
}

static gchar*
bala_gir_writer_real_get_enum_value_comment (BalaGIRWriter* self,
                                             BalaEnumValue* ev)
{
	gchar* result = NULL;
	g_return_val_if_fail (ev != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_enum_value_comment (BalaGIRWriter* self,
                                        BalaEnumValue* ev)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_enum_value_comment (self, ev);
}

static gchar*
bala_gir_writer_real_get_constant_comment (BalaGIRWriter* self,
                                           BalaConstant* c)
{
	gchar* result = NULL;
	g_return_val_if_fail (c != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_constant_comment (BalaGIRWriter* self,
                                      BalaConstant* c)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_constant_comment (self, c);
}

static gchar*
bala_gir_writer_real_get_error_domain_comment (BalaGIRWriter* self,
                                               BalaErrorDomain* edomain)
{
	gchar* result = NULL;
	g_return_val_if_fail (edomain != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_error_domain_comment (BalaGIRWriter* self,
                                          BalaErrorDomain* edomain)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_error_domain_comment (self, edomain);
}

static gchar*
bala_gir_writer_real_get_field_comment (BalaGIRWriter* self,
                                        BalaField* f)
{
	gchar* result = NULL;
	g_return_val_if_fail (f != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_field_comment (BalaGIRWriter* self,
                                   BalaField* f)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_field_comment (self, f);
}

static gchar*
bala_gir_writer_real_get_delegate_comment (BalaGIRWriter* self,
                                           BalaDelegate* cb)
{
	gchar* result = NULL;
	g_return_val_if_fail (cb != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_delegate_comment (BalaGIRWriter* self,
                                      BalaDelegate* cb)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_delegate_comment (self, cb);
}

static gchar*
bala_gir_writer_real_get_method_comment (BalaGIRWriter* self,
                                         BalaMethod* m)
{
	gchar* result = NULL;
	g_return_val_if_fail (m != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_method_comment (BalaGIRWriter* self,
                                    BalaMethod* m)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_method_comment (self, m);
}

static gchar*
bala_gir_writer_real_get_property_comment (BalaGIRWriter* self,
                                           BalaProperty* prop)
{
	gchar* result = NULL;
	g_return_val_if_fail (prop != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_property_comment (BalaGIRWriter* self,
                                      BalaProperty* prop)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_property_comment (self, prop);
}

static gchar*
bala_gir_writer_real_get_delegate_return_comment (BalaGIRWriter* self,
                                                  BalaDelegate* cb)
{
	gchar* result = NULL;
	g_return_val_if_fail (cb != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_delegate_return_comment (BalaGIRWriter* self,
                                             BalaDelegate* cb)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_delegate_return_comment (self, cb);
}

static gchar*
bala_gir_writer_real_get_signal_return_comment (BalaGIRWriter* self,
                                                BalaSignal* sig)
{
	gchar* result = NULL;
	g_return_val_if_fail (sig != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_signal_return_comment (BalaGIRWriter* self,
                                           BalaSignal* sig)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_signal_return_comment (self, sig);
}

static gchar*
bala_gir_writer_real_get_method_return_comment (BalaGIRWriter* self,
                                                BalaMethod* m)
{
	gchar* result = NULL;
	g_return_val_if_fail (m != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_method_return_comment (BalaGIRWriter* self,
                                           BalaMethod* m)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_method_return_comment (self, m);
}

static gchar*
bala_gir_writer_real_get_signal_comment (BalaGIRWriter* self,
                                         BalaSignal* sig)
{
	gchar* result = NULL;
	g_return_val_if_fail (sig != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_signal_comment (BalaGIRWriter* self,
                                    BalaSignal* sig)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_signal_comment (self, sig);
}

static gchar*
bala_gir_writer_real_get_parameter_comment (BalaGIRWriter* self,
                                            BalaParameter* param)
{
	gchar* result = NULL;
	g_return_val_if_fail (param != NULL, NULL);
	result = NULL;
	return result;
}

gchar*
bala_gir_writer_get_parameter_comment (BalaGIRWriter* self,
                                       BalaParameter* param)
{
	g_return_val_if_fail (self != NULL, NULL);
	return BALA_GIR_WRITER_GET_CLASS (self)->get_parameter_comment (self, param);
}

static gpointer
_bala_iterable_ref0 (gpointer self)
{
	return self ? bala_iterable_ref (self) : NULL;
}

void
bala_gir_writer_write_includes (BalaGIRWriter* self)
{
	g_return_if_fail (self != NULL);
	{
		BalaArrayList* _i_list = NULL;
		BalaArrayList* _tmp0_;
		BalaArrayList* _tmp1_;
		gint _i_size = 0;
		BalaArrayList* _tmp2_;
		gint _tmp3_;
		gint _tmp4_;
		gint _i_index = 0;
		_tmp0_ = self->priv->externals;
		_tmp1_ = _bala_iterable_ref0 (_tmp0_);
		_i_list = _tmp1_;
		_tmp2_ = _i_list;
		_tmp3_ = bala_collection_get_size ((BalaCollection*) _tmp2_);
		_tmp4_ = _tmp3_;
		_i_size = _tmp4_;
		_i_index = -1;
		while (TRUE) {
			gint _tmp5_;
			gint _tmp6_;
			BalaGIRWriterGIRNamespace* i = NULL;
			BalaArrayList* _tmp7_;
			gpointer _tmp8_;
			BalaGIRWriterGIRNamespace* _tmp9_;
			const gchar* _tmp10_;
			const gchar* _tmp11_;
			_i_index = _i_index + 1;
			_tmp5_ = _i_index;
			_tmp6_ = _i_size;
			if (!(_tmp5_ < _tmp6_)) {
				break;
			}
			_tmp7_ = _i_list;
			_tmp8_ = bala_list_get ((BalaList*) _tmp7_, _i_index);
			i = (BalaGIRWriterGIRNamespace*) _tmp8_;
			_tmp9_ = i;
			_tmp10_ = (*_tmp9_).ns;
			_tmp11_ = self->priv->gir_namespace;
			if (g_strcmp0 (_tmp10_, _tmp11_) != 0) {
				FILE* _tmp12_;
				BalaGIRWriterGIRNamespace* _tmp13_;
				const gchar* _tmp14_;
				BalaGIRWriterGIRNamespace* _tmp15_;
				const gchar* _tmp16_;
				bala_gir_writer_write_indent_stream (self);
				_tmp12_ = self->priv->stream;
				_tmp13_ = i;
				_tmp14_ = (*_tmp13_).ns;
				_tmp15_ = i;
				_tmp16_ = (*_tmp15_).version;
				fprintf (_tmp12_, "<include name=\"%s\" version=\"%s\"/>\n", _tmp14_, _tmp16_);
			}
			_bala_gir_writer_gir_namespace_free0 (i);
		}
		_bala_iterable_unref0 (_i_list);
	}
}

/**
 * Writes the public interface of the specified code context into the
 * specified file.
 *
 * @param context      a code context
 * @param gir_filename a relative or absolute filename
 */
static gpointer
_bala_code_context_ref0 (gpointer self)
{
	return self ? bala_code_context_ref (self) : NULL;
}

static gpointer
_bala_code_node_ref0 (gpointer self)
{
	return self ? bala_code_node_ref (self) : NULL;
}

void
bala_gir_writer_write_file (BalaGIRWriter* self,
                            BalaCodeContext* context,
                            const gchar* directory,
                            const gchar* gir_filename,
                            const gchar* gir_namespace,
                            const gchar* gir_version,
                            const gchar* package,
                            const gchar* gir_shared_library)
{
	BalaCodeContext* _tmp0_;
	gchar* _tmp1_;
	gchar* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	BalaNamespace* root_symbol = NULL;
	BalaNamespace* _tmp5_;
	BalaNamespace* _tmp6_;
	BalaNamespace* _tmp7_;
	BalaSymbol* glib_ns = NULL;
	BalaNamespace* _tmp8_;
	BalaScope* _tmp9_;
	BalaScope* _tmp10_;
	BalaSymbol* _tmp11_;
	BalaSymbol* _tmp12_;
	BalaScope* _tmp13_;
	BalaScope* _tmp14_;
	BalaSymbol* _tmp15_;
	BalaSymbol* _tmp16_;
	BalaScope* _tmp17_;
	BalaScope* _tmp18_;
	BalaSymbol* _tmp19_;
	BalaSymbol* _tmp20_;
	BalaScope* _tmp21_;
	BalaScope* _tmp22_;
	BalaSymbol* _tmp23_;
	BalaSymbol* _tmp24_;
	BalaScope* _tmp25_;
	BalaScope* _tmp26_;
	BalaSymbol* _tmp27_;
	BalaSymbol* _tmp28_;
	BalaScope* _tmp29_;
	BalaScope* _tmp30_;
	BalaSymbol* _tmp31_;
	gint _tmp42_;
	GString* _tmp43_;
	gchar* filename = NULL;
	gchar* _tmp44_;
	gboolean file_exists = FALSE;
	const gchar* _tmp45_;
	gchar* temp_filename = NULL;
	const gchar* _tmp46_;
	gchar* _tmp47_;
	FILE* _tmp52_;
	FILE* _tmp56_;
	gchar* _tmp57_ = NULL;
	gboolean _tmp58_;
	gboolean _tmp59_;
	gchar* header = NULL;
	gchar* _tmp70_;
	FILE* _tmp71_;
	const gchar* _tmp72_;
	FILE* _tmp73_;
	FILE* _tmp74_;
	FILE* _tmp75_;
	FILE* _tmp76_;
	FILE* _tmp77_;
	gint _tmp78_;
	gint _tmp79_;
	FILE* _tmp80_;
	GString* _tmp81_;
	const gchar* _tmp82_;
	BalaHashSet* _tmp126_;
	gint _tmp127_;
	gint _tmp128_;
	GError* _inner_error0_ = NULL;
	g_return_if_fail (self != NULL);
	g_return_if_fail (context != NULL);
	g_return_if_fail (directory != NULL);
	g_return_if_fail (gir_filename != NULL);
	g_return_if_fail (gir_namespace != NULL);
	g_return_if_fail (gir_version != NULL);
	g_return_if_fail (package != NULL);
	_tmp0_ = _bala_code_context_ref0 (context);
	_bala_code_context_unref0 (self->priv->context);
	self->priv->context = _tmp0_;
	_tmp1_ = g_strdup (directory);
	_g_free0 (self->priv->directory);
	self->priv->directory = _tmp1_;
	_tmp2_ = g_strdup (gir_namespace);
	_g_free0 (self->priv->gir_namespace);
	self->priv->gir_namespace = _tmp2_;
	_tmp3_ = g_strdup (gir_version);
	_g_free0 (self->priv->gir_version);
	self->priv->gir_version = _tmp3_;
	_tmp4_ = g_strdup (gir_shared_library);
	_g_free0 (self->priv->gir_shared_library);
	self->priv->gir_shared_library = _tmp4_;
	_tmp5_ = bala_code_context_get_root (context);
	_tmp6_ = _tmp5_;
	_tmp7_ = _bala_code_node_ref0 (_tmp6_);
	root_symbol = _tmp7_;
	_tmp8_ = root_symbol;
	_tmp9_ = bala_symbol_get_scope ((BalaSymbol*) _tmp8_);
	_tmp10_ = _tmp9_;
	_tmp11_ = bala_scope_lookup (_tmp10_, "GLib");
	glib_ns = _tmp11_;
	_tmp12_ = glib_ns;
	_tmp13_ = bala_symbol_get_scope (_tmp12_);
	_tmp14_ = _tmp13_;
	_tmp15_ = bala_scope_lookup (_tmp14_, "Object");
	_bala_code_node_unref0 (self->priv->gobject_type);
	self->priv->gobject_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp15_, BALA_TYPE_TYPESYMBOL, BalaTypeSymbol);
	_tmp16_ = glib_ns;
	_tmp17_ = bala_symbol_get_scope (_tmp16_);
	_tmp18_ = _tmp17_;
	_tmp19_ = bala_scope_lookup (_tmp18_, "InitiallyUnowned");
	_bala_code_node_unref0 (self->priv->ginitiallyunowned_type);
	self->priv->ginitiallyunowned_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp19_, BALA_TYPE_TYPESYMBOL, BalaTypeSymbol);
	_tmp20_ = glib_ns;
	_tmp21_ = bala_symbol_get_scope (_tmp20_);
	_tmp22_ = _tmp21_;
	_tmp23_ = bala_scope_lookup (_tmp22_, "TypeInterface");
	_bala_code_node_unref0 (self->priv->gtypeinterface_type);
	self->priv->gtypeinterface_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp23_, BALA_TYPE_TYPESYMBOL, BalaTypeSymbol);
	_tmp24_ = glib_ns;
	_tmp25_ = bala_symbol_get_scope (_tmp24_);
	_tmp26_ = _tmp25_;
	_tmp27_ = bala_scope_lookup (_tmp26_, "TypeInstance");
	_bala_code_node_unref0 (self->priv->gtypeinstance_type);
	self->priv->gtypeinstance_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp27_, BALA_TYPE_TYPESYMBOL, BalaTypeSymbol);
	_tmp28_ = glib_ns;
	_tmp29_ = bala_symbol_get_scope (_tmp28_);
	_tmp30_ = _tmp29_;
	_tmp31_ = bala_scope_lookup (_tmp30_, "Type");
	_bala_code_node_unref0 (self->priv->gtype_type);
	self->priv->gtype_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp31_, BALA_TYPE_TYPESYMBOL, BalaTypeSymbol);
	bala_gir_writer_write_package (self, package);
	{
		BalaList* _file_list = NULL;
		BalaList* _tmp32_;
		BalaList* _tmp33_;
		gint _file_size = 0;
		BalaList* _tmp34_;
		gint _tmp35_;
		gint _tmp36_;
		gint _file_index = 0;
		_tmp32_ = bala_code_context_get_source_files (context);
		_tmp33_ = _bala_iterable_ref0 (_tmp32_);
		_file_list = _tmp33_;
		_tmp34_ = _file_list;
		_tmp35_ = bala_collection_get_size ((BalaCollection*) _tmp34_);
		_tmp36_ = _tmp35_;
		_file_size = _tmp36_;
		_file_index = -1;
		while (TRUE) {
			gint _tmp37_;
			gint _tmp38_;
			BalaSourceFile* file = NULL;
			BalaList* _tmp39_;
			gpointer _tmp40_;
			BalaSourceFile* _tmp41_;
			_file_index = _file_index + 1;
			_tmp37_ = _file_index;
			_tmp38_ = _file_size;
			if (!(_tmp37_ < _tmp38_)) {
				break;
			}
			_tmp39_ = _file_list;
			_tmp40_ = bala_list_get (_tmp39_, _file_index);
			file = (BalaSourceFile*) _tmp40_;
			_tmp41_ = file;
			bala_source_file_accept (_tmp41_, (BalaCodeVisitor*) self);
			_bala_source_file_unref0 (file);
		}
		_bala_iterable_unref0 (_file_list);
	}
	bala_code_context_accept (context, (BalaCodeVisitor*) self);
	_tmp42_ = self->priv->indent;
	self->priv->indent = _tmp42_ - 1;
	_tmp43_ = self->priv->buffer;
	g_string_append_printf (_tmp43_, "</repository>\n");
	_tmp44_ = g_strdup_printf ("%s%c%s", directory, (gint) G_DIR_SEPARATOR, gir_filename);
	filename = _tmp44_;
	_tmp45_ = filename;
	file_exists = g_file_test (_tmp45_, G_FILE_TEST_EXISTS);
	_tmp46_ = filename;
	_tmp47_ = g_strdup_printf ("%s.balatmp", _tmp46_);
	temp_filename = _tmp47_;
	if (file_exists) {
		const gchar* _tmp48_;
		FILE* _tmp49_;
		_tmp48_ = temp_filename;
		_tmp49_ = g_fopen (_tmp48_, "w");
		_fclose0 (self->priv->stream);
		self->priv->stream = _tmp49_;
	} else {
		const gchar* _tmp50_;
		FILE* _tmp51_;
		_tmp50_ = filename;
		_tmp51_ = g_fopen (_tmp50_, "w");
		_fclose0 (self->priv->stream);
		self->priv->stream = _tmp51_;
	}
	_tmp52_ = self->priv->stream;
	if (_tmp52_ == NULL) {
		const gchar* _tmp53_;
		gchar* _tmp54_;
		gchar* _tmp55_;
		_tmp53_ = filename;
		_tmp54_ = g_strdup_printf ("unable to open `%s' for writing", _tmp53_);
		_tmp55_ = _tmp54_;
		bala_report_error (NULL, _tmp55_);
		_g_free0 (_tmp55_);
		_bala_code_context_unref0 (self->priv->context);
		self->priv->context = NULL;
		_g_free0 (temp_filename);
		_g_free0 (filename);
		_bala_code_node_unref0 (glib_ns);
		_bala_code_node_unref0 (root_symbol);
		return;
	}
	_tmp56_ = self->priv->stream;
	fprintf (_tmp56_, "<?xml version=\"1.0\"?>\n");
	_tmp58_ = bala_code_context_get_version_header (context);
	_tmp59_ = _tmp58_;
	if (_tmp59_) {
		const gchar* _tmp60_;
		gchar* _tmp61_;
		gchar* _tmp62_;
		const gchar* _tmp63_;
		gchar* _tmp64_;
		_tmp60_ = filename;
		_tmp61_ = g_path_get_basename (_tmp60_);
		_tmp62_ = _tmp61_;
		_tmp63_ = g_get_prgname ();
		_tmp64_ = g_strdup_printf ("<!-- %s generated by %s %s, do not modify. -->", _tmp62_, _tmp63_, BALA_BUILD_VERSION);
		_g_free0 (_tmp57_);
		_tmp57_ = _tmp64_;
		_g_free0 (_tmp62_);
	} else {
		const gchar* _tmp65_;
		gchar* _tmp66_;
		gchar* _tmp67_;
		const gchar* _tmp68_;
		gchar* _tmp69_;
		_tmp65_ = filename;
		_tmp66_ = g_path_get_basename (_tmp65_);
		_tmp67_ = _tmp66_;
		_tmp68_ = g_get_prgname ();
		_tmp69_ = g_strdup_printf ("<!-- %s generated by %s, do not modify. -->", _tmp67_, _tmp68_);
		_g_free0 (_tmp57_);
		_tmp57_ = _tmp69_;
		_g_free0 (_tmp67_);
	}
	_tmp70_ = g_strdup (_tmp57_);
	header = _tmp70_;
	_tmp71_ = self->priv->stream;
	_tmp72_ = header;
	fprintf (_tmp71_, "%s\n", _tmp72_);
	_tmp73_ = self->priv->stream;
	fprintf (_tmp73_, "<repository version=\"1.2\"");
	_tmp74_ = self->priv->stream;
	fprintf (_tmp74_, " xmlns=\"http://www.gtk.org/introspection/core/1.0\"");
	_tmp75_ = self->priv->stream;
	fprintf (_tmp75_, " xmlns:c=\"http://www.gtk.org/introspection/c/1.0\"");
	_tmp76_ = self->priv->stream;
	fprintf (_tmp76_, " xmlns:glib=\"http://www.gtk.org/introspection/glib/1.0\"");
	_tmp77_ = self->priv->stream;
	fprintf (_tmp77_, ">\n");
	_tmp78_ = self->priv->indent;
	self->priv->indent = _tmp78_ + 1;
	bala_gir_writer_write_includes (self);
	_tmp79_ = self->priv->indent;
	self->priv->indent = _tmp79_ - 1;
	_tmp80_ = self->priv->stream;
	_tmp81_ = self->priv->buffer;
	_tmp82_ = _tmp81_->str;
	fputs (_tmp82_, _tmp80_);
	_fclose0 (self->priv->stream);
	self->priv->stream = NULL;
	if (file_exists) {
		gboolean changed = FALSE;
		changed = TRUE;
		{
			GMappedFile* old_file = NULL;
			const gchar* _tmp83_;
			GMappedFile* _tmp84_;
			GMappedFile* new_file = NULL;
			const gchar* _tmp85_;
			GMappedFile* _tmp86_;
			gsize len = 0UL;
			GMappedFile* _tmp87_;
			GMappedFile* _tmp88_;
			_tmp83_ = filename;
			_tmp84_ = g_mapped_file_new (_tmp83_, FALSE, &_inner_error0_);
			old_file = _tmp84_;
			if (G_UNLIKELY (_inner_error0_ != NULL)) {
				if (_inner_error0_->domain == G_FILE_ERROR) {
					goto __catch0_g_file_error;
				}
				_g_free0 (header);
				_g_free0 (_tmp57_);
				_g_free0 (temp_filename);
				_g_free0 (filename);
				_bala_code_node_unref0 (glib_ns);
				_bala_code_node_unref0 (root_symbol);
				g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
				g_clear_error (&_inner_error0_);
				return;
			}
			_tmp85_ = temp_filename;
			_tmp86_ = g_mapped_file_new (_tmp85_, FALSE, &_inner_error0_);
			new_file = _tmp86_;
			if (G_UNLIKELY (_inner_error0_ != NULL)) {
				_g_mapped_file_unref0 (old_file);
				if (_inner_error0_->domain == G_FILE_ERROR) {
					goto __catch0_g_file_error;
				}
				_g_free0 (header);
				_g_free0 (_tmp57_);
				_g_free0 (temp_filename);
				_g_free0 (filename);
				_bala_code_node_unref0 (glib_ns);
				_bala_code_node_unref0 (root_symbol);
				g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
				g_clear_error (&_inner_error0_);
				return;
			}
			_tmp87_ = old_file;
			len = g_mapped_file_get_length (_tmp87_);
			_tmp88_ = new_file;
			if (len == g_mapped_file_get_length (_tmp88_)) {
				GMappedFile* _tmp89_;
				gchar* _tmp90_;
				GMappedFile* _tmp91_;
				gchar* _tmp92_;
				_tmp89_ = old_file;
				_tmp90_ = g_mapped_file_get_contents (_tmp89_);
				_tmp91_ = new_file;
				_tmp92_ = g_mapped_file_get_contents (_tmp91_);
				if (memcmp (_tmp90_, _tmp92_, len) == 0) {
					changed = FALSE;
				}
			}
			_g_mapped_file_unref0 (old_file);
			old_file = NULL;
			_g_mapped_file_unref0 (new_file);
			new_file = NULL;
			_g_mapped_file_unref0 (new_file);
			_g_mapped_file_unref0 (old_file);
		}
		goto __finally0;
		__catch0_g_file_error:
		{
			g_clear_error (&_inner_error0_);
		}
		__finally0:
		if (G_UNLIKELY (_inner_error0_ != NULL)) {
			_g_free0 (header);
			_g_free0 (_tmp57_);
			_g_free0 (temp_filename);
			_g_free0 (filename);
			_bala_code_node_unref0 (glib_ns);
			_bala_code_node_unref0 (root_symbol);
			g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error0_->message, g_quark_to_string (_inner_error0_->domain), _inner_error0_->code);
			g_clear_error (&_inner_error0_);
			return;
		}
		if (changed) {
			const gchar* _tmp93_;
			const gchar* _tmp94_;
			_tmp93_ = temp_filename;
			_tmp94_ = filename;
			g_rename (_tmp93_, _tmp94_);
		} else {
			const gchar* _tmp95_;
			_tmp95_ = temp_filename;
			g_unlink (_tmp95_);
		}
	}
	{
		BalaIterator* _ns_it = NULL;
		BalaHashSet* _tmp96_;
		BalaIterator* _tmp97_;
		_tmp96_ = self->priv->unannotated_namespaces;
		_tmp97_ = bala_iterable_iterator ((BalaIterable*) _tmp96_);
		_ns_it = _tmp97_;
		while (TRUE) {
			BalaIterator* _tmp98_;
			BalaNamespace* ns = NULL;
			BalaIterator* _tmp99_;
			gpointer _tmp100_;
			BalaHashSet* _tmp101_;
			BalaNamespace* _tmp102_;
			_tmp98_ = _ns_it;
			if (!bala_iterator_next (_tmp98_)) {
				break;
			}
			_tmp99_ = _ns_it;
			_tmp100_ = bala_iterator_get (_tmp99_);
			ns = (BalaNamespace*) _tmp100_;
			_tmp101_ = self->priv->our_namespaces;
			_tmp102_ = ns;
			if (!bala_collection_contains ((BalaCollection*) _tmp101_, _tmp102_)) {
				BalaNamespace* _tmp103_;
				BalaSourceReference* _tmp104_;
				BalaSourceReference* _tmp105_;
				BalaNamespace* _tmp106_;
				const gchar* _tmp107_;
				const gchar* _tmp108_;
				gchar* _tmp109_;
				gchar* _tmp110_;
				_tmp103_ = ns;
				_tmp104_ = bala_code_node_get_source_reference ((BalaCodeNode*) _tmp103_);
				_tmp105_ = _tmp104_;
				_tmp106_ = ns;
				_tmp107_ = bala_symbol_get_name ((BalaSymbol*) _tmp106_);
				_tmp108_ = _tmp107_;
				_tmp109_ = g_strdup_printf ("Namespace %s does not have a GIR namespace and version annotation", _tmp108_);
				_tmp110_ = _tmp109_;
				bala_report_warning (_tmp105_, _tmp110_);
				_g_free0 (_tmp110_);
			}
			_bala_code_node_unref0 (ns);
		}
		_bala_iterator_unref0 (_ns_it);
	}
	{
		BalaIterator* _ns_it = NULL;
		BalaHashSet* _tmp111_;
		BalaIterator* _tmp112_;
		_tmp111_ = self->priv->our_namespaces;
		_tmp112_ = bala_iterable_iterator ((BalaIterable*) _tmp111_);
		_ns_it = _tmp112_;
		while (TRUE) {
			BalaIterator* _tmp113_;
			BalaNamespace* ns = NULL;
			BalaIterator* _tmp114_;
			gpointer _tmp115_;
			BalaNamespace* _tmp116_;
			BalaSourceReference* _tmp117_;
			BalaSourceReference* _tmp118_;
			BalaSourceFile* _tmp119_;
			BalaSourceFile* _tmp120_;
			BalaNamespace* _tmp121_;
			BalaSourceReference* _tmp122_;
			BalaSourceReference* _tmp123_;
			BalaSourceFile* _tmp124_;
			BalaSourceFile* _tmp125_;
			_tmp113_ = _ns_it;
			if (!bala_iterator_next (_tmp113_)) {
				break;
			}
			_tmp114_ = _ns_it;
			_tmp115_ = bala_iterator_get (_tmp114_);
			ns = (BalaNamespace*) _tmp115_;
			_tmp116_ = ns;
			_tmp117_ = bala_code_node_get_source_reference ((BalaCodeNode*) _tmp116_);
			_tmp118_ = _tmp117_;
			_tmp119_ = bala_source_reference_get_file (_tmp118_);
			_tmp120_ = _tmp119_;
			bala_source_file_set_gir_namespace (_tmp120_, gir_namespace);
			_tmp121_ = ns;
			_tmp122_ = bala_code_node_get_source_reference ((BalaCodeNode*) _tmp121_);
			_tmp123_ = _tmp122_;
			_tmp124_ = bala_source_reference_get_file (_tmp123_);
			_tmp125_ = _tmp124_;
			bala_source_file_set_gir_version (_tmp125_, gir_version);
			_bala_code_node_unref0 (ns);
		}
		_bala_iterator_unref0 (_ns_it);
	}
	_tmp126_ = self->priv->our_namespaces;
	_tmp127_ = bala_collection_get_size ((BalaCollection*) _tmp126_);
	_tmp128_ = _tmp127_;
	if (_tmp128_ == 0) {
		bala_report_error (NULL, "No suitable namespace found to export for GIR");
	}
	_bala_code_context_unref0 (self->priv->context);
	self->priv->context = NULL;
	_g_free0 (header);
	_g_free0 (_tmp57_);
	_g_free0 (temp_filename);
	_g_free0 (filename);
	_bala_code_node_unref0 (glib_ns);
	_bala_code_node_unref0 (root_symbol);
}

static void
bala_gir_writer_write_doc (BalaGIRWriter* self,
                           const gchar* comment)
{
	g_return_if_fail (self != NULL);
	if (comment != NULL) {
		GString* _tmp0_;
		GString* _tmp1_;
		GString* _tmp2_;
		bala_gir_writer_write_indent (self);
		_tmp0_ = self->priv->buffer;
		g_string_append (_tmp0_, "<doc xml:whitespace=\"preserve\">");
		_tmp1_ = self->priv->buffer;
		g_string_append (_tmp1_, comment);
		_tmp2_ = self->priv->buffer;
		g_string_append (_tmp2_, "</doc>\n");
	}
}

static void
bala_gir_writer_write_package (BalaGIRWriter* self,
                               const gchar* package)
{
	GString* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (package != NULL);
	bala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<package name=\"%s\"/>\n", package);
}

static void
bala_gir_writer_write_c_includes (BalaGIRWriter* self,
                                  BalaNamespace* ns)
{
	BalaSet* header_filenames = NULL;
	GHashFunc _tmp0_;
	GEqualFunc _tmp1_;
	BalaHashSet* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	gchar** _tmp5_;
	gchar** _tmp6_;
	gchar** _tmp7_;
	gint _tmp7__length1;
	g_return_if_fail (self != NULL);
	g_return_if_fail (ns != NULL);
	_tmp0_ = g_str_hash;
	_tmp1_ = g_str_equal;
	_tmp2_ = bala_hash_set_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, (GDestroyNotify) g_free, _tmp0_, _tmp1_);
	header_filenames = (BalaSet*) _tmp2_;
	_tmp3_ = bala_get_ccode_header_filenames ((BalaSymbol*) ns);
	_tmp4_ = _tmp3_;
	_tmp6_ = _tmp5_ = g_strsplit (_tmp4_, ",", 0);
	_tmp7_ = _tmp6_;
	_tmp7__length1 = _bala_array_length (_tmp5_);
	_g_free0 (_tmp4_);
	{
		gchar** c_header_filename_collection = NULL;
		gint c_header_filename_collection_length1 = 0;
		gint _c_header_filename_collection_size_ = 0;
		gint c_header_filename_it = 0;
		c_header_filename_collection = _tmp7_;
		c_header_filename_collection_length1 = _tmp7__length1;
		for (c_header_filename_it = 0; c_header_filename_it < c_header_filename_collection_length1; c_header_filename_it = c_header_filename_it + 1) {
			const gchar* c_header_filename = NULL;
			c_header_filename = c_header_filename_collection[c_header_filename_it];
			{
				BalaSet* _tmp8_;
				const gchar* _tmp9_;
				_tmp8_ = header_filenames;
				_tmp9_ = c_header_filename;
				bala_collection_add ((BalaCollection*) _tmp8_, _tmp9_);
			}
		}
		c_header_filename_collection = (_bala_array_free (c_header_filename_collection, c_header_filename_collection_length1, (GDestroyNotify) g_free), NULL);
	}
	{
		BalaIterator* _symbol_it = NULL;
		BalaScope* _tmp10_;
		BalaScope* _tmp11_;
		BalaMap* _tmp12_;
		BalaCollection* _tmp13_;
		BalaCollection* _tmp14_;
		BalaIterator* _tmp15_;
		BalaIterator* _tmp16_;
		_tmp10_ = bala_symbol_get_scope ((BalaSymbol*) ns);
		_tmp11_ = _tmp10_;
		_tmp12_ = bala_scope_get_symbol_table (_tmp11_);
		_tmp13_ = bala_map_get_values (_tmp12_);
		_tmp14_ = _tmp13_;
		_tmp15_ = bala_iterable_iterator ((BalaIterable*) _tmp14_);
		_tmp16_ = _tmp15_;
		_bala_iterable_unref0 (_tmp14_);
		_symbol_it = _tmp16_;
		while (TRUE) {
			BalaIterator* _tmp17_;
			BalaSymbol* symbol = NULL;
			BalaIterator* _tmp18_;
			gpointer _tmp19_;
			BalaSymbol* _tmp20_;
			gboolean _tmp21_;
			gboolean _tmp22_;
			BalaSymbol* _tmp23_;
			gchar* _tmp24_;
			gchar* _tmp25_;
			gchar** _tmp26_;
			gchar** _tmp27_;
			gchar** _tmp28_;
			gint _tmp28__length1;
			_tmp17_ = _symbol_it;
			if (!bala_iterator_next (_tmp17_)) {
				break;
			}
			_tmp18_ = _symbol_it;
			_tmp19_ = bala_iterator_get (_tmp18_);
			symbol = (BalaSymbol*) _tmp19_;
			_tmp20_ = symbol;
			_tmp21_ = bala_symbol_get_external_package (_tmp20_);
			_tmp22_ = _tmp21_;
			if (_tmp22_) {
				_bala_code_node_unref0 (symbol);
				continue;
			}
			_tmp23_ = symbol;
			_tmp24_ = bala_get_ccode_header_filenames (_tmp23_);
			_tmp25_ = _tmp24_;
			_tmp27_ = _tmp26_ = g_strsplit (_tmp25_, ",", 0);
			_tmp28_ = _tmp27_;
			_tmp28__length1 = _bala_array_length (_tmp26_);
			_g_free0 (_tmp25_);
			{
				gchar** c_header_filename_collection = NULL;
				gint c_header_filename_collection_length1 = 0;
				gint _c_header_filename_collection_size_ = 0;
				gint c_header_filename_it = 0;
				c_header_filename_collection = _tmp28_;
				c_header_filename_collection_length1 = _tmp28__length1;
				for (c_header_filename_it = 0; c_header_filename_it < c_header_filename_collection_length1; c_header_filename_it = c_header_filename_it + 1) {
					const gchar* c_header_filename = NULL;
					c_header_filename = c_header_filename_collection[c_header_filename_it];
					{
						BalaSet* _tmp29_;
						const gchar* _tmp30_;
						_tmp29_ = header_filenames;
						_tmp30_ = c_header_filename;
						bala_collection_add ((BalaCollection*) _tmp29_, _tmp30_);
					}
				}
				c_header_filename_collection = (_bala_array_free (c_header_filename_collection, c_header_filename_collection_length1, (GDestroyNotify) g_free), NULL);
			}
			_bala_code_node_unref0 (symbol);
		}
		_bala_iterator_unref0 (_symbol_it);
	}
	{
		BalaIterator* _c_header_filename_it = NULL;
		BalaSet* _tmp31_;
		BalaIterator* _tmp32_;
		_tmp31_ = header_filenames;
		_tmp32_ = bala_iterable_iterator ((BalaIterable*) _tmp31_);
		_c_header_filename_it = _tmp32_;
		while (TRUE) {
			BalaIterator* _tmp33_;
			gchar* c_header_filename = NULL;
			BalaIterator* _tmp34_;
			gpointer _tmp35_;
			const gchar* _tmp36_;
			_tmp33_ = _c_header_filename_it;
			if (!bala_iterator_next (_tmp33_)) {
				break;
			}
			_tmp34_ = _c_header_filename_it;
			_tmp35_ = bala_iterator_get (_tmp34_);
			c_header_filename = (gchar*) _tmp35_;
			_tmp36_ = c_header_filename;
			bala_gir_writer_write_c_include (self, _tmp36_);
			_g_free0 (c_header_filename);
		}
		_bala_iterator_unref0 (_c_header_filename_it);
	}
	_bala_iterable_unref0 (header_filenames);
}

static void
bala_gir_writer_write_c_include (BalaGIRWriter* self,
                                 const gchar* name)
{
	GString* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (name != NULL);
	bala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<c:include name=\"%s\"/>\n", name);
}

static void
bala_gir_writer_real_visit_source_file (BalaCodeVisitor* base,
                                        BalaSourceFile* source_file)
{
	BalaGIRWriter * self;
	BalaSourceFileType _tmp0_;
	BalaSourceFileType _tmp1_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (source_file != NULL);
	_tmp0_ = bala_source_file_get_file_type (source_file);
	_tmp1_ = _tmp0_;
	if (_tmp1_ != BALA_SOURCE_FILE_TYPE_PACKAGE) {
		return;
	}
	{
		BalaList* _node_list = NULL;
		BalaList* _tmp2_;
		BalaList* _tmp3_;
		gint _node_size = 0;
		BalaList* _tmp4_;
		gint _tmp5_;
		gint _tmp6_;
		gint _node_index = 0;
		_tmp2_ = bala_source_file_get_nodes (source_file);
		_tmp3_ = _bala_iterable_ref0 (_tmp2_);
		_node_list = _tmp3_;
		_tmp4_ = _node_list;
		_tmp5_ = bala_collection_get_size ((BalaCollection*) _tmp4_);
		_tmp6_ = _tmp5_;
		_node_size = _tmp6_;
		_node_index = -1;
		while (TRUE) {
			gint _tmp7_;
			gint _tmp8_;
			BalaCodeNode* node = NULL;
			BalaList* _tmp9_;
			gpointer _tmp10_;
			gboolean _tmp11_ = FALSE;
			BalaCodeNode* _tmp12_;
			_node_index = _node_index + 1;
			_tmp7_ = _node_index;
			_tmp8_ = _node_size;
			if (!(_tmp7_ < _tmp8_)) {
				break;
			}
			_tmp9_ = _node_list;
			_tmp10_ = bala_list_get (_tmp9_, _node_index);
			node = (BalaCodeNode*) _tmp10_;
			_tmp12_ = node;
			if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp12_, BALA_TYPE_NAMESPACE)) {
				BalaCodeNode* _tmp13_;
				BalaSymbol* _tmp14_;
				BalaSymbol* _tmp15_;
				BalaCodeContext* _tmp16_;
				BalaNamespace* _tmp17_;
				BalaNamespace* _tmp18_;
				_tmp13_ = node;
				_tmp14_ = bala_symbol_get_parent_symbol ((BalaSymbol*) G_TYPE_CHECK_INSTANCE_CAST (_tmp13_, BALA_TYPE_NAMESPACE, BalaNamespace));
				_tmp15_ = _tmp14_;
				_tmp16_ = self->priv->context;
				_tmp17_ = bala_code_context_get_root (_tmp16_);
				_tmp18_ = _tmp17_;
				_tmp11_ = _tmp15_ == G_TYPE_CHECK_INSTANCE_CAST (_tmp18_, BALA_TYPE_SYMBOL, BalaSymbol);
			} else {
				_tmp11_ = FALSE;
			}
			if (_tmp11_) {
				BalaAttribute* a = NULL;
				BalaCodeNode* _tmp19_;
				BalaAttribute* _tmp20_;
				BalaAttribute* _tmp21_;
				gboolean _tmp22_ = FALSE;
				BalaAttribute* _tmp23_;
				gboolean _tmp28_ = FALSE;
				BalaAttribute* _tmp29_;
				_tmp19_ = node;
				_tmp20_ = bala_code_node_get_attribute (_tmp19_, "CCode");
				_tmp21_ = _bala_code_node_ref0 (_tmp20_);
				a = _tmp21_;
				_tmp23_ = a;
				if (_tmp23_ != NULL) {
					BalaAttribute* _tmp24_;
					_tmp24_ = a;
					_tmp22_ = bala_attribute_has_argument (_tmp24_, "gir_namespace");
				} else {
					_tmp22_ = FALSE;
				}
				if (_tmp22_) {
					BalaAttribute* _tmp25_;
					gchar* _tmp26_;
					gchar* _tmp27_;
					_tmp25_ = a;
					_tmp26_ = bala_attribute_get_string (_tmp25_, "gir_namespace", NULL);
					_tmp27_ = _tmp26_;
					bala_source_file_set_gir_namespace (source_file, _tmp27_);
					_g_free0 (_tmp27_);
				}
				_tmp29_ = a;
				if (_tmp29_ != NULL) {
					BalaAttribute* _tmp30_;
					_tmp30_ = a;
					_tmp28_ = bala_attribute_has_argument (_tmp30_, "gir_version");
				} else {
					_tmp28_ = FALSE;
				}
				if (_tmp28_) {
					BalaAttribute* _tmp31_;
					gchar* _tmp32_;
					gchar* _tmp33_;
					_tmp31_ = a;
					_tmp32_ = bala_attribute_get_string (_tmp31_, "gir_version", NULL);
					_tmp33_ = _tmp32_;
					bala_source_file_set_gir_version (source_file, _tmp33_);
					_g_free0 (_tmp33_);
				}
				_bala_code_node_unref0 (a);
				_bala_code_node_unref0 (node);
				break;
			}
			_bala_code_node_unref0 (node);
		}
		_bala_iterable_unref0 (_node_list);
	}
}

static void
bala_gir_writer_real_visit_namespace (BalaCodeVisitor* base,
                                      BalaNamespace* ns)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	BalaSymbol* _tmp8_;
	BalaSymbol* _tmp9_;
	const gchar* _tmp10_;
	const gchar* _tmp11_;
	BalaHashSet* _tmp12_;
	gint _tmp13_;
	gint _tmp14_;
	GString* _tmp21_;
	const gchar* _tmp22_;
	const gchar* _tmp23_;
	gchar* cprefix = NULL;
	gchar* _tmp24_;
	const gchar* _tmp25_;
	const gchar* _tmp28_;
	gchar* csymbol_prefix = NULL;
	gchar* _tmp33_;
	const gchar* _tmp34_;
	GString* _tmp37_;
	gint _tmp38_;
	BalaArrayList* _tmp39_;
	BalaArrayList* _tmp40_;
	gpointer _tmp41_;
	BalaSymbol* _tmp42_;
	gint _tmp43_;
	GString* _tmp44_;
	BalaHashSet* _tmp45_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (ns != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) ns);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_is_visibility (self, (BalaSymbol*) ns)) {
		return;
	}
	_tmp2_ = bala_symbol_get_name ((BalaSymbol*) ns);
	_tmp3_ = _tmp2_;
	if (_tmp3_ == NULL) {
		BalaArrayList* _tmp4_;
		BalaArrayList* _tmp5_;
		gpointer _tmp6_;
		BalaSymbol* _tmp7_;
		_tmp4_ = self->priv->hierarchy;
		bala_list_insert ((BalaList*) _tmp4_, 0, (BalaSymbol*) ns);
		bala_code_node_accept_children ((BalaCodeNode*) ns, (BalaCodeVisitor*) self);
		_tmp5_ = self->priv->hierarchy;
		_tmp6_ = bala_list_remove_at ((BalaList*) _tmp5_, 0);
		_tmp7_ = (BalaSymbol*) _tmp6_;
		_bala_code_node_unref0 (_tmp7_);
		return;
	}
	_tmp8_ = bala_symbol_get_parent_symbol ((BalaSymbol*) ns);
	_tmp9_ = _tmp8_;
	_tmp10_ = bala_symbol_get_name (_tmp9_);
	_tmp11_ = _tmp10_;
	if (_tmp11_ != NULL) {
		bala_code_node_accept_children ((BalaCodeNode*) ns, (BalaCodeVisitor*) self);
		return;
	}
	_tmp12_ = self->priv->our_namespaces;
	_tmp13_ = bala_collection_get_size ((BalaCollection*) _tmp12_);
	_tmp14_ = _tmp13_;
	if (_tmp14_ > 0) {
		BalaSourceReference* _tmp15_;
		BalaSourceReference* _tmp16_;
		const gchar* _tmp17_;
		const gchar* _tmp18_;
		gchar* _tmp19_;
		gchar* _tmp20_;
		_tmp15_ = bala_code_node_get_source_reference ((BalaCodeNode*) ns);
		_tmp16_ = _tmp15_;
		_tmp17_ = bala_symbol_get_name ((BalaSymbol*) ns);
		_tmp18_ = _tmp17_;
		_tmp19_ = g_strdup_printf ("Secondary top-level namespace `%s' is not supported by GIR format", _tmp18_);
		_tmp20_ = _tmp19_;
		bala_report_error (_tmp16_, _tmp20_);
		_g_free0 (_tmp20_);
		return;
	}
	bala_gir_writer_write_c_includes (self, ns);
	bala_gir_writer_write_indent (self);
	_tmp21_ = self->priv->buffer;
	_tmp22_ = self->priv->gir_namespace;
	_tmp23_ = self->priv->gir_version;
	g_string_append_printf (_tmp21_, "<namespace name=\"%s\" version=\"%s\"", _tmp22_, _tmp23_);
	_tmp24_ = bala_get_ccode_prefix ((BalaSymbol*) ns);
	cprefix = _tmp24_;
	_tmp25_ = self->priv->gir_shared_library;
	if (_tmp25_ != NULL) {
		GString* _tmp26_;
		const gchar* _tmp27_;
		_tmp26_ = self->priv->buffer;
		_tmp27_ = self->priv->gir_shared_library;
		g_string_append_printf (_tmp26_, " shared-library=\"%s\"", _tmp27_);
	}
	_tmp28_ = cprefix;
	if (_tmp28_ != NULL) {
		GString* _tmp29_;
		const gchar* _tmp30_;
		GString* _tmp31_;
		const gchar* _tmp32_;
		_tmp29_ = self->priv->buffer;
		_tmp30_ = cprefix;
		g_string_append_printf (_tmp29_, " c:prefix=\"%s\"", _tmp30_);
		_tmp31_ = self->priv->buffer;
		_tmp32_ = cprefix;
		g_string_append_printf (_tmp31_, " c:identifier-prefixes=\"%s\"", _tmp32_);
	}
	_tmp33_ = bala_get_ccode_lower_case_suffix ((BalaSymbol*) ns);
	csymbol_prefix = _tmp33_;
	_tmp34_ = csymbol_prefix;
	if (_tmp34_ != NULL) {
		GString* _tmp35_;
		const gchar* _tmp36_;
		_tmp35_ = self->priv->buffer;
		_tmp36_ = csymbol_prefix;
		g_string_append_printf (_tmp35_, " c:symbol-prefixes=\"%s\"", _tmp36_);
	}
	_tmp37_ = self->priv->buffer;
	g_string_append_printf (_tmp37_, ">\n");
	_tmp38_ = self->priv->indent;
	self->priv->indent = _tmp38_ + 1;
	_tmp39_ = self->priv->hierarchy;
	bala_list_insert ((BalaList*) _tmp39_, 0, (BalaSymbol*) ns);
	bala_code_node_accept_children ((BalaCodeNode*) ns, (BalaCodeVisitor*) self);
	_tmp40_ = self->priv->hierarchy;
	_tmp41_ = bala_list_remove_at ((BalaList*) _tmp40_, 0);
	_tmp42_ = (BalaSymbol*) _tmp41_;
	_bala_code_node_unref0 (_tmp42_);
	_tmp43_ = self->priv->indent;
	self->priv->indent = _tmp43_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp44_ = self->priv->buffer;
	g_string_append_printf (_tmp44_, "</namespace>\n");
	_tmp45_ = self->priv->our_namespaces;
	bala_collection_add ((BalaCollection*) _tmp45_, ns);
	bala_gir_writer_visit_deferred (self);
	_g_free0 (csymbol_prefix);
	_g_free0 (cprefix);
}

static void
bala_gir_writer_write_symbol_attributes (BalaGIRWriter* self,
                                         BalaSymbol* symbol)
{
	BalaVersionAttribute* _tmp1_;
	BalaVersionAttribute* _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	BalaVersionAttribute* _tmp18_;
	BalaVersionAttribute* _tmp19_;
	gchar* _tmp20_;
	gchar* _tmp21_;
	gchar* _tmp22_;
	gboolean _tmp23_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (symbol != NULL);
	if (!bala_gir_writer_is_introspectable (self, symbol)) {
		GString* _tmp0_;
		_tmp0_ = self->priv->buffer;
		g_string_append_printf (_tmp0_, " introspectable=\"0\"");
	}
	_tmp1_ = bala_symbol_get_version (symbol);
	_tmp2_ = _tmp1_;
	_tmp3_ = bala_version_attribute_get_deprecated (_tmp2_);
	_tmp4_ = _tmp3_;
	if (_tmp4_) {
		GString* _tmp5_;
		BalaVersionAttribute* _tmp6_;
		BalaVersionAttribute* _tmp7_;
		gchar* _tmp8_;
		gchar* _tmp9_;
		gchar* _tmp10_;
		gboolean _tmp11_;
		_tmp5_ = self->priv->buffer;
		g_string_append_printf (_tmp5_, " deprecated=\"1\"");
		_tmp6_ = bala_symbol_get_version (symbol);
		_tmp7_ = _tmp6_;
		_tmp8_ = bala_version_attribute_get_deprecated_since (_tmp7_);
		_tmp9_ = _tmp8_;
		_tmp10_ = _tmp9_;
		_tmp11_ = _tmp10_ != NULL;
		_g_free0 (_tmp10_);
		if (_tmp11_) {
			GString* _tmp12_;
			BalaVersionAttribute* _tmp13_;
			BalaVersionAttribute* _tmp14_;
			gchar* _tmp15_;
			gchar* _tmp16_;
			gchar* _tmp17_;
			_tmp12_ = self->priv->buffer;
			_tmp13_ = bala_symbol_get_version (symbol);
			_tmp14_ = _tmp13_;
			_tmp15_ = bala_version_attribute_get_deprecated_since (_tmp14_);
			_tmp16_ = _tmp15_;
			_tmp17_ = _tmp16_;
			g_string_append_printf (_tmp12_, " deprecated-version=\"%s\"", _tmp17_);
			_g_free0 (_tmp17_);
		}
	}
	_tmp18_ = bala_symbol_get_version (symbol);
	_tmp19_ = _tmp18_;
	_tmp20_ = bala_version_attribute_get_since (_tmp19_);
	_tmp21_ = _tmp20_;
	_tmp22_ = _tmp21_;
	_tmp23_ = _tmp22_ != NULL;
	_g_free0 (_tmp22_);
	if (_tmp23_) {
		GString* _tmp24_;
		BalaVersionAttribute* _tmp25_;
		BalaVersionAttribute* _tmp26_;
		gchar* _tmp27_;
		gchar* _tmp28_;
		gchar* _tmp29_;
		_tmp24_ = self->priv->buffer;
		_tmp25_ = bala_symbol_get_version (symbol);
		_tmp26_ = _tmp25_;
		_tmp27_ = bala_version_attribute_get_since (_tmp26_);
		_tmp28_ = _tmp27_;
		_tmp29_ = _tmp28_;
		g_string_append_printf (_tmp24_, " version=\"%s\"", _tmp29_);
		_g_free0 (_tmp29_);
	}
}

static glong
string_strnlen (gchar* str,
                glong maxlen)
{
	gchar* end = NULL;
	gchar* _tmp0_;
	gchar* _tmp1_;
	glong result = 0L;
	_tmp0_ = memchr (str, 0, (gsize) maxlen);
	end = _tmp0_;
	_tmp1_ = end;
	if (_tmp1_ == NULL) {
		result = maxlen;
		return result;
	} else {
		gchar* _tmp2_;
		_tmp2_ = end;
		result = (glong) (_tmp2_ - str);
		return result;
	}
}

static gchar*
string_substring (const gchar* self,
                  glong offset,
                  glong len)
{
	glong string_length = 0L;
	gboolean _tmp0_ = FALSE;
	gchar* _tmp3_;
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	if (offset >= ((glong) 0)) {
		_tmp0_ = len >= ((glong) 0);
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		string_length = string_strnlen ((gchar*) self, offset + len);
	} else {
		gint _tmp1_;
		gint _tmp2_;
		_tmp1_ = strlen (self);
		_tmp2_ = _tmp1_;
		string_length = (glong) _tmp2_;
	}
	if (offset < ((glong) 0)) {
		offset = string_length + offset;
		g_return_val_if_fail (offset >= ((glong) 0), NULL);
	} else {
		g_return_val_if_fail (offset <= string_length, NULL);
	}
	if (len < ((glong) 0)) {
		len = string_length - offset;
	}
	g_return_val_if_fail ((offset + len) <= string_length, NULL);
	_tmp3_ = g_strndup (((gchar*) self) + offset, (gsize) len);
	result = _tmp3_;
	return result;
}

static void
bala_gir_writer_real_visit_class (BalaCodeVisitor* base,
                                  BalaClass* cl)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	BalaArrayList* _tmp2_;
	gpointer _tmp3_;
	BalaSymbol* _tmp4_;
	gboolean _tmp5_;
	gboolean _tmp7_;
	gboolean _tmp8_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (cl != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) cl);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) cl)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) cl)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = bala_list_get ((BalaList*) _tmp2_, 0);
	_tmp4_ = (BalaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, BALA_TYPE_NAMESPACE);
	_bala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		BalaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		bala_collection_add ((BalaCollection*) _tmp6_, (BalaCodeNode*) cl);
		return;
	}
	_tmp7_ = bala_class_get_is_compact (cl);
	_tmp8_ = _tmp7_;
	if (!_tmp8_) {
		gchar* gtype_struct_name = NULL;
		gchar* _tmp9_;
		gchar* _tmp10_;
		gchar* _tmp11_;
		gchar* _tmp12_;
		GString* _tmp13_;
		gchar* _tmp14_;
		gchar* _tmp15_;
		GString* _tmp16_;
		const gchar* _tmp17_;
		BalaClass* _tmp18_;
		BalaClass* _tmp19_;
		gboolean _tmp38_;
		gboolean _tmp39_;
		GString* _tmp41_;
		gint _tmp42_;
		gchar* _tmp43_;
		gchar* _tmp44_;
		GString* _tmp65_;
		gint _tmp66_;
		BalaClass* _tmp67_;
		BalaClass* _tmp68_;
		gint _tmp85_;
		GString* _tmp86_;
		BalaClass* _tmp87_;
		BalaClass* _tmp88_;
		BalaCodeContext* _tmp94_;
		gboolean _tmp95_;
		gboolean _tmp96_;
		gboolean _tmp106_ = FALSE;
		BalaClass* _tmp107_;
		BalaClass* _tmp108_;
		BalaArrayList* _tmp122_;
		BalaArrayList* _tmp123_;
		gpointer _tmp124_;
		BalaSymbol* _tmp125_;
		BalaCodeContext* _tmp126_;
		gboolean _tmp127_;
		gboolean _tmp128_;
		gint _tmp138_;
		GString* _tmp139_;
		GString* _tmp140_;
		const gchar* _tmp141_;
		GString* _tmp142_;
		gchar* _tmp143_;
		gchar* _tmp144_;
		GString* _tmp145_;
		gint _tmp146_;
		GString* _tmp147_;
		gint _tmp148_;
		BalaClass* _tmp149_;
		BalaClass* _tmp150_;
		gint _tmp164_;
		GString* _tmp165_;
		gint _tmp289_;
		GString* _tmp290_;
		GString* _tmp291_;
		gchar* _tmp292_;
		gchar* _tmp293_;
		gchar* _tmp294_;
		gchar* _tmp295_;
		_tmp9_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
		_tmp10_ = _tmp9_;
		_tmp11_ = g_strconcat (_tmp10_, "Class", NULL);
		_tmp12_ = _tmp11_;
		_g_free0 (_tmp10_);
		gtype_struct_name = _tmp12_;
		bala_gir_writer_write_indent (self);
		_tmp13_ = self->priv->buffer;
		_tmp14_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
		_tmp15_ = _tmp14_;
		g_string_append_printf (_tmp13_, "<class name=\"%s\"", _tmp15_);
		_g_free0 (_tmp15_);
		bala_gir_writer_write_gtype_attributes (self, (BalaTypeSymbol*) cl, TRUE);
		_tmp16_ = self->priv->buffer;
		_tmp17_ = gtype_struct_name;
		g_string_append_printf (_tmp16_, " glib:type-struct=\"%s\"", _tmp17_);
		_tmp18_ = bala_class_get_base_class (cl);
		_tmp19_ = _tmp18_;
		if (_tmp19_ == NULL) {
			GString* _tmp20_;
			GString* _tmp21_;
			gchar* _tmp22_;
			gchar* _tmp23_;
			GString* _tmp24_;
			gchar* _tmp25_;
			gchar* _tmp26_;
			GString* _tmp27_;
			gchar* _tmp28_;
			gchar* _tmp29_;
			GString* _tmp30_;
			gchar* _tmp31_;
			gchar* _tmp32_;
			_tmp20_ = self->priv->buffer;
			g_string_append_printf (_tmp20_, " glib:fundamental=\"1\"");
			_tmp21_ = self->priv->buffer;
			_tmp22_ = bala_get_ccode_ref_function ((BalaTypeSymbol*) cl);
			_tmp23_ = _tmp22_;
			g_string_append_printf (_tmp21_, " glib:ref-func=\"%s\"", _tmp23_);
			_g_free0 (_tmp23_);
			_tmp24_ = self->priv->buffer;
			_tmp25_ = bala_get_ccode_unref_function ((BalaObjectTypeSymbol*) cl);
			_tmp26_ = _tmp25_;
			g_string_append_printf (_tmp24_, " glib:unref-func=\"%s\"", _tmp26_);
			_g_free0 (_tmp26_);
			_tmp27_ = self->priv->buffer;
			_tmp28_ = bala_get_ccode_set_value_function ((BalaCodeNode*) cl);
			_tmp29_ = _tmp28_;
			g_string_append_printf (_tmp27_, " glib:set-value-func=\"%s\"", _tmp29_);
			_g_free0 (_tmp29_);
			_tmp30_ = self->priv->buffer;
			_tmp31_ = bala_get_ccode_get_value_function ((BalaCodeNode*) cl);
			_tmp32_ = _tmp31_;
			g_string_append_printf (_tmp30_, " glib:get-value-func=\"%s\"", _tmp32_);
			_g_free0 (_tmp32_);
		} else {
			GString* _tmp33_;
			BalaClass* _tmp34_;
			BalaClass* _tmp35_;
			gchar* _tmp36_;
			gchar* _tmp37_;
			_tmp33_ = self->priv->buffer;
			_tmp34_ = bala_class_get_base_class (cl);
			_tmp35_ = _tmp34_;
			_tmp36_ = bala_gir_writer_gi_type_name (self, (BalaTypeSymbol*) _tmp35_);
			_tmp37_ = _tmp36_;
			g_string_append_printf (_tmp33_, " parent=\"%s\"", _tmp37_);
			_g_free0 (_tmp37_);
		}
		_tmp38_ = bala_class_get_is_abstract (cl);
		_tmp39_ = _tmp38_;
		if (_tmp39_) {
			GString* _tmp40_;
			_tmp40_ = self->priv->buffer;
			g_string_append_printf (_tmp40_, " abstract=\"1\"");
		}
		bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) cl);
		_tmp41_ = self->priv->buffer;
		g_string_append_printf (_tmp41_, ">\n");
		_tmp42_ = self->priv->indent;
		self->priv->indent = _tmp42_ + 1;
		_tmp43_ = bala_gir_writer_get_class_comment (self, cl);
		_tmp44_ = _tmp43_;
		bala_gir_writer_write_doc (self, _tmp44_);
		_g_free0 (_tmp44_);
		{
			BalaList* _base_type_list = NULL;
			BalaList* _tmp45_;
			BalaList* _tmp46_;
			gint _base_type_size = 0;
			BalaList* _tmp47_;
			gint _tmp48_;
			gint _tmp49_;
			gint _base_type_index = 0;
			_tmp45_ = bala_class_get_base_types (cl);
			_tmp46_ = _bala_iterable_ref0 (_tmp45_);
			_base_type_list = _tmp46_;
			_tmp47_ = _base_type_list;
			_tmp48_ = bala_collection_get_size ((BalaCollection*) _tmp47_);
			_tmp49_ = _tmp48_;
			_base_type_size = _tmp49_;
			_base_type_index = -1;
			while (TRUE) {
				gint _tmp50_;
				gint _tmp51_;
				BalaDataType* base_type = NULL;
				BalaList* _tmp52_;
				gpointer _tmp53_;
				BalaObjectType* object_type = NULL;
				BalaDataType* _tmp54_;
				BalaObjectType* _tmp55_;
				BalaObjectType* _tmp56_;
				BalaTypeSymbol* _tmp57_;
				BalaTypeSymbol* _tmp58_;
				_base_type_index = _base_type_index + 1;
				_tmp50_ = _base_type_index;
				_tmp51_ = _base_type_size;
				if (!(_tmp50_ < _tmp51_)) {
					break;
				}
				_tmp52_ = _base_type_list;
				_tmp53_ = bala_list_get (_tmp52_, _base_type_index);
				base_type = (BalaDataType*) _tmp53_;
				_tmp54_ = base_type;
				_tmp55_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp54_, BALA_TYPE_OBJECT_TYPE, BalaObjectType));
				object_type = _tmp55_;
				_tmp56_ = object_type;
				_tmp57_ = bala_data_type_get_type_symbol ((BalaDataType*) _tmp56_);
				_tmp58_ = _tmp57_;
				if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp58_, BALA_TYPE_INTERFACE)) {
					GString* _tmp59_;
					BalaObjectType* _tmp60_;
					BalaTypeSymbol* _tmp61_;
					BalaTypeSymbol* _tmp62_;
					gchar* _tmp63_;
					gchar* _tmp64_;
					bala_gir_writer_write_indent (self);
					_tmp59_ = self->priv->buffer;
					_tmp60_ = object_type;
					_tmp61_ = bala_data_type_get_type_symbol ((BalaDataType*) _tmp60_);
					_tmp62_ = _tmp61_;
					_tmp63_ = bala_gir_writer_gi_type_name (self, _tmp62_);
					_tmp64_ = _tmp63_;
					g_string_append_printf (_tmp59_, "<implements name=\"%s\"/>\n", _tmp64_);
					_g_free0 (_tmp64_);
				}
				_bala_code_node_unref0 (object_type);
				_bala_code_node_unref0 (base_type);
			}
			_bala_iterable_unref0 (_base_type_list);
		}
		bala_gir_writer_write_indent (self);
		_tmp65_ = self->priv->buffer;
		g_string_append_printf (_tmp65_, "<field name=\"parent_instance\" readable=\"0\" private=\"1\">\n");
		_tmp66_ = self->priv->indent;
		self->priv->indent = _tmp66_ + 1;
		bala_gir_writer_write_indent (self);
		_tmp67_ = bala_class_get_base_class (cl);
		_tmp68_ = _tmp67_;
		if (_tmp68_ == NULL) {
			GString* _tmp69_;
			BalaTypeSymbol* _tmp70_;
			gchar* _tmp71_;
			gchar* _tmp72_;
			BalaTypeSymbol* _tmp73_;
			gchar* _tmp74_;
			gchar* _tmp75_;
			_tmp69_ = self->priv->buffer;
			_tmp70_ = self->priv->gtypeinstance_type;
			_tmp71_ = bala_gir_writer_gi_type_name (self, _tmp70_);
			_tmp72_ = _tmp71_;
			_tmp73_ = self->priv->gtypeinstance_type;
			_tmp74_ = bala_get_ccode_name ((BalaCodeNode*) _tmp73_);
			_tmp75_ = _tmp74_;
			g_string_append_printf (_tmp69_, "<type name=\"%s\" c:type=\"%s\"/>\n", _tmp72_, _tmp75_);
			_g_free0 (_tmp75_);
			_g_free0 (_tmp72_);
		} else {
			GString* _tmp76_;
			BalaClass* _tmp77_;
			BalaClass* _tmp78_;
			gchar* _tmp79_;
			gchar* _tmp80_;
			BalaClass* _tmp81_;
			BalaClass* _tmp82_;
			gchar* _tmp83_;
			gchar* _tmp84_;
			_tmp76_ = self->priv->buffer;
			_tmp77_ = bala_class_get_base_class (cl);
			_tmp78_ = _tmp77_;
			_tmp79_ = bala_gir_writer_gi_type_name (self, (BalaTypeSymbol*) _tmp78_);
			_tmp80_ = _tmp79_;
			_tmp81_ = bala_class_get_base_class (cl);
			_tmp82_ = _tmp81_;
			_tmp83_ = bala_get_ccode_name ((BalaCodeNode*) _tmp82_);
			_tmp84_ = _tmp83_;
			g_string_append_printf (_tmp76_, "<type name=\"%s\" c:type=\"%s\"/>\n", _tmp80_, _tmp84_);
			_g_free0 (_tmp84_);
			_g_free0 (_tmp80_);
		}
		_tmp85_ = self->priv->indent;
		self->priv->indent = _tmp85_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp86_ = self->priv->buffer;
		g_string_append_printf (_tmp86_, "</field>\n");
		_tmp87_ = bala_class_get_base_class (cl);
		_tmp88_ = _tmp87_;
		if (_tmp88_ == NULL) {
			GString* _tmp89_;
			gint _tmp90_;
			GString* _tmp91_;
			gint _tmp92_;
			GString* _tmp93_;
			bala_gir_writer_write_indent (self);
			_tmp89_ = self->priv->buffer;
			g_string_append_printf (_tmp89_, "<field name=\"ref_count\">\n");
			_tmp90_ = self->priv->indent;
			self->priv->indent = _tmp90_ + 1;
			bala_gir_writer_write_indent (self);
			_tmp91_ = self->priv->buffer;
			g_string_append_printf (_tmp91_, "<type name=\"gint\" c:type=\"volatile int\"/>\n");
			_tmp92_ = self->priv->indent;
			self->priv->indent = _tmp92_ - 1;
			bala_gir_writer_write_indent (self);
			_tmp93_ = self->priv->buffer;
			g_string_append_printf (_tmp93_, "</field>\n");
		}
		_tmp94_ = self->priv->context;
		_tmp95_ = bala_code_context_get_abi_stability (_tmp94_);
		_tmp96_ = _tmp95_;
		if (!_tmp96_) {
			GString* _tmp97_;
			gint _tmp98_;
			GString* _tmp99_;
			gchar* _tmp100_;
			gchar* _tmp101_;
			gchar* _tmp102_;
			gchar* _tmp103_;
			gint _tmp104_;
			GString* _tmp105_;
			bala_gir_writer_write_indent (self);
			_tmp97_ = self->priv->buffer;
			g_string_append_printf (_tmp97_, "<field name=\"priv\" readable=\"0\" private=\"1\">\n");
			_tmp98_ = self->priv->indent;
			self->priv->indent = _tmp98_ + 1;
			bala_gir_writer_write_indent (self);
			_tmp99_ = self->priv->buffer;
			_tmp100_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
			_tmp101_ = _tmp100_;
			_tmp102_ = bala_get_ccode_name ((BalaCodeNode*) cl);
			_tmp103_ = _tmp102_;
			g_string_append_printf (_tmp99_, "<type name=\"%sPrivate\" c:type=\"%sPrivate*\"/>\n", _tmp101_, _tmp103_);
			_g_free0 (_tmp103_);
			_g_free0 (_tmp101_);
			_tmp104_ = self->priv->indent;
			self->priv->indent = _tmp104_ - 1;
			bala_gir_writer_write_indent (self);
			_tmp105_ = self->priv->buffer;
			g_string_append_printf (_tmp105_, "</field>\n");
		}
		_tmp107_ = bala_class_get_base_class (cl);
		_tmp108_ = _tmp107_;
		if (_tmp108_ != NULL) {
			BalaClass* _tmp109_;
			BalaClass* _tmp110_;
			BalaTypeSymbol* _tmp111_;
			_tmp109_ = bala_class_get_base_class (cl);
			_tmp110_ = _tmp109_;
			_tmp111_ = self->priv->gobject_type;
			_tmp106_ = bala_typesymbol_is_subtype_of ((BalaTypeSymbol*) _tmp110_, _tmp111_);
		} else {
			_tmp106_ = FALSE;
		}
		if (_tmp106_) {
			{
				BalaList* _p_list = NULL;
				BalaList* _tmp112_;
				BalaList* _tmp113_;
				gint _p_size = 0;
				BalaList* _tmp114_;
				gint _tmp115_;
				gint _tmp116_;
				gint _p_index = 0;
				_tmp112_ = bala_object_type_symbol_get_type_parameters ((BalaObjectTypeSymbol*) cl);
				_tmp113_ = _bala_iterable_ref0 (_tmp112_);
				_p_list = _tmp113_;
				_tmp114_ = _p_list;
				_tmp115_ = bala_collection_get_size ((BalaCollection*) _tmp114_);
				_tmp116_ = _tmp115_;
				_p_size = _tmp116_;
				_p_index = -1;
				while (TRUE) {
					gint _tmp117_;
					gint _tmp118_;
					BalaTypeParameter* p = NULL;
					BalaList* _tmp119_;
					gpointer _tmp120_;
					BalaTypeParameter* _tmp121_;
					_p_index = _p_index + 1;
					_tmp117_ = _p_index;
					_tmp118_ = _p_size;
					if (!(_tmp117_ < _tmp118_)) {
						break;
					}
					_tmp119_ = _p_list;
					_tmp120_ = bala_list_get (_tmp119_, _p_index);
					p = (BalaTypeParameter*) _tmp120_;
					_tmp121_ = p;
					bala_gir_writer_write_type_parameter (self, _tmp121_, "property");
					_bala_code_node_unref0 (p);
				}
				_bala_iterable_unref0 (_p_list);
			}
		}
		_tmp122_ = self->priv->hierarchy;
		bala_list_insert ((BalaList*) _tmp122_, 0, (BalaSymbol*) cl);
		bala_code_node_accept_children ((BalaCodeNode*) cl, (BalaCodeVisitor*) self);
		_tmp123_ = self->priv->hierarchy;
		_tmp124_ = bala_list_remove_at ((BalaList*) _tmp123_, 0);
		_tmp125_ = (BalaSymbol*) _tmp124_;
		_bala_code_node_unref0 (_tmp125_);
		_tmp126_ = self->priv->context;
		_tmp127_ = bala_code_context_get_abi_stability (_tmp126_);
		_tmp128_ = _tmp127_;
		if (_tmp128_) {
			GString* _tmp129_;
			gint _tmp130_;
			GString* _tmp131_;
			gchar* _tmp132_;
			gchar* _tmp133_;
			gchar* _tmp134_;
			gchar* _tmp135_;
			gint _tmp136_;
			GString* _tmp137_;
			bala_gir_writer_write_indent (self);
			_tmp129_ = self->priv->buffer;
			g_string_append_printf (_tmp129_, "<field name=\"priv\" readable=\"0\" private=\"1\">\n");
			_tmp130_ = self->priv->indent;
			self->priv->indent = _tmp130_ + 1;
			bala_gir_writer_write_indent (self);
			_tmp131_ = self->priv->buffer;
			_tmp132_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
			_tmp133_ = _tmp132_;
			_tmp134_ = bala_get_ccode_name ((BalaCodeNode*) cl);
			_tmp135_ = _tmp134_;
			g_string_append_printf (_tmp131_, "<type name=\"%sPrivate\" c:type=\"%sPrivate*\"/>\n", _tmp133_, _tmp135_);
			_g_free0 (_tmp135_);
			_g_free0 (_tmp133_);
			_tmp136_ = self->priv->indent;
			self->priv->indent = _tmp136_ - 1;
			bala_gir_writer_write_indent (self);
			_tmp137_ = self->priv->buffer;
			g_string_append_printf (_tmp137_, "</field>\n");
		}
		_tmp138_ = self->priv->indent;
		self->priv->indent = _tmp138_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp139_ = self->priv->buffer;
		g_string_append_printf (_tmp139_, "</class>\n");
		bala_gir_writer_write_indent (self);
		_tmp140_ = self->priv->buffer;
		_tmp141_ = gtype_struct_name;
		g_string_append_printf (_tmp140_, "<record name=\"%s\"", _tmp141_);
		bala_gir_writer_write_ctype_attributes (self, (BalaTypeSymbol*) cl, "Class", FALSE);
		_tmp142_ = self->priv->buffer;
		_tmp143_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
		_tmp144_ = _tmp143_;
		g_string_append_printf (_tmp142_, " glib:is-gtype-struct-for=\"%s\"", _tmp144_);
		_g_free0 (_tmp144_);
		_tmp145_ = self->priv->buffer;
		g_string_append_printf (_tmp145_, ">\n");
		_tmp146_ = self->priv->indent;
		self->priv->indent = _tmp146_ + 1;
		bala_gir_writer_write_indent (self);
		_tmp147_ = self->priv->buffer;
		g_string_append_printf (_tmp147_, "<field name=\"parent_class\" readable=\"0\" private=\"1\">\n");
		_tmp148_ = self->priv->indent;
		self->priv->indent = _tmp148_ + 1;
		bala_gir_writer_write_indent (self);
		_tmp149_ = bala_class_get_base_class (cl);
		_tmp150_ = _tmp149_;
		if (_tmp150_ == NULL) {
			GString* _tmp151_;
			BalaTypeSymbol* _tmp152_;
			gchar* _tmp153_;
			gchar* _tmp154_;
			_tmp151_ = self->priv->buffer;
			_tmp152_ = self->priv->gtype_type;
			_tmp153_ = bala_get_ccode_name ((BalaCodeNode*) _tmp152_);
			_tmp154_ = _tmp153_;
			g_string_append_printf (_tmp151_, "<type name=\"%sClass\" c:type=\"%sClass\"/>\n", "GObject.Type", _tmp154_);
			_g_free0 (_tmp154_);
		} else {
			GString* _tmp155_;
			BalaClass* _tmp156_;
			BalaClass* _tmp157_;
			gchar* _tmp158_;
			gchar* _tmp159_;
			BalaClass* _tmp160_;
			BalaClass* _tmp161_;
			gchar* _tmp162_;
			gchar* _tmp163_;
			_tmp155_ = self->priv->buffer;
			_tmp156_ = bala_class_get_base_class (cl);
			_tmp157_ = _tmp156_;
			_tmp158_ = bala_gir_writer_gi_type_name (self, (BalaTypeSymbol*) _tmp157_);
			_tmp159_ = _tmp158_;
			_tmp160_ = bala_class_get_base_class (cl);
			_tmp161_ = _tmp160_;
			_tmp162_ = bala_get_ccode_name ((BalaCodeNode*) _tmp161_);
			_tmp163_ = _tmp162_;
			g_string_append_printf (_tmp155_, "<type name=\"%sClass\" c:type=\"%sClass\"/>\n", _tmp159_, _tmp163_);
			_g_free0 (_tmp163_);
			_g_free0 (_tmp159_);
		}
		_tmp164_ = self->priv->indent;
		self->priv->indent = _tmp164_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp165_ = self->priv->buffer;
		g_string_append_printf (_tmp165_, "</field>\n");
		{
			BalaList* _m_list = NULL;
			BalaList* _tmp166_;
			BalaList* _tmp167_;
			gint _m_size = 0;
			BalaList* _tmp168_;
			gint _tmp169_;
			gint _tmp170_;
			gint _m_index = 0;
			_tmp166_ = bala_object_type_symbol_get_methods ((BalaObjectTypeSymbol*) cl);
			_tmp167_ = _bala_iterable_ref0 (_tmp166_);
			_m_list = _tmp167_;
			_tmp168_ = _m_list;
			_tmp169_ = bala_collection_get_size ((BalaCollection*) _tmp168_);
			_tmp170_ = _tmp169_;
			_m_size = _tmp170_;
			_m_index = -1;
			while (TRUE) {
				gint _tmp171_;
				gint _tmp172_;
				BalaMethod* m = NULL;
				BalaList* _tmp173_;
				gpointer _tmp174_;
				gboolean _tmp175_ = FALSE;
				BalaMethod* _tmp176_;
				gboolean _tmp177_;
				gboolean _tmp178_;
				_m_index = _m_index + 1;
				_tmp171_ = _m_index;
				_tmp172_ = _m_size;
				if (!(_tmp171_ < _tmp172_)) {
					break;
				}
				_tmp173_ = _m_list;
				_tmp174_ = bala_list_get (_tmp173_, _m_index);
				m = (BalaMethod*) _tmp174_;
				_tmp176_ = m;
				_tmp177_ = bala_method_get_is_abstract (_tmp176_);
				_tmp178_ = _tmp177_;
				if (_tmp178_) {
					_tmp175_ = TRUE;
				} else {
					BalaMethod* _tmp179_;
					gboolean _tmp180_;
					gboolean _tmp181_;
					_tmp179_ = m;
					_tmp180_ = bala_method_get_is_virtual (_tmp179_);
					_tmp181_ = _tmp180_;
					_tmp175_ = _tmp181_;
				}
				if (_tmp175_) {
					BalaMethod* _tmp182_;
					gboolean _tmp183_;
					gboolean _tmp184_;
					_tmp182_ = m;
					_tmp183_ = bala_method_get_coroutine (_tmp182_);
					_tmp184_ = _tmp183_;
					if (_tmp184_) {
						gchar* finish_name = NULL;
						BalaMethod* _tmp185_;
						const gchar* _tmp186_;
						const gchar* _tmp187_;
						gchar* _tmp188_;
						const gchar* _tmp189_;
						const gchar* _tmp197_;
						gchar* _tmp198_;
						GString* _tmp199_;
						BalaMethod* _tmp200_;
						const gchar* _tmp201_;
						const gchar* _tmp202_;
						BalaMethod* _tmp203_;
						GString* _tmp204_;
						gint _tmp205_;
						BalaMethod* _tmp206_;
						BalaMethod* _tmp207_;
						const gchar* _tmp208_;
						const gchar* _tmp209_;
						BalaMethod* _tmp210_;
						gchar* _tmp211_;
						gchar* _tmp212_;
						BalaMethod* _tmp213_;
						BalaList* _tmp214_;
						BalaList* _tmp215_;
						BalaVoidType* _tmp216_;
						BalaVoidType* _tmp217_;
						gint _tmp218_;
						GString* _tmp219_;
						GString* _tmp220_;
						const gchar* _tmp221_;
						BalaMethod* _tmp222_;
						GString* _tmp223_;
						gint _tmp224_;
						BalaMethod* _tmp225_;
						const gchar* _tmp226_;
						BalaMethod* _tmp227_;
						gchar* _tmp228_;
						gchar* _tmp229_;
						BalaMethod* _tmp230_;
						BalaList* _tmp231_;
						BalaList* _tmp232_;
						BalaMethod* _tmp233_;
						BalaDataType* _tmp234_;
						BalaDataType* _tmp235_;
						BalaMethod* _tmp236_;
						gboolean _tmp237_;
						gboolean _tmp238_;
						gint _tmp239_;
						GString* _tmp240_;
						_tmp185_ = m;
						_tmp186_ = bala_symbol_get_name ((BalaSymbol*) _tmp185_);
						_tmp187_ = _tmp186_;
						_tmp188_ = g_strdup (_tmp187_);
						finish_name = _tmp188_;
						_tmp189_ = finish_name;
						if (g_str_has_suffix (_tmp189_, "_async")) {
							const gchar* _tmp190_;
							const gchar* _tmp191_;
							gint _tmp192_;
							gint _tmp193_;
							gint _tmp194_;
							gint _tmp195_;
							gchar* _tmp196_;
							_tmp190_ = finish_name;
							_tmp191_ = finish_name;
							_tmp192_ = strlen (_tmp191_);
							_tmp193_ = _tmp192_;
							_tmp194_ = strlen ("_async");
							_tmp195_ = _tmp194_;
							_tmp196_ = string_substring (_tmp190_, (glong) 0, (glong) (_tmp193_ - _tmp195_));
							_g_free0 (finish_name);
							finish_name = _tmp196_;
						}
						_tmp197_ = finish_name;
						_tmp198_ = g_strconcat (_tmp197_, "_finish", NULL);
						_g_free0 (finish_name);
						finish_name = _tmp198_;
						bala_gir_writer_write_indent (self);
						_tmp199_ = self->priv->buffer;
						_tmp200_ = m;
						_tmp201_ = bala_symbol_get_name ((BalaSymbol*) _tmp200_);
						_tmp202_ = _tmp201_;
						g_string_append_printf (_tmp199_, "<field name=\"%s\"", _tmp202_);
						_tmp203_ = m;
						bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp203_);
						_tmp204_ = self->priv->buffer;
						g_string_append_printf (_tmp204_, ">\n");
						_tmp205_ = self->priv->indent;
						self->priv->indent = _tmp205_ + 1;
						_tmp206_ = m;
						_tmp207_ = m;
						_tmp208_ = bala_symbol_get_name ((BalaSymbol*) _tmp207_);
						_tmp209_ = _tmp208_;
						_tmp210_ = m;
						_tmp211_ = bala_get_ccode_name ((BalaCodeNode*) _tmp210_);
						_tmp212_ = _tmp211_;
						_tmp213_ = m;
						_tmp214_ = bala_method_get_async_begin_parameters (_tmp213_);
						_tmp215_ = _tmp214_;
						_tmp216_ = bala_void_type_new (NULL);
						_tmp217_ = _tmp216_;
						bala_gir_writer_do_write_signature (self, _tmp206_, "callback", TRUE, _tmp209_, _tmp212_, _tmp215_, (BalaDataType*) _tmp217_, FALSE, FALSE, FALSE);
						_bala_code_node_unref0 (_tmp217_);
						_bala_iterable_unref0 (_tmp215_);
						_g_free0 (_tmp212_);
						_tmp218_ = self->priv->indent;
						self->priv->indent = _tmp218_ - 1;
						bala_gir_writer_write_indent (self);
						_tmp219_ = self->priv->buffer;
						g_string_append_printf (_tmp219_, "</field>\n");
						bala_gir_writer_write_indent (self);
						_tmp220_ = self->priv->buffer;
						_tmp221_ = finish_name;
						g_string_append_printf (_tmp220_, "<field name=\"%s\"", _tmp221_);
						_tmp222_ = m;
						bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp222_);
						_tmp223_ = self->priv->buffer;
						g_string_append_printf (_tmp223_, ">\n");
						_tmp224_ = self->priv->indent;
						self->priv->indent = _tmp224_ + 1;
						_tmp225_ = m;
						_tmp226_ = finish_name;
						_tmp227_ = m;
						_tmp228_ = bala_get_ccode_finish_name (_tmp227_);
						_tmp229_ = _tmp228_;
						_tmp230_ = m;
						_tmp231_ = bala_method_get_async_end_parameters (_tmp230_);
						_tmp232_ = _tmp231_;
						_tmp233_ = m;
						_tmp234_ = bala_callable_get_return_type ((BalaCallable*) _tmp233_);
						_tmp235_ = _tmp234_;
						_tmp236_ = m;
						_tmp237_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) _tmp236_);
						_tmp238_ = _tmp237_;
						bala_gir_writer_do_write_signature (self, _tmp225_, "callback", TRUE, _tmp226_, _tmp229_, _tmp232_, _tmp235_, _tmp238_, FALSE, FALSE);
						_bala_iterable_unref0 (_tmp232_);
						_g_free0 (_tmp229_);
						_tmp239_ = self->priv->indent;
						self->priv->indent = _tmp239_ - 1;
						bala_gir_writer_write_indent (self);
						_tmp240_ = self->priv->buffer;
						g_string_append_printf (_tmp240_, "</field>\n");
						_g_free0 (finish_name);
					} else {
						GString* _tmp241_;
						BalaMethod* _tmp242_;
						const gchar* _tmp243_;
						const gchar* _tmp244_;
						BalaMethod* _tmp245_;
						GString* _tmp246_;
						gint _tmp247_;
						BalaMethod* _tmp248_;
						BalaMethod* _tmp249_;
						const gchar* _tmp250_;
						const gchar* _tmp251_;
						BalaMethod* _tmp252_;
						gchar* _tmp253_;
						gchar* _tmp254_;
						BalaMethod* _tmp255_;
						BalaList* _tmp256_;
						BalaMethod* _tmp257_;
						BalaDataType* _tmp258_;
						BalaDataType* _tmp259_;
						BalaMethod* _tmp260_;
						gboolean _tmp261_;
						gboolean _tmp262_;
						gint _tmp263_;
						GString* _tmp264_;
						bala_gir_writer_write_indent (self);
						_tmp241_ = self->priv->buffer;
						_tmp242_ = m;
						_tmp243_ = bala_symbol_get_name ((BalaSymbol*) _tmp242_);
						_tmp244_ = _tmp243_;
						g_string_append_printf (_tmp241_, "<field name=\"%s\"", _tmp244_);
						_tmp245_ = m;
						bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp245_);
						_tmp246_ = self->priv->buffer;
						g_string_append_printf (_tmp246_, ">\n");
						_tmp247_ = self->priv->indent;
						self->priv->indent = _tmp247_ + 1;
						_tmp248_ = m;
						_tmp249_ = m;
						_tmp250_ = bala_symbol_get_name ((BalaSymbol*) _tmp249_);
						_tmp251_ = _tmp250_;
						_tmp252_ = m;
						_tmp253_ = bala_get_ccode_name ((BalaCodeNode*) _tmp252_);
						_tmp254_ = _tmp253_;
						_tmp255_ = m;
						_tmp256_ = bala_callable_get_parameters ((BalaCallable*) _tmp255_);
						_tmp257_ = m;
						_tmp258_ = bala_callable_get_return_type ((BalaCallable*) _tmp257_);
						_tmp259_ = _tmp258_;
						_tmp260_ = m;
						_tmp261_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) _tmp260_);
						_tmp262_ = _tmp261_;
						bala_gir_writer_do_write_signature (self, _tmp248_, "callback", TRUE, _tmp251_, _tmp254_, _tmp256_, _tmp259_, _tmp262_, FALSE, FALSE);
						_g_free0 (_tmp254_);
						_tmp263_ = self->priv->indent;
						self->priv->indent = _tmp263_ - 1;
						bala_gir_writer_write_indent (self);
						_tmp264_ = self->priv->buffer;
						g_string_append_printf (_tmp264_, "</field>\n");
					}
				}
				_bala_code_node_unref0 (m);
			}
			_bala_iterable_unref0 (_m_list);
		}
		{
			BalaList* _sig_list = NULL;
			BalaList* _tmp265_;
			BalaList* _tmp266_;
			gint _sig_size = 0;
			BalaList* _tmp267_;
			gint _tmp268_;
			gint _tmp269_;
			gint _sig_index = 0;
			_tmp265_ = bala_object_type_symbol_get_signals ((BalaObjectTypeSymbol*) cl);
			_tmp266_ = _bala_iterable_ref0 (_tmp265_);
			_sig_list = _tmp266_;
			_tmp267_ = _sig_list;
			_tmp268_ = bala_collection_get_size ((BalaCollection*) _tmp267_);
			_tmp269_ = _tmp268_;
			_sig_size = _tmp269_;
			_sig_index = -1;
			while (TRUE) {
				gint _tmp270_;
				gint _tmp271_;
				BalaSignal* sig = NULL;
				BalaList* _tmp272_;
				gpointer _tmp273_;
				BalaSignal* _tmp274_;
				BalaMethod* _tmp275_;
				BalaMethod* _tmp276_;
				_sig_index = _sig_index + 1;
				_tmp270_ = _sig_index;
				_tmp271_ = _sig_size;
				if (!(_tmp270_ < _tmp271_)) {
					break;
				}
				_tmp272_ = _sig_list;
				_tmp273_ = bala_list_get (_tmp272_, _sig_index);
				sig = (BalaSignal*) _tmp273_;
				_tmp274_ = sig;
				_tmp275_ = bala_signal_get_default_handler (_tmp274_);
				_tmp276_ = _tmp275_;
				if (_tmp276_ != NULL) {
					GString* _tmp277_;
					BalaSignal* _tmp278_;
					gchar* _tmp279_;
					gchar* _tmp280_;
					BalaSignal* _tmp281_;
					GString* _tmp282_;
					gint _tmp283_;
					BalaSignal* _tmp284_;
					BalaMethod* _tmp285_;
					BalaMethod* _tmp286_;
					gint _tmp287_;
					GString* _tmp288_;
					bala_gir_writer_write_indent (self);
					_tmp277_ = self->priv->buffer;
					_tmp278_ = sig;
					_tmp279_ = bala_get_ccode_lower_case_name ((BalaCodeNode*) _tmp278_, NULL);
					_tmp280_ = _tmp279_;
					g_string_append_printf (_tmp277_, "<field name=\"%s\"", _tmp280_);
					_g_free0 (_tmp280_);
					_tmp281_ = sig;
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp281_);
					_tmp282_ = self->priv->buffer;
					g_string_append_printf (_tmp282_, ">\n");
					_tmp283_ = self->priv->indent;
					self->priv->indent = _tmp283_ + 1;
					_tmp284_ = sig;
					_tmp285_ = bala_signal_get_default_handler (_tmp284_);
					_tmp286_ = _tmp285_;
					bala_gir_writer_write_signature (self, _tmp286_, "callback", FALSE, TRUE, FALSE);
					_tmp287_ = self->priv->indent;
					self->priv->indent = _tmp287_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp288_ = self->priv->buffer;
					g_string_append_printf (_tmp288_, "</field>\n");
				}
				_bala_code_node_unref0 (sig);
			}
			_bala_iterable_unref0 (_sig_list);
		}
		_tmp289_ = self->priv->indent;
		self->priv->indent = _tmp289_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp290_ = self->priv->buffer;
		g_string_append_printf (_tmp290_, "</record>\n");
		bala_gir_writer_write_indent (self);
		_tmp291_ = self->priv->buffer;
		_tmp292_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
		_tmp293_ = _tmp292_;
		_tmp294_ = bala_get_ccode_name ((BalaCodeNode*) cl);
		_tmp295_ = _tmp294_;
		g_string_append_printf (_tmp291_, "<record name=\"%sPrivate\" c:type=\"%sPrivate\" disguised=\"1\"/>\n", _tmp293_, _tmp295_);
		_g_free0 (_tmp295_);
		_g_free0 (_tmp293_);
		_g_free0 (gtype_struct_name);
	} else {
		GString* _tmp296_;
		gchar* _tmp297_;
		gchar* _tmp298_;
		GString* _tmp299_;
		gint _tmp300_;
		gchar* _tmp301_;
		gchar* _tmp302_;
		BalaArrayList* _tmp303_;
		BalaArrayList* _tmp304_;
		gpointer _tmp305_;
		BalaSymbol* _tmp306_;
		gint _tmp307_;
		GString* _tmp308_;
		bala_gir_writer_write_indent (self);
		_tmp296_ = self->priv->buffer;
		_tmp297_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) cl);
		_tmp298_ = _tmp297_;
		g_string_append_printf (_tmp296_, "<record name=\"%s\"", _tmp298_);
		_g_free0 (_tmp298_);
		bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) cl);
		_tmp299_ = self->priv->buffer;
		g_string_append_printf (_tmp299_, ">\n");
		_tmp300_ = self->priv->indent;
		self->priv->indent = _tmp300_ + 1;
		_tmp301_ = bala_gir_writer_get_class_comment (self, cl);
		_tmp302_ = _tmp301_;
		bala_gir_writer_write_doc (self, _tmp302_);
		_g_free0 (_tmp302_);
		_tmp303_ = self->priv->hierarchy;
		bala_list_insert ((BalaList*) _tmp303_, 0, (BalaSymbol*) cl);
		bala_code_node_accept_children ((BalaCodeNode*) cl, (BalaCodeVisitor*) self);
		_tmp304_ = self->priv->hierarchy;
		_tmp305_ = bala_list_remove_at ((BalaList*) _tmp304_, 0);
		_tmp306_ = (BalaSymbol*) _tmp305_;
		_bala_code_node_unref0 (_tmp306_);
		_tmp307_ = self->priv->indent;
		self->priv->indent = _tmp307_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp308_ = self->priv->buffer;
		g_string_append_printf (_tmp308_, "</record>\n");
	}
	bala_gir_writer_visit_deferred (self);
}

static void
bala_gir_writer_real_visit_struct (BalaCodeVisitor* base,
                                   BalaStruct* st)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	BalaArrayList* _tmp2_;
	gpointer _tmp3_;
	BalaSymbol* _tmp4_;
	gboolean _tmp5_;
	GString* _tmp7_;
	gchar* _tmp8_;
	gchar* _tmp9_;
	GString* _tmp10_;
	gint _tmp11_;
	gchar* _tmp12_;
	gchar* _tmp13_;
	BalaArrayList* _tmp14_;
	BalaArrayList* _tmp15_;
	gpointer _tmp16_;
	BalaSymbol* _tmp17_;
	gint _tmp18_;
	GString* _tmp19_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (st != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) st);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) st)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) st)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = bala_list_get ((BalaList*) _tmp2_, 0);
	_tmp4_ = (BalaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, BALA_TYPE_NAMESPACE);
	_bala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		BalaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		bala_collection_add ((BalaCollection*) _tmp6_, (BalaCodeNode*) st);
		return;
	}
	bala_gir_writer_write_indent (self);
	_tmp7_ = self->priv->buffer;
	_tmp8_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) st);
	_tmp9_ = _tmp8_;
	g_string_append_printf (_tmp7_, "<record name=\"%s\"", _tmp9_);
	_g_free0 (_tmp9_);
	if (bala_get_ccode_has_type_id ((BalaTypeSymbol*) st)) {
		bala_gir_writer_write_gtype_attributes (self, (BalaTypeSymbol*) st, TRUE);
	} else {
		bala_gir_writer_write_ctype_attributes (self, (BalaTypeSymbol*) st, "", TRUE);
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) st);
	_tmp10_ = self->priv->buffer;
	g_string_append_printf (_tmp10_, ">\n");
	_tmp11_ = self->priv->indent;
	self->priv->indent = _tmp11_ + 1;
	_tmp12_ = bala_gir_writer_get_struct_comment (self, st);
	_tmp13_ = _tmp12_;
	bala_gir_writer_write_doc (self, _tmp13_);
	_g_free0 (_tmp13_);
	_tmp14_ = self->priv->hierarchy;
	bala_list_insert ((BalaList*) _tmp14_, 0, (BalaSymbol*) st);
	bala_code_node_accept_children ((BalaCodeNode*) st, (BalaCodeVisitor*) self);
	_tmp15_ = self->priv->hierarchy;
	_tmp16_ = bala_list_remove_at ((BalaList*) _tmp15_, 0);
	_tmp17_ = (BalaSymbol*) _tmp16_;
	_bala_code_node_unref0 (_tmp17_);
	_tmp18_ = self->priv->indent;
	self->priv->indent = _tmp18_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp19_ = self->priv->buffer;
	g_string_append_printf (_tmp19_, "</record>\n");
	bala_gir_writer_visit_deferred (self);
}

static void
bala_gir_writer_real_visit_interface (BalaCodeVisitor* base,
                                      BalaInterface* iface)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	BalaArrayList* _tmp2_;
	gpointer _tmp3_;
	BalaSymbol* _tmp4_;
	gboolean _tmp5_;
	gchar* gtype_struct_name = NULL;
	gchar* _tmp7_;
	gchar* _tmp8_;
	gchar* _tmp9_;
	gchar* _tmp10_;
	GString* _tmp11_;
	gchar* _tmp12_;
	gchar* _tmp13_;
	GString* _tmp14_;
	const gchar* _tmp15_;
	GString* _tmp16_;
	gint _tmp17_;
	gchar* _tmp18_;
	gchar* _tmp19_;
	BalaList* _tmp20_;
	gint _tmp21_;
	gint _tmp22_;
	BalaArrayList* _tmp38_;
	BalaArrayList* _tmp39_;
	gpointer _tmp40_;
	BalaSymbol* _tmp41_;
	gint _tmp42_;
	GString* _tmp43_;
	GString* _tmp44_;
	const gchar* _tmp45_;
	GString* _tmp46_;
	gchar* _tmp47_;
	gchar* _tmp48_;
	GString* _tmp49_;
	gint _tmp50_;
	GString* _tmp51_;
	gint _tmp52_;
	GString* _tmp53_;
	BalaTypeSymbol* _tmp54_;
	gchar* _tmp55_;
	gchar* _tmp56_;
	BalaTypeSymbol* _tmp57_;
	gchar* _tmp58_;
	gchar* _tmp59_;
	gint _tmp60_;
	GString* _tmp61_;
	gint _tmp245_;
	GString* _tmp246_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (iface != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) iface);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) iface)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) iface)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = bala_list_get ((BalaList*) _tmp2_, 0);
	_tmp4_ = (BalaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, BALA_TYPE_NAMESPACE);
	_bala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		BalaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		bala_collection_add ((BalaCollection*) _tmp6_, (BalaCodeNode*) iface);
		return;
	}
	_tmp7_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) iface);
	_tmp8_ = _tmp7_;
	_tmp9_ = g_strconcat (_tmp8_, "Iface", NULL);
	_tmp10_ = _tmp9_;
	_g_free0 (_tmp8_);
	gtype_struct_name = _tmp10_;
	bala_gir_writer_write_indent (self);
	_tmp11_ = self->priv->buffer;
	_tmp12_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) iface);
	_tmp13_ = _tmp12_;
	g_string_append_printf (_tmp11_, "<interface name=\"%s\"", _tmp13_);
	_g_free0 (_tmp13_);
	bala_gir_writer_write_gtype_attributes (self, (BalaTypeSymbol*) iface, TRUE);
	_tmp14_ = self->priv->buffer;
	_tmp15_ = gtype_struct_name;
	g_string_append_printf (_tmp14_, " glib:type-struct=\"%s\"", _tmp15_);
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) iface);
	_tmp16_ = self->priv->buffer;
	g_string_append_printf (_tmp16_, ">\n");
	_tmp17_ = self->priv->indent;
	self->priv->indent = _tmp17_ + 1;
	_tmp18_ = bala_gir_writer_get_interface_comment (self, iface);
	_tmp19_ = _tmp18_;
	bala_gir_writer_write_doc (self, _tmp19_);
	_g_free0 (_tmp19_);
	_tmp20_ = bala_interface_get_prerequisites (iface);
	_tmp21_ = bala_collection_get_size ((BalaCollection*) _tmp20_);
	_tmp22_ = _tmp21_;
	if (_tmp22_ > 0) {
		{
			BalaList* _base_type_list = NULL;
			BalaList* _tmp23_;
			BalaList* _tmp24_;
			gint _base_type_size = 0;
			BalaList* _tmp25_;
			gint _tmp26_;
			gint _tmp27_;
			gint _base_type_index = 0;
			_tmp23_ = bala_interface_get_prerequisites (iface);
			_tmp24_ = _bala_iterable_ref0 (_tmp23_);
			_base_type_list = _tmp24_;
			_tmp25_ = _base_type_list;
			_tmp26_ = bala_collection_get_size ((BalaCollection*) _tmp25_);
			_tmp27_ = _tmp26_;
			_base_type_size = _tmp27_;
			_base_type_index = -1;
			while (TRUE) {
				gint _tmp28_;
				gint _tmp29_;
				BalaDataType* base_type = NULL;
				BalaList* _tmp30_;
				gpointer _tmp31_;
				GString* _tmp32_;
				BalaDataType* _tmp33_;
				BalaTypeSymbol* _tmp34_;
				BalaTypeSymbol* _tmp35_;
				gchar* _tmp36_;
				gchar* _tmp37_;
				_base_type_index = _base_type_index + 1;
				_tmp28_ = _base_type_index;
				_tmp29_ = _base_type_size;
				if (!(_tmp28_ < _tmp29_)) {
					break;
				}
				_tmp30_ = _base_type_list;
				_tmp31_ = bala_list_get (_tmp30_, _base_type_index);
				base_type = (BalaDataType*) _tmp31_;
				bala_gir_writer_write_indent (self);
				_tmp32_ = self->priv->buffer;
				_tmp33_ = base_type;
				_tmp34_ = bala_data_type_get_type_symbol ((BalaDataType*) G_TYPE_CHECK_INSTANCE_CAST (_tmp33_, BALA_TYPE_OBJECT_TYPE, BalaObjectType));
				_tmp35_ = _tmp34_;
				_tmp36_ = bala_gir_writer_gi_type_name (self, _tmp35_);
				_tmp37_ = _tmp36_;
				g_string_append_printf (_tmp32_, "<prerequisite name=\"%s\"/>\n", _tmp37_);
				_g_free0 (_tmp37_);
				_bala_code_node_unref0 (base_type);
			}
			_bala_iterable_unref0 (_base_type_list);
		}
	}
	_tmp38_ = self->priv->hierarchy;
	bala_list_insert ((BalaList*) _tmp38_, 0, (BalaSymbol*) iface);
	bala_code_node_accept_children ((BalaCodeNode*) iface, (BalaCodeVisitor*) self);
	_tmp39_ = self->priv->hierarchy;
	_tmp40_ = bala_list_remove_at ((BalaList*) _tmp39_, 0);
	_tmp41_ = (BalaSymbol*) _tmp40_;
	_bala_code_node_unref0 (_tmp41_);
	_tmp42_ = self->priv->indent;
	self->priv->indent = _tmp42_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp43_ = self->priv->buffer;
	g_string_append_printf (_tmp43_, "</interface>\n");
	bala_gir_writer_write_indent (self);
	_tmp44_ = self->priv->buffer;
	_tmp45_ = gtype_struct_name;
	g_string_append_printf (_tmp44_, "<record name=\"%s\"", _tmp45_);
	bala_gir_writer_write_ctype_attributes (self, (BalaTypeSymbol*) iface, "Iface", FALSE);
	_tmp46_ = self->priv->buffer;
	_tmp47_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) iface);
	_tmp48_ = _tmp47_;
	g_string_append_printf (_tmp46_, " glib:is-gtype-struct-for=\"%s\"", _tmp48_);
	_g_free0 (_tmp48_);
	_tmp49_ = self->priv->buffer;
	g_string_append_printf (_tmp49_, ">\n");
	_tmp50_ = self->priv->indent;
	self->priv->indent = _tmp50_ + 1;
	bala_gir_writer_write_indent (self);
	_tmp51_ = self->priv->buffer;
	g_string_append_printf (_tmp51_, "<field name=\"parent_iface\" readable=\"0\" private=\"1\">\n");
	_tmp52_ = self->priv->indent;
	self->priv->indent = _tmp52_ + 1;
	bala_gir_writer_write_indent (self);
	_tmp53_ = self->priv->buffer;
	_tmp54_ = self->priv->gtypeinterface_type;
	_tmp55_ = bala_gir_writer_gi_type_name (self, _tmp54_);
	_tmp56_ = _tmp55_;
	_tmp57_ = self->priv->gtypeinterface_type;
	_tmp58_ = bala_get_ccode_name ((BalaCodeNode*) _tmp57_);
	_tmp59_ = _tmp58_;
	g_string_append_printf (_tmp53_, "<type name=\"%s\" c:type=\"%s\"/>\n", _tmp56_, _tmp59_);
	_g_free0 (_tmp59_);
	_g_free0 (_tmp56_);
	_tmp60_ = self->priv->indent;
	self->priv->indent = _tmp60_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp61_ = self->priv->buffer;
	g_string_append_printf (_tmp61_, "</field>\n");
	{
		BalaList* _m_list = NULL;
		BalaList* _tmp62_;
		BalaList* _tmp63_;
		gint _m_size = 0;
		BalaList* _tmp64_;
		gint _tmp65_;
		gint _tmp66_;
		gint _m_index = 0;
		_tmp62_ = bala_object_type_symbol_get_methods ((BalaObjectTypeSymbol*) iface);
		_tmp63_ = _bala_iterable_ref0 (_tmp62_);
		_m_list = _tmp63_;
		_tmp64_ = _m_list;
		_tmp65_ = bala_collection_get_size ((BalaCollection*) _tmp64_);
		_tmp66_ = _tmp65_;
		_m_size = _tmp66_;
		_m_index = -1;
		while (TRUE) {
			gint _tmp67_;
			gint _tmp68_;
			BalaMethod* m = NULL;
			BalaList* _tmp69_;
			gpointer _tmp70_;
			gboolean _tmp71_ = FALSE;
			BalaMethod* _tmp72_;
			gboolean _tmp73_;
			gboolean _tmp74_;
			_m_index = _m_index + 1;
			_tmp67_ = _m_index;
			_tmp68_ = _m_size;
			if (!(_tmp67_ < _tmp68_)) {
				break;
			}
			_tmp69_ = _m_list;
			_tmp70_ = bala_list_get (_tmp69_, _m_index);
			m = (BalaMethod*) _tmp70_;
			_tmp72_ = m;
			_tmp73_ = bala_method_get_is_abstract (_tmp72_);
			_tmp74_ = _tmp73_;
			if (_tmp74_) {
				_tmp71_ = TRUE;
			} else {
				BalaMethod* _tmp75_;
				gboolean _tmp76_;
				gboolean _tmp77_;
				_tmp75_ = m;
				_tmp76_ = bala_method_get_is_virtual (_tmp75_);
				_tmp77_ = _tmp76_;
				_tmp71_ = _tmp77_;
			}
			if (_tmp71_) {
				BalaMethod* _tmp78_;
				gboolean _tmp79_;
				gboolean _tmp80_;
				_tmp78_ = m;
				_tmp79_ = bala_method_get_coroutine (_tmp78_);
				_tmp80_ = _tmp79_;
				if (_tmp80_) {
					gchar* finish_name = NULL;
					BalaMethod* _tmp81_;
					const gchar* _tmp82_;
					const gchar* _tmp83_;
					gchar* _tmp84_;
					const gchar* _tmp85_;
					const gchar* _tmp93_;
					gchar* _tmp94_;
					GString* _tmp95_;
					BalaMethod* _tmp96_;
					const gchar* _tmp97_;
					const gchar* _tmp98_;
					BalaMethod* _tmp99_;
					GString* _tmp100_;
					gint _tmp101_;
					BalaMethod* _tmp102_;
					BalaMethod* _tmp103_;
					const gchar* _tmp104_;
					const gchar* _tmp105_;
					BalaMethod* _tmp106_;
					gchar* _tmp107_;
					gchar* _tmp108_;
					BalaMethod* _tmp109_;
					BalaList* _tmp110_;
					BalaList* _tmp111_;
					BalaVoidType* _tmp112_;
					BalaVoidType* _tmp113_;
					gint _tmp114_;
					GString* _tmp115_;
					GString* _tmp116_;
					const gchar* _tmp117_;
					BalaMethod* _tmp118_;
					GString* _tmp119_;
					gint _tmp120_;
					BalaMethod* _tmp121_;
					const gchar* _tmp122_;
					BalaMethod* _tmp123_;
					gchar* _tmp124_;
					gchar* _tmp125_;
					BalaMethod* _tmp126_;
					BalaList* _tmp127_;
					BalaList* _tmp128_;
					BalaMethod* _tmp129_;
					BalaDataType* _tmp130_;
					BalaDataType* _tmp131_;
					BalaMethod* _tmp132_;
					gboolean _tmp133_;
					gboolean _tmp134_;
					gint _tmp135_;
					GString* _tmp136_;
					_tmp81_ = m;
					_tmp82_ = bala_symbol_get_name ((BalaSymbol*) _tmp81_);
					_tmp83_ = _tmp82_;
					_tmp84_ = g_strdup (_tmp83_);
					finish_name = _tmp84_;
					_tmp85_ = finish_name;
					if (g_str_has_suffix (_tmp85_, "_async")) {
						const gchar* _tmp86_;
						const gchar* _tmp87_;
						gint _tmp88_;
						gint _tmp89_;
						gint _tmp90_;
						gint _tmp91_;
						gchar* _tmp92_;
						_tmp86_ = finish_name;
						_tmp87_ = finish_name;
						_tmp88_ = strlen (_tmp87_);
						_tmp89_ = _tmp88_;
						_tmp90_ = strlen ("_async");
						_tmp91_ = _tmp90_;
						_tmp92_ = string_substring (_tmp86_, (glong) 0, (glong) (_tmp89_ - _tmp91_));
						_g_free0 (finish_name);
						finish_name = _tmp92_;
					}
					_tmp93_ = finish_name;
					_tmp94_ = g_strconcat (_tmp93_, "_finish", NULL);
					_g_free0 (finish_name);
					finish_name = _tmp94_;
					bala_gir_writer_write_indent (self);
					_tmp95_ = self->priv->buffer;
					_tmp96_ = m;
					_tmp97_ = bala_symbol_get_name ((BalaSymbol*) _tmp96_);
					_tmp98_ = _tmp97_;
					g_string_append_printf (_tmp95_, "<field name=\"%s\"", _tmp98_);
					_tmp99_ = m;
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp99_);
					_tmp100_ = self->priv->buffer;
					g_string_append_printf (_tmp100_, ">\n");
					_tmp101_ = self->priv->indent;
					self->priv->indent = _tmp101_ + 1;
					_tmp102_ = m;
					_tmp103_ = m;
					_tmp104_ = bala_symbol_get_name ((BalaSymbol*) _tmp103_);
					_tmp105_ = _tmp104_;
					_tmp106_ = m;
					_tmp107_ = bala_get_ccode_name ((BalaCodeNode*) _tmp106_);
					_tmp108_ = _tmp107_;
					_tmp109_ = m;
					_tmp110_ = bala_method_get_async_begin_parameters (_tmp109_);
					_tmp111_ = _tmp110_;
					_tmp112_ = bala_void_type_new (NULL);
					_tmp113_ = _tmp112_;
					bala_gir_writer_do_write_signature (self, _tmp102_, "callback", TRUE, _tmp105_, _tmp108_, _tmp111_, (BalaDataType*) _tmp113_, FALSE, FALSE, FALSE);
					_bala_code_node_unref0 (_tmp113_);
					_bala_iterable_unref0 (_tmp111_);
					_g_free0 (_tmp108_);
					_tmp114_ = self->priv->indent;
					self->priv->indent = _tmp114_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp115_ = self->priv->buffer;
					g_string_append_printf (_tmp115_, "</field>\n");
					bala_gir_writer_write_indent (self);
					_tmp116_ = self->priv->buffer;
					_tmp117_ = finish_name;
					g_string_append_printf (_tmp116_, "<field name=\"%s\"", _tmp117_);
					_tmp118_ = m;
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp118_);
					_tmp119_ = self->priv->buffer;
					g_string_append_printf (_tmp119_, ">\n");
					_tmp120_ = self->priv->indent;
					self->priv->indent = _tmp120_ + 1;
					_tmp121_ = m;
					_tmp122_ = finish_name;
					_tmp123_ = m;
					_tmp124_ = bala_get_ccode_finish_name (_tmp123_);
					_tmp125_ = _tmp124_;
					_tmp126_ = m;
					_tmp127_ = bala_method_get_async_end_parameters (_tmp126_);
					_tmp128_ = _tmp127_;
					_tmp129_ = m;
					_tmp130_ = bala_callable_get_return_type ((BalaCallable*) _tmp129_);
					_tmp131_ = _tmp130_;
					_tmp132_ = m;
					_tmp133_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) _tmp132_);
					_tmp134_ = _tmp133_;
					bala_gir_writer_do_write_signature (self, _tmp121_, "callback", TRUE, _tmp122_, _tmp125_, _tmp128_, _tmp131_, _tmp134_, FALSE, FALSE);
					_bala_iterable_unref0 (_tmp128_);
					_g_free0 (_tmp125_);
					_tmp135_ = self->priv->indent;
					self->priv->indent = _tmp135_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp136_ = self->priv->buffer;
					g_string_append_printf (_tmp136_, "</field>\n");
					_g_free0 (finish_name);
				} else {
					GString* _tmp137_;
					BalaMethod* _tmp138_;
					const gchar* _tmp139_;
					const gchar* _tmp140_;
					BalaMethod* _tmp141_;
					GString* _tmp142_;
					gint _tmp143_;
					BalaMethod* _tmp144_;
					BalaMethod* _tmp145_;
					const gchar* _tmp146_;
					const gchar* _tmp147_;
					BalaMethod* _tmp148_;
					gchar* _tmp149_;
					gchar* _tmp150_;
					BalaMethod* _tmp151_;
					BalaList* _tmp152_;
					BalaMethod* _tmp153_;
					BalaDataType* _tmp154_;
					BalaDataType* _tmp155_;
					BalaMethod* _tmp156_;
					gboolean _tmp157_;
					gboolean _tmp158_;
					gint _tmp159_;
					GString* _tmp160_;
					bala_gir_writer_write_indent (self);
					_tmp137_ = self->priv->buffer;
					_tmp138_ = m;
					_tmp139_ = bala_symbol_get_name ((BalaSymbol*) _tmp138_);
					_tmp140_ = _tmp139_;
					g_string_append_printf (_tmp137_, "<field name=\"%s\"", _tmp140_);
					_tmp141_ = m;
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp141_);
					_tmp142_ = self->priv->buffer;
					g_string_append_printf (_tmp142_, ">\n");
					_tmp143_ = self->priv->indent;
					self->priv->indent = _tmp143_ + 1;
					_tmp144_ = m;
					_tmp145_ = m;
					_tmp146_ = bala_symbol_get_name ((BalaSymbol*) _tmp145_);
					_tmp147_ = _tmp146_;
					_tmp148_ = m;
					_tmp149_ = bala_get_ccode_name ((BalaCodeNode*) _tmp148_);
					_tmp150_ = _tmp149_;
					_tmp151_ = m;
					_tmp152_ = bala_callable_get_parameters ((BalaCallable*) _tmp151_);
					_tmp153_ = m;
					_tmp154_ = bala_callable_get_return_type ((BalaCallable*) _tmp153_);
					_tmp155_ = _tmp154_;
					_tmp156_ = m;
					_tmp157_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) _tmp156_);
					_tmp158_ = _tmp157_;
					bala_gir_writer_do_write_signature (self, _tmp144_, "callback", TRUE, _tmp147_, _tmp150_, _tmp152_, _tmp155_, _tmp158_, FALSE, FALSE);
					_g_free0 (_tmp150_);
					_tmp159_ = self->priv->indent;
					self->priv->indent = _tmp159_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp160_ = self->priv->buffer;
					g_string_append_printf (_tmp160_, "</field>\n");
				}
			}
			_bala_code_node_unref0 (m);
		}
		_bala_iterable_unref0 (_m_list);
	}
	{
		BalaList* _prop_list = NULL;
		BalaList* _tmp161_;
		BalaList* _tmp162_;
		gint _prop_size = 0;
		BalaList* _tmp163_;
		gint _tmp164_;
		gint _tmp165_;
		gint _prop_index = 0;
		_tmp161_ = bala_object_type_symbol_get_properties ((BalaObjectTypeSymbol*) iface);
		_tmp162_ = _bala_iterable_ref0 (_tmp161_);
		_prop_list = _tmp162_;
		_tmp163_ = _prop_list;
		_tmp164_ = bala_collection_get_size ((BalaCollection*) _tmp163_);
		_tmp165_ = _tmp164_;
		_prop_size = _tmp165_;
		_prop_index = -1;
		while (TRUE) {
			gint _tmp166_;
			gint _tmp167_;
			BalaProperty* prop = NULL;
			BalaList* _tmp168_;
			gpointer _tmp169_;
			gboolean _tmp170_ = FALSE;
			BalaProperty* _tmp171_;
			gboolean _tmp172_;
			gboolean _tmp173_;
			_prop_index = _prop_index + 1;
			_tmp166_ = _prop_index;
			_tmp167_ = _prop_size;
			if (!(_tmp166_ < _tmp167_)) {
				break;
			}
			_tmp168_ = _prop_list;
			_tmp169_ = bala_list_get (_tmp168_, _prop_index);
			prop = (BalaProperty*) _tmp169_;
			_tmp171_ = prop;
			_tmp172_ = bala_property_get_is_abstract (_tmp171_);
			_tmp173_ = _tmp172_;
			if (_tmp173_) {
				_tmp170_ = TRUE;
			} else {
				BalaProperty* _tmp174_;
				gboolean _tmp175_;
				gboolean _tmp176_;
				_tmp174_ = prop;
				_tmp175_ = bala_property_get_is_virtual (_tmp174_);
				_tmp176_ = _tmp175_;
				_tmp170_ = _tmp176_;
			}
			if (_tmp170_) {
				BalaProperty* _tmp177_;
				BalaPropertyAccessor* _tmp178_;
				BalaPropertyAccessor* _tmp179_;
				gboolean _tmp208_ = FALSE;
				BalaProperty* _tmp209_;
				BalaPropertyAccessor* _tmp210_;
				BalaPropertyAccessor* _tmp211_;
				_tmp177_ = prop;
				_tmp178_ = bala_property_get_get_accessor (_tmp177_);
				_tmp179_ = _tmp178_;
				if (_tmp179_ != NULL) {
					BalaMethod* m = NULL;
					BalaProperty* _tmp180_;
					BalaPropertyAccessor* _tmp181_;
					BalaPropertyAccessor* _tmp182_;
					BalaMethod* _tmp183_;
					GString* _tmp184_;
					BalaMethod* _tmp185_;
					const gchar* _tmp186_;
					const gchar* _tmp187_;
					BalaMethod* _tmp188_;
					GString* _tmp189_;
					gint _tmp190_;
					BalaMethod* _tmp191_;
					BalaMethod* _tmp192_;
					const gchar* _tmp193_;
					const gchar* _tmp194_;
					BalaMethod* _tmp195_;
					gchar* _tmp196_;
					gchar* _tmp197_;
					BalaMethod* _tmp198_;
					BalaList* _tmp199_;
					BalaMethod* _tmp200_;
					BalaDataType* _tmp201_;
					BalaDataType* _tmp202_;
					BalaMethod* _tmp203_;
					gboolean _tmp204_;
					gboolean _tmp205_;
					gint _tmp206_;
					GString* _tmp207_;
					_tmp180_ = prop;
					_tmp181_ = bala_property_get_get_accessor (_tmp180_);
					_tmp182_ = _tmp181_;
					_tmp183_ = bala_property_accessor_get_method (_tmp182_);
					m = _tmp183_;
					bala_gir_writer_write_indent (self);
					_tmp184_ = self->priv->buffer;
					_tmp185_ = m;
					_tmp186_ = bala_symbol_get_name ((BalaSymbol*) _tmp185_);
					_tmp187_ = _tmp186_;
					g_string_append_printf (_tmp184_, "<field name=\"%s\"", _tmp187_);
					_tmp188_ = m;
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp188_);
					_tmp189_ = self->priv->buffer;
					g_string_append_printf (_tmp189_, ">\n");
					_tmp190_ = self->priv->indent;
					self->priv->indent = _tmp190_ + 1;
					_tmp191_ = m;
					_tmp192_ = m;
					_tmp193_ = bala_symbol_get_name ((BalaSymbol*) _tmp192_);
					_tmp194_ = _tmp193_;
					_tmp195_ = m;
					_tmp196_ = bala_get_ccode_name ((BalaCodeNode*) _tmp195_);
					_tmp197_ = _tmp196_;
					_tmp198_ = m;
					_tmp199_ = bala_callable_get_parameters ((BalaCallable*) _tmp198_);
					_tmp200_ = m;
					_tmp201_ = bala_callable_get_return_type ((BalaCallable*) _tmp200_);
					_tmp202_ = _tmp201_;
					_tmp203_ = m;
					_tmp204_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) _tmp203_);
					_tmp205_ = _tmp204_;
					bala_gir_writer_do_write_signature (self, _tmp191_, "callback", TRUE, _tmp194_, _tmp197_, _tmp199_, _tmp202_, _tmp205_, FALSE, FALSE);
					_g_free0 (_tmp197_);
					_tmp206_ = self->priv->indent;
					self->priv->indent = _tmp206_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp207_ = self->priv->buffer;
					g_string_append_printf (_tmp207_, "</field>\n");
					_bala_code_node_unref0 (m);
				}
				_tmp209_ = prop;
				_tmp210_ = bala_property_get_set_accessor (_tmp209_);
				_tmp211_ = _tmp210_;
				if (_tmp211_ != NULL) {
					BalaProperty* _tmp212_;
					BalaPropertyAccessor* _tmp213_;
					BalaPropertyAccessor* _tmp214_;
					gboolean _tmp215_;
					gboolean _tmp216_;
					_tmp212_ = prop;
					_tmp213_ = bala_property_get_set_accessor (_tmp212_);
					_tmp214_ = _tmp213_;
					_tmp215_ = bala_property_accessor_get_writable (_tmp214_);
					_tmp216_ = _tmp215_;
					_tmp208_ = _tmp216_;
				} else {
					_tmp208_ = FALSE;
				}
				if (_tmp208_) {
					BalaMethod* m = NULL;
					BalaProperty* _tmp217_;
					BalaPropertyAccessor* _tmp218_;
					BalaPropertyAccessor* _tmp219_;
					BalaMethod* _tmp220_;
					GString* _tmp221_;
					BalaMethod* _tmp222_;
					const gchar* _tmp223_;
					const gchar* _tmp224_;
					BalaMethod* _tmp225_;
					GString* _tmp226_;
					gint _tmp227_;
					BalaMethod* _tmp228_;
					BalaMethod* _tmp229_;
					const gchar* _tmp230_;
					const gchar* _tmp231_;
					BalaMethod* _tmp232_;
					gchar* _tmp233_;
					gchar* _tmp234_;
					BalaMethod* _tmp235_;
					BalaList* _tmp236_;
					BalaMethod* _tmp237_;
					BalaDataType* _tmp238_;
					BalaDataType* _tmp239_;
					BalaMethod* _tmp240_;
					gboolean _tmp241_;
					gboolean _tmp242_;
					gint _tmp243_;
					GString* _tmp244_;
					_tmp217_ = prop;
					_tmp218_ = bala_property_get_set_accessor (_tmp217_);
					_tmp219_ = _tmp218_;
					_tmp220_ = bala_property_accessor_get_method (_tmp219_);
					m = _tmp220_;
					bala_gir_writer_write_indent (self);
					_tmp221_ = self->priv->buffer;
					_tmp222_ = m;
					_tmp223_ = bala_symbol_get_name ((BalaSymbol*) _tmp222_);
					_tmp224_ = _tmp223_;
					g_string_append_printf (_tmp221_, "<field name=\"%s\"", _tmp224_);
					_tmp225_ = m;
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) _tmp225_);
					_tmp226_ = self->priv->buffer;
					g_string_append_printf (_tmp226_, ">\n");
					_tmp227_ = self->priv->indent;
					self->priv->indent = _tmp227_ + 1;
					_tmp228_ = m;
					_tmp229_ = m;
					_tmp230_ = bala_symbol_get_name ((BalaSymbol*) _tmp229_);
					_tmp231_ = _tmp230_;
					_tmp232_ = m;
					_tmp233_ = bala_get_ccode_name ((BalaCodeNode*) _tmp232_);
					_tmp234_ = _tmp233_;
					_tmp235_ = m;
					_tmp236_ = bala_callable_get_parameters ((BalaCallable*) _tmp235_);
					_tmp237_ = m;
					_tmp238_ = bala_callable_get_return_type ((BalaCallable*) _tmp237_);
					_tmp239_ = _tmp238_;
					_tmp240_ = m;
					_tmp241_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) _tmp240_);
					_tmp242_ = _tmp241_;
					bala_gir_writer_do_write_signature (self, _tmp228_, "callback", TRUE, _tmp231_, _tmp234_, _tmp236_, _tmp239_, _tmp242_, FALSE, FALSE);
					_g_free0 (_tmp234_);
					_tmp243_ = self->priv->indent;
					self->priv->indent = _tmp243_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp244_ = self->priv->buffer;
					g_string_append_printf (_tmp244_, "</field>\n");
					_bala_code_node_unref0 (m);
				}
			}
			_bala_code_node_unref0 (prop);
		}
		_bala_iterable_unref0 (_prop_list);
	}
	_tmp245_ = self->priv->indent;
	self->priv->indent = _tmp245_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp246_ = self->priv->buffer;
	g_string_append_printf (_tmp246_, "</record>\n");
	bala_gir_writer_visit_deferred (self);
	_g_free0 (gtype_struct_name);
}

static void
bala_gir_writer_visit_deferred (BalaGIRWriter* self)
{
	BalaArrayList* nodes = NULL;
	BalaArrayList* _tmp0_;
	BalaArrayList* _tmp1_;
	GEqualFunc _tmp2_;
	BalaArrayList* _tmp3_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->deferred;
	_tmp1_ = _bala_iterable_ref0 (_tmp0_);
	nodes = _tmp1_;
	_tmp2_ = g_direct_equal;
	_tmp3_ = bala_array_list_new (BALA_TYPE_CODE_NODE, (GBoxedCopyFunc) bala_code_node_ref, (GDestroyNotify) bala_code_node_unref, _tmp2_);
	_bala_iterable_unref0 (self->priv->deferred);
	self->priv->deferred = _tmp3_;
	{
		BalaArrayList* _node_list = NULL;
		BalaArrayList* _tmp4_;
		BalaArrayList* _tmp5_;
		gint _node_size = 0;
		BalaArrayList* _tmp6_;
		gint _tmp7_;
		gint _tmp8_;
		gint _node_index = 0;
		_tmp4_ = nodes;
		_tmp5_ = _bala_iterable_ref0 (_tmp4_);
		_node_list = _tmp5_;
		_tmp6_ = _node_list;
		_tmp7_ = bala_collection_get_size ((BalaCollection*) _tmp6_);
		_tmp8_ = _tmp7_;
		_node_size = _tmp8_;
		_node_index = -1;
		while (TRUE) {
			gint _tmp9_;
			gint _tmp10_;
			BalaCodeNode* node = NULL;
			BalaArrayList* _tmp11_;
			gpointer _tmp12_;
			BalaCodeNode* _tmp13_;
			_node_index = _node_index + 1;
			_tmp9_ = _node_index;
			_tmp10_ = _node_size;
			if (!(_tmp9_ < _tmp10_)) {
				break;
			}
			_tmp11_ = _node_list;
			_tmp12_ = bala_list_get ((BalaList*) _tmp11_, _node_index);
			node = (BalaCodeNode*) _tmp12_;
			_tmp13_ = node;
			bala_code_node_accept (_tmp13_, (BalaCodeVisitor*) self);
			_bala_code_node_unref0 (node);
		}
		_bala_iterable_unref0 (_node_list);
	}
	_bala_iterable_unref0 (nodes);
}

static gchar*
bala_gir_writer_get_gir_name (BalaGIRWriter* self,
                              BalaSymbol* symbol)
{
	gchar* gir_name = NULL;
	BalaSymbol* h0 = NULL;
	BalaArrayList* _tmp0_;
	gpointer _tmp1_;
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (symbol != NULL, NULL);
	gir_name = NULL;
	_tmp0_ = self->priv->hierarchy;
	_tmp1_ = bala_list_get ((BalaList*) _tmp0_, 0);
	h0 = (BalaSymbol*) _tmp1_;
	{
		BalaSymbol* cur_sym = NULL;
		BalaSymbol* _tmp2_;
		_tmp2_ = _bala_code_node_ref0 (symbol);
		cur_sym = _tmp2_;
		{
			gboolean _tmp3_ = FALSE;
			_tmp3_ = TRUE;
			while (TRUE) {
				BalaSymbol* _tmp8_;
				BalaSymbol* _tmp9_;
				BalaSymbol* _tmp10_;
				gchar* cur_name = NULL;
				BalaSymbol* _tmp11_;
				gchar* _tmp12_;
				const gchar* _tmp13_;
				const gchar* _tmp18_;
				const gchar* _tmp19_;
				gchar* _tmp20_;
				if (!_tmp3_) {
					BalaSymbol* _tmp4_;
					BalaSymbol* _tmp5_;
					BalaSymbol* _tmp6_;
					BalaSymbol* _tmp7_;
					_tmp4_ = cur_sym;
					_tmp5_ = bala_symbol_get_parent_symbol (_tmp4_);
					_tmp6_ = _tmp5_;
					_tmp7_ = _bala_code_node_ref0 (_tmp6_);
					_bala_code_node_unref0 (cur_sym);
					cur_sym = _tmp7_;
				}
				_tmp3_ = FALSE;
				_tmp8_ = cur_sym;
				if (!(_tmp8_ != NULL)) {
					break;
				}
				_tmp9_ = cur_sym;
				_tmp10_ = h0;
				if (_tmp9_ == _tmp10_) {
					break;
				}
				_tmp11_ = cur_sym;
				_tmp12_ = bala_code_node_get_attribute_string ((BalaCodeNode*) _tmp11_, "GIR", "name", NULL);
				cur_name = _tmp12_;
				_tmp13_ = cur_name;
				if (_tmp13_ == NULL) {
					BalaSymbol* _tmp14_;
					const gchar* _tmp15_;
					const gchar* _tmp16_;
					gchar* _tmp17_;
					_tmp14_ = cur_sym;
					_tmp15_ = bala_symbol_get_name (_tmp14_);
					_tmp16_ = _tmp15_;
					_tmp17_ = g_strdup (_tmp16_);
					_g_free0 (cur_name);
					cur_name = _tmp17_;
				}
				_tmp18_ = cur_name;
				_tmp19_ = gir_name;
				_tmp20_ = g_strconcat (_tmp18_, _tmp19_, NULL);
				_g_free0 (gir_name);
				gir_name = _tmp20_;
				_g_free0 (cur_name);
			}
		}
		_bala_code_node_unref0 (cur_sym);
	}
	result = gir_name;
	_bala_code_node_unref0 (h0);
	return result;
}

static void
bala_gir_writer_real_visit_enum (BalaCodeVisitor* base,
                                 BalaEnum* en)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	BalaArrayList* _tmp2_;
	gpointer _tmp3_;
	BalaSymbol* _tmp4_;
	gboolean _tmp5_;
	const gchar* _tmp7_ = NULL;
	gboolean _tmp8_;
	gboolean _tmp9_;
	gchar* element_name = NULL;
	gchar* _tmp10_;
	GString* _tmp11_;
	const gchar* _tmp12_;
	gchar* _tmp13_;
	gchar* _tmp14_;
	GString* _tmp15_;
	gint _tmp16_;
	gchar* _tmp17_;
	gchar* _tmp18_;
	BalaArrayList* _tmp19_;
	BalaArrayList* _tmp20_;
	gpointer _tmp21_;
	BalaSymbol* _tmp22_;
	gint _tmp23_;
	GString* _tmp24_;
	const gchar* _tmp25_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (en != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) en);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) en)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) en)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = bala_list_get ((BalaList*) _tmp2_, 0);
	_tmp4_ = (BalaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, BALA_TYPE_NAMESPACE);
	_bala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		BalaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		bala_collection_add ((BalaCollection*) _tmp6_, (BalaCodeNode*) en);
		return;
	}
	_tmp8_ = bala_enum_get_is_flags (en);
	_tmp9_ = _tmp8_;
	if (_tmp9_) {
		_tmp7_ = "bitfield";
	} else {
		_tmp7_ = "enumeration";
	}
	_tmp10_ = g_strdup (_tmp7_);
	element_name = _tmp10_;
	bala_gir_writer_write_indent (self);
	_tmp11_ = self->priv->buffer;
	_tmp12_ = element_name;
	_tmp13_ = bala_gir_writer_get_gir_name (self, (BalaSymbol*) en);
	_tmp14_ = _tmp13_;
	g_string_append_printf (_tmp11_, "<%s name=\"%s\"", _tmp12_, _tmp14_);
	_g_free0 (_tmp14_);
	if (bala_get_ccode_has_type_id ((BalaTypeSymbol*) en)) {
		bala_gir_writer_write_gtype_attributes (self, (BalaTypeSymbol*) en, FALSE);
	} else {
		bala_gir_writer_write_ctype_attributes (self, (BalaTypeSymbol*) en, "", FALSE);
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) en);
	_tmp15_ = self->priv->buffer;
	g_string_append_printf (_tmp15_, ">\n");
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ + 1;
	_tmp17_ = bala_gir_writer_get_enum_comment (self, en);
	_tmp18_ = _tmp17_;
	bala_gir_writer_write_doc (self, _tmp18_);
	_g_free0 (_tmp18_);
	self->priv->enum_value = 0;
	_tmp19_ = self->priv->hierarchy;
	bala_list_insert ((BalaList*) _tmp19_, 0, (BalaSymbol*) en);
	bala_code_node_accept_children ((BalaCodeNode*) en, (BalaCodeVisitor*) self);
	_tmp20_ = self->priv->hierarchy;
	_tmp21_ = bala_list_remove_at ((BalaList*) _tmp20_, 0);
	_tmp22_ = (BalaSymbol*) _tmp21_;
	_bala_code_node_unref0 (_tmp22_);
	_tmp23_ = self->priv->indent;
	self->priv->indent = _tmp23_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp24_ = self->priv->buffer;
	_tmp25_ = element_name;
	g_string_append_printf (_tmp24_, "</%s>\n", _tmp25_);
	bala_gir_writer_visit_deferred (self);
	_g_free0 (element_name);
}

static void
bala_gir_writer_real_visit_enum_value (BalaCodeVisitor* base,
                                       BalaEnumValue* ev)
{
	BalaGIRWriter * self;
	BalaEnum* en = NULL;
	BalaArrayList* _tmp0_;
	gpointer _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	gchar* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	gchar* _tmp8_;
	BalaExpression* _tmp9_;
	BalaExpression* _tmp10_;
	gchar* comment = NULL;
	gchar* _tmp23_;
	const gchar* _tmp24_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (ev != NULL);
	bala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->hierarchy;
	_tmp1_ = bala_list_get ((BalaList*) _tmp0_, 0);
	en = G_TYPE_CHECK_INSTANCE_CAST ((BalaSymbol*) _tmp1_, BALA_TYPE_ENUM, BalaEnum);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = bala_symbol_get_name ((BalaSymbol*) ev);
	_tmp4_ = _tmp3_;
	_tmp5_ = g_ascii_strdown (_tmp4_, (gssize) -1);
	_tmp6_ = _tmp5_;
	_tmp7_ = bala_get_ccode_name ((BalaCodeNode*) ev);
	_tmp8_ = _tmp7_;
	g_string_append_printf (_tmp2_, "<member name=\"%s\" c:identifier=\"%s\"", _tmp6_, _tmp8_);
	_g_free0 (_tmp8_);
	_g_free0 (_tmp6_);
	_tmp9_ = bala_constant_get_value ((BalaConstant*) ev);
	_tmp10_ = _tmp9_;
	if (_tmp10_ != NULL) {
		gchar* value = NULL;
		BalaExpression* _tmp11_;
		BalaExpression* _tmp12_;
		gchar* _tmp13_;
		GString* _tmp14_;
		const gchar* _tmp15_;
		_tmp11_ = bala_constant_get_value ((BalaConstant*) ev);
		_tmp12_ = _tmp11_;
		_tmp13_ = bala_gir_writer_literal_expression_to_value_string (self, _tmp12_);
		value = _tmp13_;
		_tmp14_ = self->priv->buffer;
		_tmp15_ = value;
		g_string_append_printf (_tmp14_, " value=\"%s\"", _tmp15_);
		_g_free0 (value);
	} else {
		BalaEnum* _tmp16_;
		gboolean _tmp17_;
		gboolean _tmp18_;
		_tmp16_ = en;
		_tmp17_ = bala_enum_get_is_flags (_tmp16_);
		_tmp18_ = _tmp17_;
		if (_tmp18_) {
			GString* _tmp19_;
			gint _tmp20_;
			_tmp19_ = self->priv->buffer;
			_tmp20_ = self->priv->enum_value;
			self->priv->enum_value = _tmp20_ + 1;
			g_string_append_printf (_tmp19_, " value=\"%d\"", 1 << _tmp20_);
		} else {
			GString* _tmp21_;
			gint _tmp22_;
			_tmp21_ = self->priv->buffer;
			_tmp22_ = self->priv->enum_value;
			self->priv->enum_value = _tmp22_ + 1;
			g_string_append_printf (_tmp21_, " value=\"%d\"", _tmp22_);
		}
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) ev);
	_tmp23_ = bala_gir_writer_get_enum_value_comment (self, ev);
	comment = _tmp23_;
	_tmp24_ = comment;
	if (_tmp24_ == NULL) {
		GString* _tmp25_;
		_tmp25_ = self->priv->buffer;
		g_string_append_printf (_tmp25_, "/>\n");
	} else {
		GString* _tmp26_;
		gint _tmp27_;
		const gchar* _tmp28_;
		gint _tmp29_;
		GString* _tmp30_;
		_tmp26_ = self->priv->buffer;
		g_string_append_printf (_tmp26_, ">\n");
		_tmp27_ = self->priv->indent;
		self->priv->indent = _tmp27_ + 1;
		_tmp28_ = comment;
		bala_gir_writer_write_doc (self, _tmp28_);
		_tmp29_ = self->priv->indent;
		self->priv->indent = _tmp29_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp30_ = self->priv->buffer;
		g_string_append_printf (_tmp30_, "</member>\n");
	}
	_g_free0 (comment);
	_bala_code_node_unref0 (en);
}

static void
bala_gir_writer_real_visit_error_domain (BalaCodeVisitor* base,
                                         BalaErrorDomain* edomain)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	GString* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	GString* _tmp8_;
	gint _tmp9_;
	gchar* _tmp10_;
	gchar* _tmp11_;
	BalaArrayList* _tmp12_;
	BalaArrayList* _tmp13_;
	gpointer _tmp14_;
	BalaSymbol* _tmp15_;
	gint _tmp16_;
	GString* _tmp17_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (edomain != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) edomain);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) edomain)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) edomain)) {
		return;
	}
	bala_gir_writer_write_indent (self);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = bala_symbol_get_name ((BalaSymbol*) edomain);
	_tmp4_ = _tmp3_;
	g_string_append_printf (_tmp2_, "<enumeration name=\"%s\"", _tmp4_);
	bala_gir_writer_write_ctype_attributes (self, (BalaTypeSymbol*) edomain, "", FALSE);
	_tmp5_ = self->priv->buffer;
	_tmp6_ = bala_get_ccode_quark_name (edomain);
	_tmp7_ = _tmp6_;
	g_string_append_printf (_tmp5_, " glib:error-domain=\"%s\"", _tmp7_);
	_g_free0 (_tmp7_);
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) edomain);
	_tmp8_ = self->priv->buffer;
	g_string_append_printf (_tmp8_, ">\n");
	_tmp9_ = self->priv->indent;
	self->priv->indent = _tmp9_ + 1;
	_tmp10_ = bala_gir_writer_get_error_domain_comment (self, edomain);
	_tmp11_ = _tmp10_;
	bala_gir_writer_write_doc (self, _tmp11_);
	_g_free0 (_tmp11_);
	self->priv->enum_value = 0;
	_tmp12_ = self->priv->hierarchy;
	bala_list_insert ((BalaList*) _tmp12_, 0, (BalaSymbol*) edomain);
	bala_code_node_accept_children ((BalaCodeNode*) edomain, (BalaCodeVisitor*) self);
	_tmp13_ = self->priv->hierarchy;
	_tmp14_ = bala_list_remove_at ((BalaList*) _tmp13_, 0);
	_tmp15_ = (BalaSymbol*) _tmp14_;
	_bala_code_node_unref0 (_tmp15_);
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp17_ = self->priv->buffer;
	g_string_append_printf (_tmp17_, "</enumeration>\n");
	bala_gir_writer_visit_deferred (self);
}

static void
bala_gir_writer_real_visit_error_code (BalaCodeVisitor* base,
                                       BalaErrorCode* ecode)
{
	BalaGIRWriter * self;
	GString* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	gchar* _tmp5_;
	gchar* _tmp6_;
	BalaExpression* _tmp7_;
	BalaExpression* _tmp8_;
	gchar* comment = NULL;
	gchar* _tmp16_;
	const gchar* _tmp17_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (ecode != NULL);
	bala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	_tmp1_ = bala_symbol_get_name ((BalaSymbol*) ecode);
	_tmp2_ = _tmp1_;
	_tmp3_ = g_ascii_strdown (_tmp2_, (gssize) -1);
	_tmp4_ = _tmp3_;
	_tmp5_ = bala_get_ccode_name ((BalaCodeNode*) ecode);
	_tmp6_ = _tmp5_;
	g_string_append_printf (_tmp0_, "<member name=\"%s\" c:identifier=\"%s\"", _tmp4_, _tmp6_);
	_g_free0 (_tmp6_);
	_g_free0 (_tmp4_);
	_tmp7_ = bala_error_code_get_value (ecode);
	_tmp8_ = _tmp7_;
	if (_tmp8_ != NULL) {
		gchar* value = NULL;
		BalaExpression* _tmp9_;
		BalaExpression* _tmp10_;
		gchar* _tmp11_;
		GString* _tmp12_;
		const gchar* _tmp13_;
		_tmp9_ = bala_error_code_get_value (ecode);
		_tmp10_ = _tmp9_;
		_tmp11_ = bala_gir_writer_literal_expression_to_value_string (self, _tmp10_);
		value = _tmp11_;
		_tmp12_ = self->priv->buffer;
		_tmp13_ = value;
		g_string_append_printf (_tmp12_, " value=\"%s\"", _tmp13_);
		_g_free0 (value);
	} else {
		GString* _tmp14_;
		gint _tmp15_;
		_tmp14_ = self->priv->buffer;
		_tmp15_ = self->priv->enum_value;
		self->priv->enum_value = _tmp15_ + 1;
		g_string_append_printf (_tmp14_, " value=\"%d\"", _tmp15_);
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) ecode);
	_tmp16_ = bala_gir_writer_get_error_code_comment (self, ecode);
	comment = _tmp16_;
	_tmp17_ = comment;
	if (_tmp17_ == NULL) {
		GString* _tmp18_;
		_tmp18_ = self->priv->buffer;
		g_string_append_printf (_tmp18_, "/>\n");
	} else {
		GString* _tmp19_;
		gint _tmp20_;
		const gchar* _tmp21_;
		gint _tmp22_;
		GString* _tmp23_;
		_tmp19_ = self->priv->buffer;
		g_string_append_printf (_tmp19_, ">\n");
		_tmp20_ = self->priv->indent;
		self->priv->indent = _tmp20_ + 1;
		_tmp21_ = comment;
		bala_gir_writer_write_doc (self, _tmp21_);
		_tmp22_ = self->priv->indent;
		self->priv->indent = _tmp22_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp23_ = self->priv->buffer;
		g_string_append_printf (_tmp23_, "</member>\n");
	}
	_g_free0 (comment);
}

static void
bala_gir_writer_real_visit_constant (BalaCodeVisitor* base,
                                     BalaConstant* c)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	BalaExpression* initializer = NULL;
	BalaExpression* _tmp2_;
	BalaExpression* _tmp3_;
	BalaExpression* _tmp4_;
	gchar* value = NULL;
	BalaExpression* _tmp5_;
	gchar* _tmp6_;
	GString* _tmp7_;
	const gchar* _tmp8_;
	const gchar* _tmp9_;
	gchar* _tmp10_;
	gchar* _tmp11_;
	GString* _tmp12_;
	const gchar* _tmp13_;
	GString* _tmp14_;
	gint _tmp15_;
	gchar* _tmp16_;
	gchar* _tmp17_;
	BalaExpression* _tmp18_;
	BalaDataType* _tmp19_;
	BalaDataType* _tmp20_;
	gint _tmp21_;
	GString* _tmp22_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (c != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) c);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) c)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) c)) {
		return;
	}
	_tmp2_ = bala_constant_get_value (c);
	_tmp3_ = _tmp2_;
	_tmp4_ = _bala_code_node_ref0 (_tmp3_);
	initializer = _tmp4_;
	_tmp5_ = initializer;
	_tmp6_ = bala_gir_writer_literal_expression_to_value_string (self, _tmp5_);
	value = _tmp6_;
	bala_gir_writer_write_indent (self);
	_tmp7_ = self->priv->buffer;
	_tmp8_ = bala_symbol_get_name ((BalaSymbol*) c);
	_tmp9_ = _tmp8_;
	_tmp10_ = bala_get_ccode_name ((BalaCodeNode*) c);
	_tmp11_ = _tmp10_;
	g_string_append_printf (_tmp7_, "<constant name=\"%s\" c:identifier=\"%s\"", _tmp9_, _tmp11_);
	_g_free0 (_tmp11_);
	_tmp12_ = self->priv->buffer;
	_tmp13_ = value;
	g_string_append_printf (_tmp12_, " value=\"%s\"", _tmp13_);
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) c);
	_tmp14_ = self->priv->buffer;
	g_string_append_printf (_tmp14_, ">\n");
	_tmp15_ = self->priv->indent;
	self->priv->indent = _tmp15_ + 1;
	_tmp16_ = bala_gir_writer_get_constant_comment (self, c);
	_tmp17_ = _tmp16_;
	bala_gir_writer_write_doc (self, _tmp17_);
	_g_free0 (_tmp17_);
	_tmp18_ = initializer;
	_tmp19_ = bala_expression_get_value_type (_tmp18_);
	_tmp20_ = _tmp19_;
	bala_gir_writer_write_type (self, _tmp20_, -1, BALA_PARAMETER_DIRECTION_IN);
	_tmp21_ = self->priv->indent;
	self->priv->indent = _tmp21_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp22_ = self->priv->buffer;
	g_string_append_printf (_tmp22_, "</constant>\n");
	_g_free0 (value);
	_bala_code_node_unref0 (initializer);
}

static void
bala_gir_writer_real_visit_field (BalaCodeVisitor* base,
                                  BalaField* f)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	GString* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	BalaDataType* _tmp5_;
	BalaDataType* _tmp6_;
	gboolean _tmp7_;
	gboolean _tmp8_;
	GString* _tmp10_;
	gint _tmp11_;
	gchar* _tmp12_;
	gchar* _tmp13_;
	BalaDataType* _tmp14_;
	BalaDataType* _tmp15_;
	gint _tmp16_;
	GString* _tmp17_;
	gboolean _tmp18_ = FALSE;
	BalaDataType* _tmp19_;
	BalaDataType* _tmp20_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (f != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) f);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) f)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) f)) {
		return;
	}
	bala_gir_writer_write_indent (self);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = bala_get_ccode_name ((BalaCodeNode*) f);
	_tmp4_ = _tmp3_;
	g_string_append_printf (_tmp2_, "<field name=\"%s\"", _tmp4_);
	_g_free0 (_tmp4_);
	_tmp5_ = bala_variable_get_variable_type ((BalaVariable*) f);
	_tmp6_ = _tmp5_;
	_tmp7_ = bala_data_type_get_nullable (_tmp6_);
	_tmp8_ = _tmp7_;
	if (_tmp8_) {
		GString* _tmp9_;
		_tmp9_ = self->priv->buffer;
		g_string_append_printf (_tmp9_, " allow-none=\"1\"");
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) f);
	_tmp10_ = self->priv->buffer;
	g_string_append_printf (_tmp10_, ">\n");
	_tmp11_ = self->priv->indent;
	self->priv->indent = _tmp11_ + 1;
	_tmp12_ = bala_gir_writer_get_field_comment (self, f);
	_tmp13_ = _tmp12_;
	bala_gir_writer_write_doc (self, _tmp13_);
	_g_free0 (_tmp13_);
	_tmp14_ = bala_variable_get_variable_type ((BalaVariable*) f);
	_tmp15_ = _tmp14_;
	bala_gir_writer_write_type (self, _tmp15_, -1, BALA_PARAMETER_DIRECTION_IN);
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp17_ = self->priv->buffer;
	g_string_append_printf (_tmp17_, "</field>\n");
	_tmp19_ = bala_variable_get_variable_type ((BalaVariable*) f);
	_tmp20_ = _tmp19_;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp20_, BALA_TYPE_ARRAY_TYPE)) {
		_tmp18_ = bala_get_ccode_array_length ((BalaCodeNode*) f);
	} else {
		_tmp18_ = FALSE;
	}
	if (_tmp18_) {
		BalaArrayType* array_type = NULL;
		BalaDataType* _tmp21_;
		BalaDataType* _tmp22_;
		BalaArrayType* _tmp23_;
		BalaArrayType* _tmp24_;
		gboolean _tmp25_;
		gboolean _tmp26_;
		_tmp21_ = bala_variable_get_variable_type ((BalaVariable*) f);
		_tmp22_ = _tmp21_;
		_tmp23_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp22_, BALA_TYPE_ARRAY_TYPE, BalaArrayType));
		array_type = _tmp23_;
		_tmp24_ = array_type;
		_tmp25_ = bala_array_type_get_fixed_length (_tmp24_);
		_tmp26_ = _tmp25_;
		if (!_tmp26_) {
			{
				gint i = 0;
				i = 0;
				{
					gboolean _tmp27_ = FALSE;
					_tmp27_ = TRUE;
					while (TRUE) {
						BalaArrayType* _tmp29_;
						gint _tmp30_;
						gint _tmp31_;
						GString* _tmp32_;
						gchar* _tmp33_;
						gchar* _tmp34_;
						GString* _tmp35_;
						gint _tmp36_;
						BalaArrayType* _tmp37_;
						BalaDataType* _tmp38_;
						BalaDataType* _tmp39_;
						gint _tmp40_;
						GString* _tmp41_;
						if (!_tmp27_) {
							gint _tmp28_;
							_tmp28_ = i;
							i = _tmp28_ + 1;
						}
						_tmp27_ = FALSE;
						_tmp29_ = array_type;
						_tmp30_ = bala_array_type_get_rank (_tmp29_);
						_tmp31_ = _tmp30_;
						if (!(i < _tmp31_)) {
							break;
						}
						bala_gir_writer_write_indent (self);
						_tmp32_ = self->priv->buffer;
						_tmp33_ = bala_get_ccode_name ((BalaCodeNode*) f);
						_tmp34_ = _tmp33_;
						g_string_append_printf (_tmp32_, "<field name=\"%s_length%i\"", _tmp34_, i + 1);
						_g_free0 (_tmp34_);
						bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) f);
						_tmp35_ = self->priv->buffer;
						g_string_append_printf (_tmp35_, ">\n");
						_tmp36_ = self->priv->indent;
						self->priv->indent = _tmp36_ + 1;
						_tmp37_ = array_type;
						_tmp38_ = bala_array_type_get_length_type (_tmp37_);
						_tmp39_ = _tmp38_;
						bala_gir_writer_write_type (self, _tmp39_, -1, BALA_PARAMETER_DIRECTION_IN);
						_tmp40_ = self->priv->indent;
						self->priv->indent = _tmp40_ - 1;
						bala_gir_writer_write_indent (self);
						_tmp41_ = self->priv->buffer;
						g_string_append_printf (_tmp41_, "</field>\n");
					}
				}
			}
		}
		_bala_code_node_unref0 (array_type);
	} else {
		BalaDataType* _tmp42_;
		BalaDataType* _tmp43_;
		_tmp42_ = bala_variable_get_variable_type ((BalaVariable*) f);
		_tmp43_ = _tmp42_;
		if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp43_, BALA_TYPE_DELEGATE_TYPE)) {
			BalaDelegateType* deleg_type = NULL;
			BalaDataType* _tmp44_;
			BalaDataType* _tmp45_;
			BalaDelegateType* _tmp46_;
			BalaDelegateType* _tmp47_;
			BalaDelegate* _tmp48_;
			BalaDelegate* _tmp49_;
			gboolean _tmp50_;
			gboolean _tmp51_;
			_tmp44_ = bala_variable_get_variable_type ((BalaVariable*) f);
			_tmp45_ = _tmp44_;
			_tmp46_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp45_, BALA_TYPE_DELEGATE_TYPE, BalaDelegateType));
			deleg_type = _tmp46_;
			_tmp47_ = deleg_type;
			_tmp48_ = bala_delegate_type_get_delegate_symbol (_tmp47_);
			_tmp49_ = _tmp48_;
			_tmp50_ = bala_delegate_get_has_target (_tmp49_);
			_tmp51_ = _tmp50_;
			if (_tmp51_) {
				GString* _tmp52_;
				gchar* _tmp53_;
				gchar* _tmp54_;
				GString* _tmp55_;
				gint _tmp56_;
				GString* _tmp57_;
				gint _tmp58_;
				GString* _tmp59_;
				BalaDelegateType* _tmp60_;
				bala_gir_writer_write_indent (self);
				_tmp52_ = self->priv->buffer;
				_tmp53_ = bala_get_ccode_delegate_target_name ((BalaVariable*) f);
				_tmp54_ = _tmp53_;
				g_string_append_printf (_tmp52_, "<field name=\"%s\"", _tmp54_);
				_g_free0 (_tmp54_);
				bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) f);
				_tmp55_ = self->priv->buffer;
				g_string_append_printf (_tmp55_, ">\n");
				_tmp56_ = self->priv->indent;
				self->priv->indent = _tmp56_ + 1;
				bala_gir_writer_write_indent (self);
				_tmp57_ = self->priv->buffer;
				g_string_append_printf (_tmp57_, "<type name=\"gpointer\" c:type=\"gpointer\"/>\n");
				_tmp58_ = self->priv->indent;
				self->priv->indent = _tmp58_ - 1;
				bala_gir_writer_write_indent (self);
				_tmp59_ = self->priv->buffer;
				g_string_append_printf (_tmp59_, "</field>\n");
				_tmp60_ = deleg_type;
				if (bala_data_type_is_disposable ((BalaDataType*) _tmp60_)) {
					GString* _tmp61_;
					gchar* _tmp62_;
					gchar* _tmp63_;
					GString* _tmp64_;
					gint _tmp65_;
					GString* _tmp66_;
					gint _tmp67_;
					GString* _tmp68_;
					bala_gir_writer_write_indent (self);
					_tmp61_ = self->priv->buffer;
					_tmp62_ = bala_get_ccode_delegate_target_destroy_notify_name ((BalaVariable*) f);
					_tmp63_ = _tmp62_;
					g_string_append_printf (_tmp61_, "<field name=\"%s\"", _tmp63_);
					_g_free0 (_tmp63_);
					bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) f);
					_tmp64_ = self->priv->buffer;
					g_string_append_printf (_tmp64_, ">\n");
					_tmp65_ = self->priv->indent;
					self->priv->indent = _tmp65_ + 1;
					bala_gir_writer_write_indent (self);
					_tmp66_ = self->priv->buffer;
					g_string_append_printf (_tmp66_, "<type name=\"GLib.DestroyNotify\" c:type=\"GDestroyNotify\"/>\n");
					_tmp67_ = self->priv->indent;
					self->priv->indent = _tmp67_ - 1;
					bala_gir_writer_write_indent (self);
					_tmp68_ = self->priv->buffer;
					g_string_append_printf (_tmp68_, "</field>\n");
				}
			}
			_bala_code_node_unref0 (deleg_type);
		}
	}
}

static void
bala_gir_writer_write_implicit_params (BalaGIRWriter* self,
                                       BalaDataType* type,
                                       gint* index,
                                       gboolean has_array_length,
                                       const gchar* name,
                                       BalaParameterDirection direction)
{
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_ARRAY_TYPE)) {
		_tmp0_ = has_array_length;
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		{
			gint i = 0;
			i = 0;
			{
				gboolean _tmp1_ = FALSE;
				_tmp1_ = TRUE;
				while (TRUE) {
					gint _tmp3_;
					gint _tmp4_;
					BalaDataType* _tmp5_;
					BalaDataType* _tmp6_;
					gchar* _tmp7_;
					gchar* _tmp8_;
					if (!_tmp1_) {
						gint _tmp2_;
						_tmp2_ = i;
						i = _tmp2_ + 1;
					}
					_tmp1_ = FALSE;
					_tmp3_ = bala_array_type_get_rank (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_ARRAY_TYPE, BalaArrayType));
					_tmp4_ = _tmp3_;
					if (!(i < _tmp4_)) {
						break;
					}
					_tmp5_ = bala_array_type_get_length_type (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_ARRAY_TYPE, BalaArrayType));
					_tmp6_ = _tmp5_;
					_tmp7_ = g_strdup_printf ("%s_length%i", name, i + 1);
					_tmp8_ = _tmp7_;
					bala_gir_writer_write_param_or_return (self, _tmp6_, "parameter", index, has_array_length, _tmp8_, NULL, direction, FALSE, FALSE, FALSE);
					_g_free0 (_tmp8_);
				}
			}
		}
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_DELEGATE_TYPE)) {
			BalaDelegateType* deleg_type = NULL;
			BalaDelegateType* _tmp9_;
			BalaDelegateType* _tmp10_;
			BalaDelegate* _tmp11_;
			BalaDelegate* _tmp12_;
			gboolean _tmp13_;
			gboolean _tmp14_;
			_tmp9_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_DELEGATE_TYPE, BalaDelegateType));
			deleg_type = _tmp9_;
			_tmp10_ = deleg_type;
			_tmp11_ = bala_delegate_type_get_delegate_symbol (_tmp10_);
			_tmp12_ = _tmp11_;
			_tmp13_ = bala_delegate_get_has_target (_tmp12_);
			_tmp14_ = _tmp13_;
			if (_tmp14_) {
				BalaPointerType* data_type = NULL;
				BalaVoidType* _tmp15_;
				BalaVoidType* _tmp16_;
				BalaPointerType* _tmp17_;
				BalaPointerType* _tmp18_;
				BalaPointerType* _tmp19_;
				gchar* _tmp20_;
				gchar* _tmp21_;
				BalaDelegateType* _tmp22_;
				_tmp15_ = bala_void_type_new (NULL);
				_tmp16_ = _tmp15_;
				_tmp17_ = bala_pointer_type_new ((BalaDataType*) _tmp16_, NULL);
				_tmp18_ = _tmp17_;
				_bala_code_node_unref0 (_tmp16_);
				data_type = _tmp18_;
				_tmp19_ = data_type;
				_tmp20_ = g_strdup_printf ("%s_target", name);
				_tmp21_ = _tmp20_;
				bala_gir_writer_write_param_or_return (self, (BalaDataType*) _tmp19_, "parameter", index, FALSE, _tmp21_, NULL, direction, FALSE, FALSE, FALSE);
				_g_free0 (_tmp21_);
				_tmp22_ = deleg_type;
				if (bala_data_type_is_disposable ((BalaDataType*) _tmp22_)) {
					BalaDelegateType* notify_type = NULL;
					BalaCodeContext* _tmp23_;
					BalaNamespace* _tmp24_;
					BalaNamespace* _tmp25_;
					BalaScope* _tmp26_;
					BalaScope* _tmp27_;
					BalaSymbol* _tmp28_;
					BalaSymbol* _tmp29_;
					BalaScope* _tmp30_;
					BalaScope* _tmp31_;
					BalaSymbol* _tmp32_;
					BalaDelegate* _tmp33_;
					BalaDelegate* _tmp34_;
					BalaDelegateType* _tmp35_;
					BalaDelegateType* _tmp36_;
					BalaDelegateType* _tmp37_;
					gchar* _tmp38_;
					gchar* _tmp39_;
					_tmp23_ = self->priv->context;
					_tmp24_ = bala_code_context_get_root (_tmp23_);
					_tmp25_ = _tmp24_;
					_tmp26_ = bala_symbol_get_scope ((BalaSymbol*) _tmp25_);
					_tmp27_ = _tmp26_;
					_tmp28_ = bala_scope_lookup (_tmp27_, "GLib");
					_tmp29_ = _tmp28_;
					_tmp30_ = bala_symbol_get_scope (_tmp29_);
					_tmp31_ = _tmp30_;
					_tmp32_ = bala_scope_lookup (_tmp31_, "DestroyNotify");
					_tmp33_ = G_TYPE_CHECK_INSTANCE_TYPE (_tmp32_, BALA_TYPE_DELEGATE) ? ((BalaDelegate*) _tmp32_) : NULL;
					if (_tmp33_ == NULL) {
						_bala_code_node_unref0 (_tmp32_);
					}
					_tmp34_ = _tmp33_;
					_tmp35_ = bala_delegate_type_new (_tmp34_);
					_tmp36_ = _tmp35_;
					_bala_code_node_unref0 (_tmp34_);
					_bala_code_node_unref0 (_tmp29_);
					notify_type = _tmp36_;
					_tmp37_ = notify_type;
					_tmp38_ = g_strdup_printf ("%s_target_destroy_notify", name);
					_tmp39_ = _tmp38_;
					bala_gir_writer_write_param_or_return (self, (BalaDataType*) _tmp37_, "parameter", index, FALSE, _tmp39_, NULL, direction, FALSE, FALSE, FALSE);
					_g_free0 (_tmp39_);
					_bala_code_node_unref0 (notify_type);
				}
				_bala_code_node_unref0 (data_type);
			}
			_bala_code_node_unref0 (deleg_type);
		}
	}
}

static void
bala_gir_writer_skip_implicit_params (BalaGIRWriter* self,
                                      BalaDataType* type,
                                      gint* index,
                                      gboolean has_array_length)
{
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_ARRAY_TYPE)) {
		_tmp0_ = has_array_length;
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		gint _tmp1_;
		gint _tmp2_;
		_tmp1_ = bala_array_type_get_rank (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_ARRAY_TYPE, BalaArrayType));
		_tmp2_ = _tmp1_;
		*index = (*index) + _tmp2_;
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_DELEGATE_TYPE)) {
			gint _tmp3_;
			BalaDelegateType* deleg_type = NULL;
			BalaDelegateType* _tmp4_;
			BalaDelegateType* _tmp5_;
			_tmp3_ = *index;
			*index = _tmp3_ + 1;
			_tmp4_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_DELEGATE_TYPE, BalaDelegateType));
			deleg_type = _tmp4_;
			_tmp5_ = deleg_type;
			if (bala_data_type_is_disposable ((BalaDataType*) _tmp5_)) {
				gint _tmp6_;
				_tmp6_ = *index;
				*index = _tmp6_ + 1;
			}
			_bala_code_node_unref0 (deleg_type);
		}
	}
}

static void
bala_gir_writer_write_type_parameter (BalaGIRWriter* self,
                                      BalaTypeParameter* type_parameter,
                                      const gchar* tag_type)
{
	gint _tmp10_;
	GString* _tmp11_;
	gint _tmp12_;
	GString* _tmp13_;
	gint _tmp24_;
	GString* _tmp25_;
	gint _tmp26_;
	GString* _tmp27_;
	gint _tmp38_;
	GString* _tmp39_;
	gint _tmp40_;
	GString* _tmp41_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (type_parameter != NULL);
	g_return_if_fail (tag_type != NULL);
	bala_gir_writer_write_indent (self);
	if (g_strcmp0 (tag_type, "property") == 0) {
		GString* _tmp0_;
		const gchar* _tmp1_;
		const gchar* _tmp2_;
		gchar* _tmp3_;
		gchar* _tmp4_;
		_tmp0_ = self->priv->buffer;
		_tmp1_ = bala_symbol_get_name ((BalaSymbol*) type_parameter);
		_tmp2_ = _tmp1_;
		_tmp3_ = g_ascii_strdown (_tmp2_, (gssize) -1);
		_tmp4_ = _tmp3_;
		g_string_append_printf (_tmp0_, "<%s name=\"%s-type\" writable=\"1\" construct-only=\"1\">\n", tag_type, _tmp4_);
		_g_free0 (_tmp4_);
	} else {
		GString* _tmp5_;
		const gchar* _tmp6_;
		const gchar* _tmp7_;
		gchar* _tmp8_;
		gchar* _tmp9_;
		_tmp5_ = self->priv->buffer;
		_tmp6_ = bala_symbol_get_name ((BalaSymbol*) type_parameter);
		_tmp7_ = _tmp6_;
		_tmp8_ = g_ascii_strdown (_tmp7_, (gssize) -1);
		_tmp9_ = _tmp8_;
		g_string_append_printf (_tmp5_, "<%s name=\"%s_type\" transfer-ownership=\"none\">\n", tag_type, _tmp9_);
		_g_free0 (_tmp9_);
	}
	_tmp10_ = self->priv->indent;
	self->priv->indent = _tmp10_ + 1;
	bala_gir_writer_write_indent (self);
	_tmp11_ = self->priv->buffer;
	g_string_append_printf (_tmp11_, "<type name=\"GType\" c:type=\"GType\"/>\n");
	_tmp12_ = self->priv->indent;
	self->priv->indent = _tmp12_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp13_ = self->priv->buffer;
	g_string_append_printf (_tmp13_, "</%s>\n", tag_type);
	bala_gir_writer_write_indent (self);
	if (g_strcmp0 (tag_type, "property") == 0) {
		GString* _tmp14_;
		const gchar* _tmp15_;
		const gchar* _tmp16_;
		gchar* _tmp17_;
		gchar* _tmp18_;
		_tmp14_ = self->priv->buffer;
		_tmp15_ = bala_symbol_get_name ((BalaSymbol*) type_parameter);
		_tmp16_ = _tmp15_;
		_tmp17_ = g_ascii_strdown (_tmp16_, (gssize) -1);
		_tmp18_ = _tmp17_;
		g_string_append_printf (_tmp14_, "<%s name=\"%s-dup-func\" writable=\"1\" construct-only=\"1\">\n", tag_type, _tmp18_);
		_g_free0 (_tmp18_);
	} else {
		GString* _tmp19_;
		const gchar* _tmp20_;
		const gchar* _tmp21_;
		gchar* _tmp22_;
		gchar* _tmp23_;
		_tmp19_ = self->priv->buffer;
		_tmp20_ = bala_symbol_get_name ((BalaSymbol*) type_parameter);
		_tmp21_ = _tmp20_;
		_tmp22_ = g_ascii_strdown (_tmp21_, (gssize) -1);
		_tmp23_ = _tmp22_;
		g_string_append_printf (_tmp19_, "<%s name=\"%s_dup_func\" transfer-ownership=\"none\">\n", tag_type, _tmp23_);
		_g_free0 (_tmp23_);
	}
	_tmp24_ = self->priv->indent;
	self->priv->indent = _tmp24_ + 1;
	bala_gir_writer_write_indent (self);
	_tmp25_ = self->priv->buffer;
	g_string_append_printf (_tmp25_, "<type name=\"GObject.BoxedCopyFunc\" c:type=\"GBoxedCopyFunc\"/>\n");
	_tmp26_ = self->priv->indent;
	self->priv->indent = _tmp26_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp27_ = self->priv->buffer;
	g_string_append_printf (_tmp27_, "</%s>\n", tag_type);
	bala_gir_writer_write_indent (self);
	if (g_strcmp0 (tag_type, "property") == 0) {
		GString* _tmp28_;
		const gchar* _tmp29_;
		const gchar* _tmp30_;
		gchar* _tmp31_;
		gchar* _tmp32_;
		_tmp28_ = self->priv->buffer;
		_tmp29_ = bala_symbol_get_name ((BalaSymbol*) type_parameter);
		_tmp30_ = _tmp29_;
		_tmp31_ = g_ascii_strdown (_tmp30_, (gssize) -1);
		_tmp32_ = _tmp31_;
		g_string_append_printf (_tmp28_, "<%s name=\"%s-destroy-func\" writable=\"1\" construct-only=\"1\">\n", tag_type, _tmp32_);
		_g_free0 (_tmp32_);
	} else {
		GString* _tmp33_;
		const gchar* _tmp34_;
		const gchar* _tmp35_;
		gchar* _tmp36_;
		gchar* _tmp37_;
		_tmp33_ = self->priv->buffer;
		_tmp34_ = bala_symbol_get_name ((BalaSymbol*) type_parameter);
		_tmp35_ = _tmp34_;
		_tmp36_ = g_ascii_strdown (_tmp35_, (gssize) -1);
		_tmp37_ = _tmp36_;
		g_string_append_printf (_tmp33_, "<%s name=\"%s_destroy_func\" transfer-ownership=\"none\">\n", tag_type, _tmp37_);
		_g_free0 (_tmp37_);
	}
	_tmp38_ = self->priv->indent;
	self->priv->indent = _tmp38_ + 1;
	bala_gir_writer_write_indent (self);
	_tmp39_ = self->priv->buffer;
	g_string_append_printf (_tmp39_, "<type name=\"GLib.DestroyNotify\" c:type=\"GDestroyNotify\"/>\n");
	_tmp40_ = self->priv->indent;
	self->priv->indent = _tmp40_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp41_ = self->priv->buffer;
	g_string_append_printf (_tmp41_, "</%s>\n", tag_type);
}

static void
bala_gir_writer_write_params_and_return (BalaGIRWriter* self,
                                         const gchar* tag_name,
                                         BalaList* params,
                                         BalaList* type_params,
                                         BalaDataType* return_type,
                                         gboolean return_array_length,
                                         const gchar* return_comment,
                                         gboolean constructor,
                                         BalaParameter* instance_param,
                                         gboolean user_data)
{
	gint last_index = 0;
	gboolean _tmp0_ = FALSE;
	gboolean ret_is_struct = FALSE;
	gboolean _tmp1_ = FALSE;
	gboolean _tmp2_ = FALSE;
	gboolean _tmp3_ = FALSE;
	gint _tmp4_;
	gint _tmp5_;
	gboolean _tmp24_ = FALSE;
	gboolean _tmp27_ = FALSE;
	gboolean _tmp28_ = FALSE;
	gboolean _tmp29_ = FALSE;
	gboolean _tmp30_ = FALSE;
	gboolean _tmp31_ = FALSE;
	gint _tmp32_;
	gint _tmp33_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (tag_name != NULL);
	g_return_if_fail (params != NULL);
	last_index = 0;
	if (return_type != NULL) {
		_tmp0_ = bala_data_type_is_real_non_null_struct_type (return_type);
	} else {
		_tmp0_ = FALSE;
	}
	ret_is_struct = _tmp0_;
	_tmp4_ = bala_collection_get_size ((BalaCollection*) params);
	_tmp5_ = _tmp4_;
	if (_tmp5_ != 0) {
		_tmp3_ = TRUE;
	} else {
		gboolean _tmp6_ = FALSE;
		if (G_TYPE_CHECK_INSTANCE_TYPE (return_type, BALA_TYPE_ARRAY_TYPE)) {
			_tmp6_ = return_array_length;
		} else {
			_tmp6_ = FALSE;
		}
		_tmp3_ = _tmp6_;
	}
	if (_tmp3_) {
		_tmp2_ = TRUE;
	} else {
		_tmp2_ = G_TYPE_CHECK_INSTANCE_TYPE (return_type, BALA_TYPE_DELEGATE_TYPE);
	}
	if (_tmp2_) {
		_tmp1_ = TRUE;
	} else {
		_tmp1_ = ret_is_struct;
	}
	if (_tmp1_) {
		gint index = 0;
		index = 0;
		{
			BalaList* _param_list = NULL;
			BalaList* _tmp7_;
			gint _param_size = 0;
			BalaList* _tmp8_;
			gint _tmp9_;
			gint _tmp10_;
			gint _param_index = 0;
			_tmp7_ = _bala_iterable_ref0 (params);
			_param_list = _tmp7_;
			_tmp8_ = _param_list;
			_tmp9_ = bala_collection_get_size ((BalaCollection*) _tmp8_);
			_tmp10_ = _tmp9_;
			_param_size = _tmp10_;
			_param_index = -1;
			while (TRUE) {
				gint _tmp11_;
				gint _tmp12_;
				BalaParameter* param = NULL;
				BalaList* _tmp13_;
				gpointer _tmp14_;
				gint _tmp15_;
				BalaParameter* _tmp16_;
				BalaDataType* _tmp17_;
				BalaDataType* _tmp18_;
				BalaParameter* _tmp19_;
				_param_index = _param_index + 1;
				_tmp11_ = _param_index;
				_tmp12_ = _param_size;
				if (!(_tmp11_ < _tmp12_)) {
					break;
				}
				_tmp13_ = _param_list;
				_tmp14_ = bala_list_get (_tmp13_, _param_index);
				param = (BalaParameter*) _tmp14_;
				_tmp15_ = index;
				index = _tmp15_ + 1;
				_tmp16_ = param;
				_tmp17_ = bala_variable_get_variable_type ((BalaVariable*) _tmp16_);
				_tmp18_ = _tmp17_;
				_tmp19_ = param;
				bala_gir_writer_skip_implicit_params (self, _tmp18_, &index, bala_get_ccode_array_length ((BalaCodeNode*) _tmp19_));
				_bala_code_node_unref0 (param);
			}
			_bala_iterable_unref0 (_param_list);
		}
		if (ret_is_struct) {
			gint _tmp20_;
			_tmp20_ = index;
			index = _tmp20_ + 1;
		} else {
			gboolean _tmp21_ = FALSE;
			bala_gir_writer_skip_implicit_params (self, return_type, &index, return_array_length);
			if (G_TYPE_CHECK_INSTANCE_TYPE (return_type, BALA_TYPE_ARRAY_TYPE)) {
				_tmp21_ = return_array_length;
			} else {
				_tmp21_ = FALSE;
			}
			if (_tmp21_) {
				gint _tmp22_;
				gint _tmp23_;
				_tmp22_ = bala_array_type_get_rank (G_TYPE_CHECK_INSTANCE_CAST (return_type, BALA_TYPE_ARRAY_TYPE, BalaArrayType));
				_tmp23_ = _tmp22_;
				index -= _tmp23_ - 1;
			}
		}
		last_index = index - 1;
	}
	if (return_type != NULL) {
		_tmp24_ = !ret_is_struct;
	} else {
		_tmp24_ = FALSE;
	}
	if (_tmp24_) {
		bala_gir_writer_write_param_or_return (self, return_type, "return-value", &last_index, return_array_length, NULL, return_comment, BALA_PARAMETER_DIRECTION_IN, constructor, FALSE, FALSE);
	} else {
		if (ret_is_struct) {
			BalaVoidType* _tmp25_;
			BalaVoidType* _tmp26_;
			_tmp25_ = bala_void_type_new (NULL);
			_tmp26_ = _tmp25_;
			bala_gir_writer_write_param_or_return (self, (BalaDataType*) _tmp26_, "return-value", &last_index, FALSE, NULL, return_comment, BALA_PARAMETER_DIRECTION_IN, FALSE, FALSE, FALSE);
			_bala_code_node_unref0 (_tmp26_);
		}
	}
	_tmp32_ = bala_collection_get_size ((BalaCollection*) params);
	_tmp33_ = _tmp32_;
	if (_tmp33_ != 0) {
		_tmp31_ = TRUE;
	} else {
		gboolean _tmp34_ = FALSE;
		if (type_params != NULL) {
			gint _tmp35_;
			gint _tmp36_;
			_tmp35_ = bala_collection_get_size ((BalaCollection*) type_params);
			_tmp36_ = _tmp35_;
			_tmp34_ = _tmp36_ > 0;
		} else {
			_tmp34_ = FALSE;
		}
		_tmp31_ = _tmp34_;
	}
	if (_tmp31_) {
		_tmp30_ = TRUE;
	} else {
		_tmp30_ = instance_param != NULL;
	}
	if (_tmp30_) {
		_tmp29_ = TRUE;
	} else {
		gboolean _tmp37_ = FALSE;
		if (G_TYPE_CHECK_INSTANCE_TYPE (return_type, BALA_TYPE_ARRAY_TYPE)) {
			_tmp37_ = return_array_length;
		} else {
			_tmp37_ = FALSE;
		}
		_tmp29_ = _tmp37_;
	}
	if (_tmp29_) {
		_tmp28_ = TRUE;
	} else {
		_tmp28_ = G_TYPE_CHECK_INSTANCE_TYPE (return_type, BALA_TYPE_DELEGATE_TYPE);
	}
	if (_tmp28_) {
		_tmp27_ = TRUE;
	} else {
		_tmp27_ = ret_is_struct;
	}
	if (_tmp27_) {
		GString* _tmp38_;
		gint _tmp39_;
		gint index = 0;
		gint _tmp105_;
		GString* _tmp106_;
		bala_gir_writer_write_indent (self);
		_tmp38_ = self->priv->buffer;
		g_string_append_printf (_tmp38_, "<parameters>\n");
		_tmp39_ = self->priv->indent;
		self->priv->indent = _tmp39_ + 1;
		index = 0;
		if (instance_param != NULL) {
			BalaDataType* type = NULL;
			BalaDataType* _tmp40_;
			BalaDataType* _tmp41_;
			BalaDataType* _tmp42_;
			BalaStruct* st = NULL;
			BalaDataType* _tmp43_;
			BalaTypeSymbol* _tmp44_;
			BalaTypeSymbol* _tmp45_;
			gboolean _tmp46_ = FALSE;
			BalaStruct* _tmp47_;
			gint skip = 0;
			_tmp40_ = bala_variable_get_variable_type ((BalaVariable*) instance_param);
			_tmp41_ = _tmp40_;
			_tmp42_ = bala_data_type_copy (_tmp41_);
			type = _tmp42_;
			_tmp43_ = type;
			_tmp44_ = bala_data_type_get_type_symbol (_tmp43_);
			_tmp45_ = _tmp44_;
			st = G_TYPE_CHECK_INSTANCE_TYPE (_tmp45_, BALA_TYPE_STRUCT) ? ((BalaStruct*) _tmp45_) : NULL;
			_tmp47_ = st;
			if (_tmp47_ != NULL) {
				BalaStruct* _tmp48_;
				_tmp48_ = st;
				_tmp46_ = !bala_struct_is_simple_type (_tmp48_);
			} else {
				_tmp46_ = FALSE;
			}
			if (_tmp46_) {
				BalaDataType* _tmp49_;
				_tmp49_ = type;
				bala_data_type_set_nullable (_tmp49_, TRUE);
			}
			skip = 0;
			if (g_strcmp0 (tag_name, "callback") == 0) {
				BalaDataType* _tmp50_;
				gint _tmp51_;
				_tmp50_ = type;
				bala_gir_writer_write_param_or_return (self, _tmp50_, "parameter", &skip, FALSE, "self", NULL, BALA_PARAMETER_DIRECTION_IN, FALSE, FALSE, FALSE);
				_tmp51_ = index;
				index = _tmp51_ + 1;
			} else {
				BalaDataType* _tmp52_;
				_tmp52_ = type;
				bala_gir_writer_write_param_or_return (self, _tmp52_, "instance-parameter", &skip, FALSE, "self", NULL, BALA_PARAMETER_DIRECTION_IN, FALSE, FALSE, FALSE);
			}
			_bala_code_node_unref0 (type);
		}
		if (type_params != NULL) {
			{
				BalaList* _p_list = NULL;
				BalaList* _tmp53_;
				gint _p_size = 0;
				BalaList* _tmp54_;
				gint _tmp55_;
				gint _tmp56_;
				gint _p_index = 0;
				_tmp53_ = _bala_iterable_ref0 (type_params);
				_p_list = _tmp53_;
				_tmp54_ = _p_list;
				_tmp55_ = bala_collection_get_size ((BalaCollection*) _tmp54_);
				_tmp56_ = _tmp55_;
				_p_size = _tmp56_;
				_p_index = -1;
				while (TRUE) {
					gint _tmp57_;
					gint _tmp58_;
					BalaTypeParameter* p = NULL;
					BalaList* _tmp59_;
					gpointer _tmp60_;
					BalaTypeParameter* _tmp61_;
					_p_index = _p_index + 1;
					_tmp57_ = _p_index;
					_tmp58_ = _p_size;
					if (!(_tmp57_ < _tmp58_)) {
						break;
					}
					_tmp59_ = _p_list;
					_tmp60_ = bala_list_get (_tmp59_, _p_index);
					p = (BalaTypeParameter*) _tmp60_;
					_tmp61_ = p;
					bala_gir_writer_write_type_parameter (self, _tmp61_, "parameter");
					index += 3;
					_bala_code_node_unref0 (p);
				}
				_bala_iterable_unref0 (_p_list);
			}
		}
		{
			BalaList* _param_list = NULL;
			BalaList* _tmp62_;
			gint _param_size = 0;
			BalaList* _tmp63_;
			gint _tmp64_;
			gint _tmp65_;
			gint _param_index = 0;
			_tmp62_ = _bala_iterable_ref0 (params);
			_param_list = _tmp62_;
			_tmp63_ = _param_list;
			_tmp64_ = bala_collection_get_size ((BalaCollection*) _tmp63_);
			_tmp65_ = _tmp64_;
			_param_size = _tmp65_;
			_param_index = -1;
			while (TRUE) {
				gint _tmp66_;
				gint _tmp67_;
				BalaParameter* param = NULL;
				BalaList* _tmp68_;
				gpointer _tmp69_;
				gboolean _tmp70_ = FALSE;
				BalaParameter* _tmp71_;
				gboolean _tmp72_;
				gboolean _tmp73_;
				BalaParameter* _tmp77_;
				BalaDataType* _tmp78_;
				BalaDataType* _tmp79_;
				BalaParameter* _tmp80_;
				BalaParameter* _tmp81_;
				gchar* _tmp82_;
				gchar* _tmp83_;
				BalaParameter* _tmp84_;
				gchar* _tmp85_;
				gchar* _tmp86_;
				BalaParameter* _tmp87_;
				BalaParameterDirection _tmp88_;
				BalaParameterDirection _tmp89_;
				BalaParameter* _tmp90_;
				BalaDataType* _tmp91_;
				BalaDataType* _tmp92_;
				BalaParameter* _tmp93_;
				BalaParameter* _tmp94_;
				gchar* _tmp95_;
				gchar* _tmp96_;
				BalaParameter* _tmp97_;
				BalaParameterDirection _tmp98_;
				BalaParameterDirection _tmp99_;
				_param_index = _param_index + 1;
				_tmp66_ = _param_index;
				_tmp67_ = _param_size;
				if (!(_tmp66_ < _tmp67_)) {
					break;
				}
				_tmp68_ = _param_list;
				_tmp69_ = bala_list_get (_tmp68_, _param_index);
				param = (BalaParameter*) _tmp69_;
				_tmp71_ = param;
				_tmp72_ = bala_parameter_get_ellipsis (_tmp71_);
				_tmp73_ = _tmp72_;
				if (_tmp73_) {
					_tmp70_ = TRUE;
				} else {
					BalaParameter* _tmp74_;
					gboolean _tmp75_;
					gboolean _tmp76_;
					_tmp74_ = param;
					_tmp75_ = bala_parameter_get_params_array (_tmp74_);
					_tmp76_ = _tmp75_;
					_tmp70_ = _tmp76_;
				}
				_tmp77_ = param;
				_tmp78_ = bala_variable_get_variable_type ((BalaVariable*) _tmp77_);
				_tmp79_ = _tmp78_;
				_tmp80_ = param;
				_tmp81_ = param;
				_tmp82_ = bala_get_ccode_name ((BalaCodeNode*) _tmp81_);
				_tmp83_ = _tmp82_;
				_tmp84_ = param;
				_tmp85_ = bala_gir_writer_get_parameter_comment (self, _tmp84_);
				_tmp86_ = _tmp85_;
				_tmp87_ = param;
				_tmp88_ = bala_parameter_get_direction (_tmp87_);
				_tmp89_ = _tmp88_;
				bala_gir_writer_write_param_or_return (self, _tmp79_, "parameter", &index, bala_get_ccode_array_length ((BalaCodeNode*) _tmp80_), _tmp83_, _tmp86_, _tmp89_, FALSE, FALSE, _tmp70_);
				_g_free0 (_tmp86_);
				_g_free0 (_tmp83_);
				_tmp90_ = param;
				_tmp91_ = bala_variable_get_variable_type ((BalaVariable*) _tmp90_);
				_tmp92_ = _tmp91_;
				_tmp93_ = param;
				_tmp94_ = param;
				_tmp95_ = bala_get_ccode_name ((BalaCodeNode*) _tmp94_);
				_tmp96_ = _tmp95_;
				_tmp97_ = param;
				_tmp98_ = bala_parameter_get_direction (_tmp97_);
				_tmp99_ = _tmp98_;
				bala_gir_writer_write_implicit_params (self, _tmp92_, &index, bala_get_ccode_array_length ((BalaCodeNode*) _tmp93_), _tmp96_, _tmp99_);
				_g_free0 (_tmp96_);
				_bala_code_node_unref0 (param);
			}
			_bala_iterable_unref0 (_param_list);
		}
		if (ret_is_struct) {
			bala_gir_writer_write_param_or_return (self, return_type, "parameter", &index, FALSE, "result", return_comment, BALA_PARAMETER_DIRECTION_OUT, constructor, TRUE, FALSE);
		} else {
			bala_gir_writer_write_implicit_params (self, return_type, &index, return_array_length, "result", BALA_PARAMETER_DIRECTION_OUT);
		}
		if (user_data) {
			GString* _tmp100_;
			gint _tmp101_;
			GString* _tmp102_;
			gint _tmp103_;
			GString* _tmp104_;
			bala_gir_writer_write_indent (self);
			_tmp100_ = self->priv->buffer;
			g_string_append_printf (_tmp100_, "<parameter name=\"user_data\" transfer-ownership=\"none\" closure=\"%d" \
"\">\n", index);
			_tmp101_ = self->priv->indent;
			self->priv->indent = _tmp101_ + 1;
			bala_gir_writer_write_indent (self);
			_tmp102_ = self->priv->buffer;
			g_string_append_printf (_tmp102_, "<type name=\"gpointer\" c:type=\"void*\"/>\n");
			_tmp103_ = self->priv->indent;
			self->priv->indent = _tmp103_ - 1;
			bala_gir_writer_write_indent (self);
			_tmp104_ = self->priv->buffer;
			g_string_append_printf (_tmp104_, "</parameter>\n");
		}
		_tmp105_ = self->priv->indent;
		self->priv->indent = _tmp105_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp106_ = self->priv->buffer;
		g_string_append_printf (_tmp106_, "</parameters>\n");
	}
}

static void
bala_gir_writer_real_visit_delegate (BalaCodeVisitor* base,
                                     BalaDelegate* cb)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	GString* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	gboolean _tmp8_;
	gboolean _tmp9_;
	GString* _tmp11_;
	gint _tmp12_;
	gchar* _tmp13_;
	gchar* _tmp14_;
	BalaList* _tmp15_;
	BalaList* _tmp16_;
	BalaDataType* _tmp17_;
	BalaDataType* _tmp18_;
	gchar* _tmp19_;
	gchar* _tmp20_;
	gboolean _tmp21_;
	gboolean _tmp22_;
	gint _tmp23_;
	GString* _tmp24_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (cb != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) cb);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) cb)) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) cb)) {
		return;
	}
	bala_gir_writer_write_indent (self);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = bala_symbol_get_name ((BalaSymbol*) cb);
	_tmp4_ = _tmp3_;
	g_string_append_printf (_tmp2_, "<callback name=\"%s\"", _tmp4_);
	_tmp5_ = self->priv->buffer;
	_tmp6_ = bala_get_ccode_name ((BalaCodeNode*) cb);
	_tmp7_ = _tmp6_;
	g_string_append_printf (_tmp5_, " c:type=\"%s\"", _tmp7_);
	_g_free0 (_tmp7_);
	_tmp8_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) cb);
	_tmp9_ = _tmp8_;
	if (_tmp9_) {
		GString* _tmp10_;
		_tmp10_ = self->priv->buffer;
		g_string_append_printf (_tmp10_, " throws=\"1\"");
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) cb);
	_tmp11_ = self->priv->buffer;
	g_string_append_printf (_tmp11_, ">\n");
	_tmp12_ = self->priv->indent;
	self->priv->indent = _tmp12_ + 1;
	_tmp13_ = bala_gir_writer_get_delegate_comment (self, cb);
	_tmp14_ = _tmp13_;
	bala_gir_writer_write_doc (self, _tmp14_);
	_g_free0 (_tmp14_);
	_tmp15_ = bala_callable_get_parameters ((BalaCallable*) cb);
	_tmp16_ = bala_delegate_get_type_parameters (cb);
	_tmp17_ = bala_callable_get_return_type ((BalaCallable*) cb);
	_tmp18_ = _tmp17_;
	_tmp19_ = bala_gir_writer_get_delegate_return_comment (self, cb);
	_tmp20_ = _tmp19_;
	_tmp21_ = bala_delegate_get_has_target (cb);
	_tmp22_ = _tmp21_;
	bala_gir_writer_write_params_and_return (self, "callback", _tmp15_, _tmp16_, _tmp18_, bala_get_ccode_array_length ((BalaCodeNode*) cb), _tmp20_, FALSE, NULL, _tmp22_);
	_g_free0 (_tmp20_);
	_tmp23_ = self->priv->indent;
	self->priv->indent = _tmp23_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp24_ = self->priv->buffer;
	g_string_append_printf (_tmp24_, "</callback>\n");
}

static void
bala_gir_writer_real_visit_method (BalaCodeVisitor* base,
                                   BalaMethod* m)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_ = FALSE;
	gboolean _tmp3_ = FALSE;
	gchar* tag_name = NULL;
	gchar* _tmp14_;
	BalaSymbol* parent = NULL;
	BalaArrayList* _tmp15_;
	gpointer _tmp16_;
	BalaSymbol* _tmp17_;
	gboolean _tmp19_ = FALSE;
	gboolean _tmp20_ = FALSE;
	BalaSymbol* _tmp21_;
	gboolean _tmp28_ = FALSE;
	gboolean _tmp32_ = FALSE;
	gboolean _tmp33_;
	gboolean _tmp34_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (m != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) m);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) m)) {
		_tmp3_ = TRUE;
	} else {
		gboolean _tmp4_;
		gboolean _tmp5_;
		_tmp4_ = bala_method_get_overrides (m);
		_tmp5_ = _tmp4_;
		_tmp3_ = _tmp5_;
	}
	if (_tmp3_) {
		_tmp2_ = TRUE;
	} else {
		gboolean _tmp6_ = FALSE;
		gboolean _tmp7_ = FALSE;
		BalaMethod* _tmp8_;
		BalaMethod* _tmp9_;
		_tmp8_ = bala_method_get_base_interface_method (m);
		_tmp9_ = _tmp8_;
		if (_tmp9_ != NULL) {
			gboolean _tmp10_;
			gboolean _tmp11_;
			_tmp10_ = bala_method_get_is_abstract (m);
			_tmp11_ = _tmp10_;
			_tmp7_ = !_tmp11_;
		} else {
			_tmp7_ = FALSE;
		}
		if (_tmp7_) {
			gboolean _tmp12_;
			gboolean _tmp13_;
			_tmp12_ = bala_method_get_is_virtual (m);
			_tmp13_ = _tmp12_;
			_tmp6_ = !_tmp13_;
		} else {
			_tmp6_ = FALSE;
		}
		_tmp2_ = _tmp6_;
	}
	if (_tmp2_) {
		return;
	}
	if (!bala_gir_writer_has_namespace (self, (BalaSymbol*) m)) {
		return;
	}
	_tmp14_ = g_strdup ("method");
	tag_name = _tmp14_;
	_tmp15_ = self->priv->hierarchy;
	_tmp16_ = bala_list_get ((BalaList*) _tmp15_, 0);
	parent = (BalaSymbol*) _tmp16_;
	_tmp17_ = parent;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp17_, BALA_TYPE_ENUM)) {
		BalaArrayList* _tmp18_;
		_tmp18_ = self->priv->deferred;
		bala_collection_add ((BalaCollection*) _tmp18_, (BalaCodeNode*) m);
		_bala_code_node_unref0 (parent);
		_g_free0 (tag_name);
		return;
	}
	_tmp21_ = parent;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp21_, BALA_TYPE_NAMESPACE)) {
		_tmp20_ = TRUE;
	} else {
		BalaMemberBinding _tmp22_;
		BalaMemberBinding _tmp23_;
		_tmp22_ = bala_method_get_binding (m);
		_tmp23_ = _tmp22_;
		_tmp20_ = _tmp23_ == BALA_MEMBER_BINDING_STATIC;
	}
	if (_tmp20_) {
		_tmp19_ = TRUE;
	} else {
		BalaSymbol* _tmp24_;
		BalaSymbol* _tmp25_;
		BalaSymbol* _tmp26_;
		_tmp24_ = parent;
		_tmp25_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
		_tmp26_ = _tmp25_;
		_tmp19_ = _tmp24_ != _tmp26_;
	}
	if (_tmp19_) {
		gchar* _tmp27_;
		_tmp27_ = g_strdup ("function");
		_g_free0 (tag_name);
		tag_name = _tmp27_;
	}
	if (!bala_get_ccode_no_wrapper (m)) {
		BalaSignal* _tmp29_;
		BalaSignal* _tmp30_;
		_tmp29_ = bala_method_get_signal_reference (m);
		_tmp30_ = _tmp29_;
		_tmp28_ = _tmp30_ == NULL;
	} else {
		_tmp28_ = FALSE;
	}
	if (_tmp28_) {
		const gchar* _tmp31_;
		_tmp31_ = tag_name;
		bala_gir_writer_write_signature (self, m, _tmp31_, TRUE, FALSE, TRUE);
	}
	_tmp33_ = bala_method_get_is_abstract (m);
	_tmp34_ = _tmp33_;
	if (_tmp34_) {
		_tmp32_ = TRUE;
	} else {
		gboolean _tmp35_;
		gboolean _tmp36_;
		_tmp35_ = bala_method_get_is_virtual (m);
		_tmp36_ = _tmp35_;
		_tmp32_ = _tmp36_;
	}
	if (_tmp32_) {
		bala_gir_writer_write_signature (self, m, "virtual-method", TRUE, FALSE, TRUE);
	}
	_bala_code_node_unref0 (parent);
	_g_free0 (tag_name);
}

static gboolean
bala_gir_writer_is_type_introspectable (BalaGIRWriter* self,
                                        BalaDataType* type)
{
	gchar* _tmp0_;
	gchar* _tmp1_;
	gboolean _tmp2_;
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (type != NULL, FALSE);
	_tmp0_ = bala_get_ccode_name ((BalaCodeNode*) type);
	_tmp1_ = _tmp0_;
	_tmp2_ = g_strcmp0 (_tmp1_, "va_list") == 0;
	_g_free0 (_tmp1_);
	if (_tmp2_) {
		result = FALSE;
		return result;
	}
	result = TRUE;
	return result;
}

static gboolean
bala_gir_writer_is_method_introspectable (BalaGIRWriter* self,
                                          BalaMethod* m)
{
	BalaDataType* _tmp0_;
	BalaDataType* _tmp1_;
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (m != NULL, FALSE);
	_tmp0_ = bala_callable_get_return_type ((BalaCallable*) m);
	_tmp1_ = _tmp0_;
	if (!bala_gir_writer_is_type_introspectable (self, _tmp1_)) {
		result = FALSE;
		return result;
	}
	{
		BalaList* _param_list = NULL;
		BalaList* _tmp2_;
		BalaList* _tmp3_;
		gint _param_size = 0;
		BalaList* _tmp4_;
		gint _tmp5_;
		gint _tmp6_;
		gint _param_index = 0;
		_tmp2_ = bala_callable_get_parameters ((BalaCallable*) m);
		_tmp3_ = _bala_iterable_ref0 (_tmp2_);
		_param_list = _tmp3_;
		_tmp4_ = _param_list;
		_tmp5_ = bala_collection_get_size ((BalaCollection*) _tmp4_);
		_tmp6_ = _tmp5_;
		_param_size = _tmp6_;
		_param_index = -1;
		while (TRUE) {
			gint _tmp7_;
			gint _tmp8_;
			BalaParameter* param = NULL;
			BalaList* _tmp9_;
			gpointer _tmp10_;
			gboolean _tmp11_ = FALSE;
			gboolean _tmp12_ = FALSE;
			BalaParameter* _tmp13_;
			gboolean _tmp14_;
			gboolean _tmp15_;
			_param_index = _param_index + 1;
			_tmp7_ = _param_index;
			_tmp8_ = _param_size;
			if (!(_tmp7_ < _tmp8_)) {
				break;
			}
			_tmp9_ = _param_list;
			_tmp10_ = bala_list_get (_tmp9_, _param_index);
			param = (BalaParameter*) _tmp10_;
			_tmp13_ = param;
			_tmp14_ = bala_parameter_get_ellipsis (_tmp13_);
			_tmp15_ = _tmp14_;
			if (_tmp15_) {
				_tmp12_ = TRUE;
			} else {
				BalaParameter* _tmp16_;
				gboolean _tmp17_;
				gboolean _tmp18_;
				_tmp16_ = param;
				_tmp17_ = bala_parameter_get_params_array (_tmp16_);
				_tmp18_ = _tmp17_;
				_tmp12_ = _tmp18_;
			}
			if (_tmp12_) {
				_tmp11_ = TRUE;
			} else {
				BalaParameter* _tmp19_;
				BalaDataType* _tmp20_;
				BalaDataType* _tmp21_;
				_tmp19_ = param;
				_tmp20_ = bala_variable_get_variable_type ((BalaVariable*) _tmp19_);
				_tmp21_ = _tmp20_;
				_tmp11_ = !bala_gir_writer_is_type_introspectable (self, _tmp21_);
			}
			if (_tmp11_) {
				result = FALSE;
				_bala_code_node_unref0 (param);
				_bala_iterable_unref0 (_param_list);
				return result;
			}
			_bala_code_node_unref0 (param);
		}
		_bala_iterable_unref0 (_param_list);
	}
	result = TRUE;
	return result;
}

static gboolean
bala_gir_writer_is_introspectable (BalaGIRWriter* self,
                                   BalaSymbol* sym)
{
	gboolean _tmp0_ = FALSE;
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	if (G_TYPE_CHECK_INSTANCE_TYPE (sym, BALA_TYPE_METHOD)) {
		_tmp0_ = !bala_gir_writer_is_method_introspectable (self, G_TYPE_CHECK_INSTANCE_CAST (sym, BALA_TYPE_METHOD, BalaMethod));
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		result = FALSE;
		return result;
	}
	result = bala_gir_writer_is_visibility (self, sym);
	return result;
}

static void
bala_gir_writer_write_signature (BalaGIRWriter* self,
                                 BalaMethod* m,
                                 const gchar* tag_name,
                                 gboolean write_doc,
                                 gboolean instance,
                                 gboolean write_attributes)
{
	BalaSymbol* parent = NULL;
	BalaArrayList* _tmp0_;
	gpointer _tmp1_;
	gchar* name = NULL;
	BalaSymbol* _tmp2_;
	BalaSymbol* _tmp3_;
	BalaSymbol* _tmp4_;
	gboolean _tmp18_;
	gboolean _tmp19_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (m != NULL);
	g_return_if_fail (tag_name != NULL);
	_tmp0_ = self->priv->hierarchy;
	_tmp1_ = bala_list_get ((BalaList*) _tmp0_, 0);
	parent = (BalaSymbol*) _tmp1_;
	_tmp2_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
	_tmp3_ = _tmp2_;
	_tmp4_ = parent;
	if (_tmp3_ != _tmp4_) {
		gchar* _tmp5_;
		gchar* parent_prefix = NULL;
		BalaSymbol* _tmp6_;
		gchar* _tmp7_;
		const gchar* _tmp8_;
		const gchar* _tmp9_;
		instance = FALSE;
		_tmp5_ = bala_get_ccode_name ((BalaCodeNode*) m);
		_g_free0 (name);
		name = _tmp5_;
		_tmp6_ = parent;
		_tmp7_ = bala_get_ccode_lower_case_prefix (_tmp6_);
		parent_prefix = _tmp7_;
		_tmp8_ = name;
		_tmp9_ = parent_prefix;
		if (g_str_has_prefix (_tmp8_, _tmp9_)) {
			const gchar* _tmp10_;
			const gchar* _tmp11_;
			gint _tmp12_;
			gint _tmp13_;
			gchar* _tmp14_;
			_tmp10_ = name;
			_tmp11_ = parent_prefix;
			_tmp12_ = strlen (_tmp11_);
			_tmp13_ = _tmp12_;
			_tmp14_ = string_substring (_tmp10_, (glong) _tmp13_, (glong) -1);
			_g_free0 (name);
			name = _tmp14_;
		}
		_g_free0 (parent_prefix);
	} else {
		const gchar* _tmp15_;
		const gchar* _tmp16_;
		gchar* _tmp17_;
		_tmp15_ = bala_symbol_get_name ((BalaSymbol*) m);
		_tmp16_ = _tmp15_;
		_tmp17_ = g_strdup (_tmp16_);
		_g_free0 (name);
		name = _tmp17_;
	}
	_tmp18_ = bala_method_get_coroutine (m);
	_tmp19_ = _tmp18_;
	if (_tmp19_) {
		gchar* finish_name = NULL;
		const gchar* _tmp20_;
		gchar* _tmp21_;
		const gchar* _tmp22_;
		const gchar* _tmp30_;
		gchar* _tmp31_;
		const gchar* _tmp32_;
		gchar* _tmp33_;
		gchar* _tmp34_;
		BalaList* _tmp35_;
		BalaList* _tmp36_;
		BalaVoidType* _tmp37_;
		BalaVoidType* _tmp38_;
		const gchar* _tmp39_;
		gchar* _tmp40_;
		gchar* _tmp41_;
		BalaList* _tmp42_;
		BalaList* _tmp43_;
		BalaDataType* _tmp44_;
		BalaDataType* _tmp45_;
		gboolean _tmp46_;
		gboolean _tmp47_;
		_tmp20_ = name;
		_tmp21_ = g_strdup (_tmp20_);
		finish_name = _tmp21_;
		_tmp22_ = finish_name;
		if (g_str_has_suffix (_tmp22_, "_async")) {
			const gchar* _tmp23_;
			const gchar* _tmp24_;
			gint _tmp25_;
			gint _tmp26_;
			gint _tmp27_;
			gint _tmp28_;
			gchar* _tmp29_;
			_tmp23_ = finish_name;
			_tmp24_ = finish_name;
			_tmp25_ = strlen (_tmp24_);
			_tmp26_ = _tmp25_;
			_tmp27_ = strlen ("_async");
			_tmp28_ = _tmp27_;
			_tmp29_ = string_substring (_tmp23_, (glong) 0, (glong) (_tmp26_ - _tmp28_));
			_g_free0 (finish_name);
			finish_name = _tmp29_;
		}
		_tmp30_ = finish_name;
		_tmp31_ = g_strconcat (_tmp30_, "_finish", NULL);
		_g_free0 (finish_name);
		finish_name = _tmp31_;
		_tmp32_ = name;
		_tmp33_ = bala_get_ccode_name ((BalaCodeNode*) m);
		_tmp34_ = _tmp33_;
		_tmp35_ = bala_method_get_async_begin_parameters (m);
		_tmp36_ = _tmp35_;
		_tmp37_ = bala_void_type_new (NULL);
		_tmp38_ = _tmp37_;
		bala_gir_writer_do_write_signature (self, m, tag_name, instance, _tmp32_, _tmp34_, _tmp36_, (BalaDataType*) _tmp38_, FALSE, TRUE, write_attributes);
		_bala_code_node_unref0 (_tmp38_);
		_bala_iterable_unref0 (_tmp36_);
		_g_free0 (_tmp34_);
		_tmp39_ = finish_name;
		_tmp40_ = bala_get_ccode_finish_name (m);
		_tmp41_ = _tmp40_;
		_tmp42_ = bala_method_get_async_end_parameters (m);
		_tmp43_ = _tmp42_;
		_tmp44_ = bala_callable_get_return_type ((BalaCallable*) m);
		_tmp45_ = _tmp44_;
		_tmp46_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) m);
		_tmp47_ = _tmp46_;
		bala_gir_writer_do_write_signature (self, m, tag_name, instance, _tmp39_, _tmp41_, _tmp43_, _tmp45_, _tmp47_, FALSE, write_attributes);
		_bala_iterable_unref0 (_tmp43_);
		_g_free0 (_tmp41_);
		_g_free0 (finish_name);
	} else {
		const gchar* _tmp48_;
		gchar* _tmp49_;
		gchar* _tmp50_;
		BalaList* _tmp51_;
		BalaDataType* _tmp52_;
		BalaDataType* _tmp53_;
		gboolean _tmp54_;
		gboolean _tmp55_;
		_tmp48_ = name;
		_tmp49_ = bala_get_ccode_name ((BalaCodeNode*) m);
		_tmp50_ = _tmp49_;
		_tmp51_ = bala_callable_get_parameters ((BalaCallable*) m);
		_tmp52_ = bala_callable_get_return_type ((BalaCallable*) m);
		_tmp53_ = _tmp52_;
		_tmp54_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) m);
		_tmp55_ = _tmp54_;
		bala_gir_writer_do_write_signature (self, m, tag_name, instance, _tmp48_, _tmp50_, _tmp51_, _tmp53_, _tmp55_, TRUE, write_attributes);
		_g_free0 (_tmp50_);
	}
	_g_free0 (name);
	_bala_code_node_unref0 (parent);
}

static void
bala_gir_writer_do_write_signature (BalaGIRWriter* self,
                                    BalaMethod* m,
                                    const gchar* tag_name,
                                    gboolean instance,
                                    const gchar* name,
                                    const gchar* cname,
                                    BalaList* params,
                                    BalaDataType* return_type,
                                    gboolean can_fail,
                                    gboolean write_comment,
                                    gboolean write_attributes)
{
	GString* _tmp0_;
	GString* _tmp5_;
	gint _tmp6_;
	gchar* return_comment = NULL;
	BalaList* _tmp10_;
	const gchar* _tmp11_;
	BalaParameter* _tmp12_;
	BalaParameter* _tmp13_;
	gint _tmp14_;
	GString* _tmp15_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (m != NULL);
	g_return_if_fail (tag_name != NULL);
	g_return_if_fail (name != NULL);
	g_return_if_fail (cname != NULL);
	g_return_if_fail (params != NULL);
	g_return_if_fail (return_type != NULL);
	bala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<%s name=\"%s\"", tag_name, name);
	if (g_strcmp0 (tag_name, "virtual-method") == 0) {
		if (!bala_get_ccode_no_wrapper (m)) {
			GString* _tmp1_;
			_tmp1_ = self->priv->buffer;
			g_string_append_printf (_tmp1_, " invoker=\"%s\"", name);
		}
	} else {
		if (g_strcmp0 (tag_name, "callback") == 0) {
			GString* _tmp2_;
			_tmp2_ = self->priv->buffer;
			g_string_append_printf (_tmp2_, " c:type=\"%s\"", name);
		} else {
			GString* _tmp3_;
			_tmp3_ = self->priv->buffer;
			g_string_append_printf (_tmp3_, " c:identifier=\"%s\"", cname);
		}
	}
	if (can_fail) {
		GString* _tmp4_;
		_tmp4_ = self->priv->buffer;
		g_string_append_printf (_tmp4_, " throws=\"1\"");
	}
	if (write_attributes) {
		bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) m);
	}
	_tmp5_ = self->priv->buffer;
	g_string_append_printf (_tmp5_, ">\n");
	_tmp6_ = self->priv->indent;
	self->priv->indent = _tmp6_ + 1;
	return_comment = NULL;
	if (write_comment) {
		gchar* _tmp7_;
		gchar* _tmp8_;
		gchar* _tmp9_;
		_tmp7_ = bala_gir_writer_get_method_return_comment (self, m);
		_g_free0 (return_comment);
		return_comment = _tmp7_;
		_tmp8_ = bala_gir_writer_get_method_comment (self, m);
		_tmp9_ = _tmp8_;
		bala_gir_writer_write_doc (self, _tmp9_);
		_g_free0 (_tmp9_);
	}
	_tmp10_ = bala_method_get_type_parameters (m);
	_tmp11_ = return_comment;
	_tmp12_ = bala_method_get_this_parameter (m);
	_tmp13_ = _tmp12_;
	bala_gir_writer_write_params_and_return (self, tag_name, params, _tmp10_, return_type, bala_get_ccode_array_length ((BalaCodeNode*) m), _tmp11_, FALSE, _tmp13_, FALSE);
	_tmp14_ = self->priv->indent;
	self->priv->indent = _tmp14_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp15_ = self->priv->buffer;
	g_string_append_printf (_tmp15_, "</%s>\n", tag_name);
	_g_free0 (return_comment);
}

static void
bala_gir_writer_real_visit_creation_method (BalaCodeVisitor* base,
                                            BalaCreationMethod* m)
{
	BalaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_ = FALSE;
	BalaSymbol* _tmp3_;
	BalaSymbol* _tmp4_;
	gboolean is_struct = FALSE;
	BalaSymbol* _tmp9_;
	BalaSymbol* _tmp10_;
	const gchar* _tmp11_ = NULL;
	gchar* tag_name = NULL;
	gchar* _tmp12_;
	gboolean _tmp13_ = FALSE;
	gboolean _tmp14_ = FALSE;
	BalaSymbol* _tmp15_;
	BalaSymbol* _tmp16_;
	gboolean _tmp41_;
	gboolean _tmp42_;
	GString* _tmp44_;
	gint _tmp45_;
	gchar* _tmp46_;
	gchar* _tmp47_;
	BalaDataType* datatype = NULL;
	BalaSymbol* _tmp48_;
	BalaSymbol* _tmp49_;
	BalaDataType* _tmp50_;
	BalaList* type_params = NULL;
	BalaSymbol* _tmp51_;
	BalaSymbol* _tmp52_;
	const gchar* _tmp57_;
	BalaList* _tmp58_;
	BalaList* _tmp59_;
	BalaDataType* _tmp60_;
	gchar* _tmp61_;
	gchar* _tmp62_;
	gint _tmp63_;
	GString* _tmp64_;
	const gchar* _tmp65_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (m != NULL);
	_tmp0_ = bala_symbol_get_external_package ((BalaSymbol*) m);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) m)) {
		return;
	}
	_tmp3_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
	_tmp4_ = _tmp3_;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, BALA_TYPE_CLASS)) {
		BalaSymbol* _tmp5_;
		BalaSymbol* _tmp6_;
		gboolean _tmp7_;
		gboolean _tmp8_;
		_tmp5_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
		_tmp6_ = _tmp5_;
		_tmp7_ = bala_class_get_is_abstract (G_TYPE_CHECK_INSTANCE_CAST (_tmp6_, BALA_TYPE_CLASS, BalaClass));
		_tmp8_ = _tmp7_;
		_tmp2_ = _tmp8_;
	} else {
		_tmp2_ = FALSE;
	}
	if (_tmp2_) {
		return;
	}
	bala_gir_writer_write_indent (self);
	_tmp9_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
	_tmp10_ = _tmp9_;
	is_struct = G_TYPE_CHECK_INSTANCE_TYPE (_tmp10_, BALA_TYPE_STRUCT);
	if (is_struct) {
		_tmp11_ = "function";
	} else {
		_tmp11_ = "constructor";
	}
	_tmp12_ = g_strdup (_tmp11_);
	tag_name = _tmp12_;
	_tmp15_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
	_tmp16_ = _tmp15_;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp16_, BALA_TYPE_CLASS)) {
		BalaSymbol* _tmp17_;
		BalaSymbol* _tmp18_;
		BalaCreationMethod* _tmp19_;
		BalaCreationMethod* _tmp20_;
		_tmp17_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
		_tmp18_ = _tmp17_;
		_tmp19_ = bala_class_get_default_construction_method (G_TYPE_CHECK_INSTANCE_CAST (_tmp18_, BALA_TYPE_CLASS, BalaClass));
		_tmp20_ = _tmp19_;
		_tmp14_ = m == _tmp20_;
	} else {
		_tmp14_ = FALSE;
	}
	if (_tmp14_) {
		_tmp13_ = TRUE;
	} else {
		gboolean _tmp21_ = FALSE;
		BalaSymbol* _tmp22_;
		BalaSymbol* _tmp23_;
		_tmp22_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
		_tmp23_ = _tmp22_;
		if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp23_, BALA_TYPE_STRUCT)) {
			BalaSymbol* _tmp24_;
			BalaSymbol* _tmp25_;
			BalaCreationMethod* _tmp26_;
			BalaCreationMethod* _tmp27_;
			_tmp24_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
			_tmp25_ = _tmp24_;
			_tmp26_ = bala_struct_get_default_construction_method (G_TYPE_CHECK_INSTANCE_CAST (_tmp25_, BALA_TYPE_STRUCT, BalaStruct));
			_tmp27_ = _tmp26_;
			_tmp21_ = m == _tmp27_;
		} else {
			_tmp21_ = FALSE;
		}
		_tmp13_ = _tmp21_;
	}
	if (_tmp13_) {
		const gchar* _tmp28_ = NULL;
		gchar* m_name = NULL;
		gchar* _tmp29_;
		GString* _tmp30_;
		const gchar* _tmp31_;
		const gchar* _tmp32_;
		gchar* _tmp33_;
		gchar* _tmp34_;
		if (is_struct) {
			_tmp28_ = "init";
		} else {
			_tmp28_ = "new";
		}
		_tmp29_ = g_strdup (_tmp28_);
		m_name = _tmp29_;
		_tmp30_ = self->priv->buffer;
		_tmp31_ = tag_name;
		_tmp32_ = m_name;
		_tmp33_ = bala_get_ccode_name ((BalaCodeNode*) m);
		_tmp34_ = _tmp33_;
		g_string_append_printf (_tmp30_, "<%s name=\"%s\" c:identifier=\"%s\"", _tmp31_, _tmp32_, _tmp34_);
		_g_free0 (_tmp34_);
		_g_free0 (m_name);
	} else {
		GString* _tmp35_;
		const gchar* _tmp36_;
		const gchar* _tmp37_;
		const gchar* _tmp38_;
		gchar* _tmp39_;
		gchar* _tmp40_;
		_tmp35_ = self->priv->buffer;
		_tmp36_ = tag_name;
		_tmp37_ = bala_symbol_get_name ((BalaSymbol*) m);
		_tmp38_ = _tmp37_;
		_tmp39_ = bala_get_ccode_name ((BalaCodeNode*) m);
		_tmp40_ = _tmp39_;
		g_string_append_printf (_tmp35_, "<%s name=\"%s\" c:identifier=\"%s\"", _tmp36_, _tmp38_, _tmp40_);
		_g_free0 (_tmp40_);
	}
	_tmp41_ = bala_code_node_get_tree_can_fail ((BalaCodeNode*) m);
	_tmp42_ = _tmp41_;
	if (_tmp42_) {
		GString* _tmp43_;
		_tmp43_ = self->priv->buffer;
		g_string_append_printf (_tmp43_, " throws=\"1\"");
	}
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) m);
	_tmp44_ = self->priv->buffer;
	g_string_append_printf (_tmp44_, ">\n");
	_tmp45_ = self->priv->indent;
	self->priv->indent = _tmp45_ + 1;
	_tmp46_ = bala_gir_writer_get_method_comment (self, (BalaMethod*) m);
	_tmp47_ = _tmp46_;
	bala_gir_writer_write_doc (self, _tmp47_);
	_g_free0 (_tmp47_);
	_tmp48_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
	_tmp49_ = _tmp48_;
	_tmp50_ = bala_semantic_analyzer_get_data_type_for_symbol (_tmp49_);
	datatype = _tmp50_;
	type_params = NULL;
	_tmp51_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
	_tmp52_ = _tmp51_;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp52_, BALA_TYPE_CLASS)) {
		BalaSymbol* _tmp53_;
		BalaSymbol* _tmp54_;
		BalaList* _tmp55_;
		BalaList* _tmp56_;
		_tmp53_ = bala_symbol_get_parent_symbol ((BalaSymbol*) m);
		_tmp54_ = _tmp53_;
		_tmp55_ = bala_object_type_symbol_get_type_parameters ((BalaObjectTypeSymbol*) G_TYPE_CHECK_INSTANCE_CAST (_tmp54_, BALA_TYPE_CLASS, BalaClass));
		_tmp56_ = _bala_iterable_ref0 (_tmp55_);
		_bala_iterable_unref0 (type_params);
		type_params = _tmp56_;
	}
	_tmp57_ = tag_name;
	_tmp58_ = bala_callable_get_parameters ((BalaCallable*) m);
	_tmp59_ = type_params;
	_tmp60_ = datatype;
	_tmp61_ = bala_gir_writer_get_method_return_comment (self, (BalaMethod*) m);
	_tmp62_ = _tmp61_;
	bala_gir_writer_write_params_and_return (self, _tmp57_, _tmp58_, _tmp59_, _tmp60_, FALSE, _tmp62_, TRUE, NULL, FALSE);
	_g_free0 (_tmp62_);
	_tmp63_ = self->priv->indent;
	self->priv->indent = _tmp63_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp64_ = self->priv->buffer;
	_tmp65_ = tag_name;
	g_string_append_printf (_tmp64_, "</%s>\n", _tmp65_);
	_bala_iterable_unref0 (type_params);
	_bala_code_node_unref0 (datatype);
	_g_free0 (tag_name);
}

static void
bala_gir_writer_real_visit_property (BalaCodeVisitor* base,
                                     BalaProperty* prop)
{
	BalaGIRWriter * self;
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	BalaCodeContext* _tmp12_;
	BalaSemanticAnalyzer* _tmp13_;
	BalaSemanticAnalyzer* _tmp14_;
	BalaPropertyAccessor* _tmp42_;
	BalaPropertyAccessor* _tmp43_;
	BalaPropertyAccessor* _tmp49_;
	BalaPropertyAccessor* _tmp50_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (prop != NULL);
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) prop)) {
		_tmp1_ = TRUE;
	} else {
		gboolean _tmp2_;
		gboolean _tmp3_;
		_tmp2_ = bala_property_get_overrides (prop);
		_tmp3_ = _tmp2_;
		_tmp1_ = _tmp3_;
	}
	if (_tmp1_) {
		_tmp0_ = TRUE;
	} else {
		gboolean _tmp4_ = FALSE;
		gboolean _tmp5_ = FALSE;
		BalaProperty* _tmp6_;
		BalaProperty* _tmp7_;
		_tmp6_ = bala_property_get_base_interface_property (prop);
		_tmp7_ = _tmp6_;
		if (_tmp7_ != NULL) {
			gboolean _tmp8_;
			gboolean _tmp9_;
			_tmp8_ = bala_property_get_is_abstract (prop);
			_tmp9_ = _tmp8_;
			_tmp5_ = !_tmp9_;
		} else {
			_tmp5_ = FALSE;
		}
		if (_tmp5_) {
			gboolean _tmp10_;
			gboolean _tmp11_;
			_tmp10_ = bala_property_get_is_virtual (prop);
			_tmp11_ = _tmp10_;
			_tmp4_ = !_tmp11_;
		} else {
			_tmp4_ = FALSE;
		}
		_tmp0_ = _tmp4_;
	}
	if (_tmp0_) {
		return;
	}
	_tmp12_ = self->priv->context;
	_tmp13_ = bala_code_context_get_analyzer (_tmp12_);
	_tmp14_ = _tmp13_;
	if (bala_semantic_analyzer_is_gobject_property (_tmp14_, prop)) {
		GString* _tmp15_;
		gchar* _tmp16_;
		gchar* _tmp17_;
		BalaPropertyAccessor* _tmp18_;
		BalaPropertyAccessor* _tmp19_;
		BalaPropertyAccessor* _tmp21_;
		BalaPropertyAccessor* _tmp22_;
		GString* _tmp34_;
		gint _tmp35_;
		gchar* _tmp36_;
		gchar* _tmp37_;
		BalaDataType* _tmp38_;
		BalaDataType* _tmp39_;
		gint _tmp40_;
		GString* _tmp41_;
		bala_gir_writer_write_indent (self);
		_tmp15_ = self->priv->buffer;
		_tmp16_ = bala_get_ccode_name ((BalaCodeNode*) prop);
		_tmp17_ = _tmp16_;
		g_string_append_printf (_tmp15_, "<property name=\"%s\"", _tmp17_);
		_g_free0 (_tmp17_);
		_tmp18_ = bala_property_get_get_accessor (prop);
		_tmp19_ = _tmp18_;
		if (_tmp19_ == NULL) {
			GString* _tmp20_;
			_tmp20_ = self->priv->buffer;
			g_string_append_printf (_tmp20_, " readable=\"0\"");
		}
		_tmp21_ = bala_property_get_set_accessor (prop);
		_tmp22_ = _tmp21_;
		if (_tmp22_ != NULL) {
			GString* _tmp23_;
			BalaPropertyAccessor* _tmp24_;
			BalaPropertyAccessor* _tmp25_;
			gboolean _tmp26_;
			gboolean _tmp27_;
			_tmp23_ = self->priv->buffer;
			g_string_append_printf (_tmp23_, " writable=\"1\"");
			_tmp24_ = bala_property_get_set_accessor (prop);
			_tmp25_ = _tmp24_;
			_tmp26_ = bala_property_accessor_get_construction (_tmp25_);
			_tmp27_ = _tmp26_;
			if (_tmp27_) {
				BalaPropertyAccessor* _tmp28_;
				BalaPropertyAccessor* _tmp29_;
				gboolean _tmp30_;
				gboolean _tmp31_;
				_tmp28_ = bala_property_get_set_accessor (prop);
				_tmp29_ = _tmp28_;
				_tmp30_ = bala_property_accessor_get_writable (_tmp29_);
				_tmp31_ = _tmp30_;
				if (!_tmp31_) {
					GString* _tmp32_;
					_tmp32_ = self->priv->buffer;
					g_string_append_printf (_tmp32_, " construct-only=\"1\"");
				} else {
					GString* _tmp33_;
					_tmp33_ = self->priv->buffer;
					g_string_append_printf (_tmp33_, " construct=\"1\"");
				}
			}
		}
		bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) prop);
		_tmp34_ = self->priv->buffer;
		g_string_append_printf (_tmp34_, ">\n");
		_tmp35_ = self->priv->indent;
		self->priv->indent = _tmp35_ + 1;
		_tmp36_ = bala_gir_writer_get_property_comment (self, prop);
		_tmp37_ = _tmp36_;
		bala_gir_writer_write_doc (self, _tmp37_);
		_g_free0 (_tmp37_);
		_tmp38_ = bala_property_get_property_type (prop);
		_tmp39_ = _tmp38_;
		bala_gir_writer_write_type (self, _tmp39_, -1, BALA_PARAMETER_DIRECTION_IN);
		_tmp40_ = self->priv->indent;
		self->priv->indent = _tmp40_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp41_ = self->priv->buffer;
		g_string_append_printf (_tmp41_, "</property>\n");
	}
	_tmp42_ = bala_property_get_get_accessor (prop);
	_tmp43_ = _tmp42_;
	if (_tmp43_ != NULL) {
		BalaMethod* m = NULL;
		BalaPropertyAccessor* _tmp44_;
		BalaPropertyAccessor* _tmp45_;
		BalaMethod* _tmp46_;
		BalaMethod* _tmp47_;
		_tmp44_ = bala_property_get_get_accessor (prop);
		_tmp45_ = _tmp44_;
		_tmp46_ = bala_property_accessor_get_method (_tmp45_);
		m = _tmp46_;
		_tmp47_ = m;
		if (_tmp47_ != NULL) {
			BalaMethod* _tmp48_;
			_tmp48_ = m;
			bala_code_visitor_visit_method ((BalaCodeVisitor*) self, _tmp48_);
		}
		_bala_code_node_unref0 (m);
	}
	_tmp49_ = bala_property_get_set_accessor (prop);
	_tmp50_ = _tmp49_;
	if (_tmp50_ != NULL) {
		BalaMethod* m = NULL;
		BalaPropertyAccessor* _tmp51_;
		BalaPropertyAccessor* _tmp52_;
		BalaMethod* _tmp53_;
		BalaMethod* _tmp54_;
		_tmp51_ = bala_property_get_set_accessor (prop);
		_tmp52_ = _tmp51_;
		_tmp53_ = bala_property_accessor_get_method (_tmp52_);
		m = _tmp53_;
		_tmp54_ = m;
		if (_tmp54_ != NULL) {
			BalaMethod* _tmp55_;
			_tmp55_ = m;
			bala_code_visitor_visit_method ((BalaCodeVisitor*) self, _tmp55_);
		}
		_bala_code_node_unref0 (m);
	}
}

static void
bala_gir_writer_real_visit_signal (BalaCodeVisitor* base,
                                   BalaSignal* sig)
{
	BalaGIRWriter * self;
	BalaMethod* _tmp0_;
	BalaMethod* _tmp1_;
	BalaMethod* _tmp4_;
	BalaMethod* _tmp5_;
	GString* _tmp8_;
	gchar* _tmp9_;
	gchar* _tmp10_;
	GString* _tmp11_;
	gint _tmp12_;
	gchar* _tmp13_;
	gchar* _tmp14_;
	BalaList* _tmp15_;
	BalaDataType* _tmp16_;
	BalaDataType* _tmp17_;
	gchar* _tmp18_;
	gchar* _tmp19_;
	gint _tmp20_;
	GString* _tmp21_;
	self = (BalaGIRWriter*) base;
	g_return_if_fail (sig != NULL);
	if (!bala_gir_writer_check_accessibility (self, (BalaSymbol*) sig)) {
		return;
	}
	_tmp0_ = bala_signal_get_emitter (sig);
	_tmp1_ = _tmp0_;
	if (_tmp1_ != NULL) {
		BalaMethod* _tmp2_;
		BalaMethod* _tmp3_;
		_tmp2_ = bala_signal_get_emitter (sig);
		_tmp3_ = _tmp2_;
		bala_code_node_accept ((BalaCodeNode*) _tmp3_, (BalaCodeVisitor*) self);
	}
	_tmp4_ = bala_signal_get_default_handler (sig);
	_tmp5_ = _tmp4_;
	if (_tmp5_ != NULL) {
		BalaMethod* _tmp6_;
		BalaMethod* _tmp7_;
		_tmp6_ = bala_signal_get_default_handler (sig);
		_tmp7_ = _tmp6_;
		bala_code_node_accept ((BalaCodeNode*) _tmp7_, (BalaCodeVisitor*) self);
	}
	bala_gir_writer_write_indent (self);
	_tmp8_ = self->priv->buffer;
	_tmp9_ = bala_get_ccode_name ((BalaCodeNode*) sig);
	_tmp10_ = _tmp9_;
	g_string_append_printf (_tmp8_, "<glib:signal name=\"%s\"", _tmp10_);
	_g_free0 (_tmp10_);
	bala_gir_writer_write_symbol_attributes (self, (BalaSymbol*) sig);
	_tmp11_ = self->priv->buffer;
	g_string_append_printf (_tmp11_, ">\n");
	_tmp12_ = self->priv->indent;
	self->priv->indent = _tmp12_ + 1;
	_tmp13_ = bala_gir_writer_get_signal_comment (self, sig);
	_tmp14_ = _tmp13_;
	bala_gir_writer_write_doc (self, _tmp14_);
	_g_free0 (_tmp14_);
	_tmp15_ = bala_callable_get_parameters ((BalaCallable*) sig);
	_tmp16_ = bala_callable_get_return_type ((BalaCallable*) sig);
	_tmp17_ = _tmp16_;
	_tmp18_ = bala_gir_writer_get_signal_return_comment (self, sig);
	_tmp19_ = _tmp18_;
	bala_gir_writer_write_params_and_return (self, "glib:signal", _tmp15_, NULL, _tmp17_, FALSE, _tmp19_, FALSE, NULL, FALSE);
	_g_free0 (_tmp19_);
	_tmp20_ = self->priv->indent;
	self->priv->indent = _tmp20_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp21_ = self->priv->buffer;
	g_string_append_printf (_tmp21_, "</glib:signal>\n");
}

static void
bala_gir_writer_write_indent (BalaGIRWriter* self)
{
	gint i = 0;
	g_return_if_fail (self != NULL);
	{
		gboolean _tmp0_ = FALSE;
		i = 0;
		_tmp0_ = TRUE;
		while (TRUE) {
			GString* _tmp2_;
			if (!_tmp0_) {
				gint _tmp1_;
				_tmp1_ = i;
				i = _tmp1_ + 1;
			}
			_tmp0_ = FALSE;
			if (!(i < self->priv->indent)) {
				break;
			}
			_tmp2_ = self->priv->buffer;
			g_string_append_c (_tmp2_, '\t');
		}
	}
}

static void
bala_gir_writer_write_indent_stream (BalaGIRWriter* self)
{
	gint i = 0;
	g_return_if_fail (self != NULL);
	{
		gboolean _tmp0_ = FALSE;
		i = 0;
		_tmp0_ = TRUE;
		while (TRUE) {
			FILE* _tmp2_;
			if (!_tmp0_) {
				gint _tmp1_;
				_tmp1_ = i;
				i = _tmp1_ + 1;
			}
			_tmp0_ = FALSE;
			if (!(i < self->priv->indent)) {
				break;
			}
			_tmp2_ = self->priv->stream;
			fputc ('\t', _tmp2_);
		}
	}
}

static void
bala_gir_writer_write_param_or_return (BalaGIRWriter* self,
                                       BalaDataType* type,
                                       const gchar* tag,
                                       gint* index,
                                       gboolean has_array_length,
                                       const gchar* name,
                                       const gchar* comment,
                                       BalaParameterDirection direction,
                                       gboolean constructor,
                                       gboolean caller_allocates,
                                       gboolean ellipsis)
{
	GString* _tmp0_;
	BalaDelegateType* delegate_type = NULL;
	BalaArrayType* array_type = NULL;
	gboolean _tmp4_ = FALSE;
	gboolean _tmp39_ = FALSE;
	gboolean _tmp43_ = FALSE;
	BalaDelegateType* _tmp44_;
	GString* _tmp65_;
	gint _tmp66_;
	gint _tmp69_;
	GString* _tmp70_;
	gint _tmp71_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (tag != NULL);
	bala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<%s", tag);
	if (ellipsis) {
		name = "...";
	}
	if (name != NULL) {
		GString* _tmp1_;
		_tmp1_ = self->priv->buffer;
		g_string_append_printf (_tmp1_, " name=\"%s\"", name);
	}
	if (direction == BALA_PARAMETER_DIRECTION_REF) {
		GString* _tmp2_;
		_tmp2_ = self->priv->buffer;
		g_string_append_printf (_tmp2_, " direction=\"inout\"");
	} else {
		if (direction == BALA_PARAMETER_DIRECTION_OUT) {
			GString* _tmp3_;
			_tmp3_ = self->priv->buffer;
			g_string_append_printf (_tmp3_, " direction=\"out\"");
		}
	}
	delegate_type = G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_DELEGATE_TYPE) ? ((BalaDelegateType*) type) : NULL;
	array_type = G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_ARRAY_TYPE) ? ((BalaArrayType*) type) : NULL;
	if (type != NULL) {
		gboolean _tmp5_ = FALSE;
		gboolean _tmp6_ = FALSE;
		gboolean _tmp7_;
		gboolean _tmp8_;
		_tmp7_ = bala_data_type_get_value_owned (type);
		_tmp8_ = _tmp7_;
		if (_tmp8_) {
			BalaDelegateType* _tmp9_;
			_tmp9_ = delegate_type;
			_tmp6_ = _tmp9_ == NULL;
		} else {
			_tmp6_ = FALSE;
		}
		if (_tmp6_) {
			_tmp5_ = TRUE;
		} else {
			gboolean _tmp10_ = FALSE;
			if (constructor) {
				BalaTypeSymbol* _tmp11_;
				BalaTypeSymbol* _tmp12_;
				BalaTypeSymbol* _tmp13_;
				_tmp11_ = bala_data_type_get_type_symbol (type);
				_tmp12_ = _tmp11_;
				_tmp13_ = self->priv->ginitiallyunowned_type;
				_tmp10_ = !bala_typesymbol_is_subtype_of (_tmp12_, _tmp13_);
			} else {
				_tmp10_ = FALSE;
			}
			_tmp5_ = _tmp10_;
		}
		_tmp4_ = _tmp5_;
	} else {
		_tmp4_ = FALSE;
	}
	if (_tmp4_) {
		gboolean any_owned = FALSE;
		gboolean _tmp26_ = FALSE;
		any_owned = FALSE;
		{
			BalaList* _generic_arg_list = NULL;
			BalaList* _tmp14_;
			BalaList* _tmp15_;
			gint _generic_arg_size = 0;
			BalaList* _tmp16_;
			gint _tmp17_;
			gint _tmp18_;
			gint _generic_arg_index = 0;
			_tmp14_ = bala_data_type_get_type_arguments (type);
			_tmp15_ = _bala_iterable_ref0 (_tmp14_);
			_generic_arg_list = _tmp15_;
			_tmp16_ = _generic_arg_list;
			_tmp17_ = bala_collection_get_size ((BalaCollection*) _tmp16_);
			_tmp18_ = _tmp17_;
			_generic_arg_size = _tmp18_;
			_generic_arg_index = -1;
			while (TRUE) {
				gint _tmp19_;
				gint _tmp20_;
				BalaDataType* generic_arg = NULL;
				BalaList* _tmp21_;
				gpointer _tmp22_;
				BalaDataType* _tmp23_;
				gboolean _tmp24_;
				gboolean _tmp25_;
				_generic_arg_index = _generic_arg_index + 1;
				_tmp19_ = _generic_arg_index;
				_tmp20_ = _generic_arg_size;
				if (!(_tmp19_ < _tmp20_)) {
					break;
				}
				_tmp21_ = _generic_arg_list;
				_tmp22_ = bala_list_get (_tmp21_, _generic_arg_index);
				generic_arg = (BalaDataType*) _tmp22_;
				_tmp23_ = generic_arg;
				_tmp24_ = bala_data_type_get_value_owned (_tmp23_);
				_tmp25_ = _tmp24_;
				any_owned |= _tmp25_;
				_bala_code_node_unref0 (generic_arg);
			}
			_bala_iterable_unref0 (_generic_arg_list);
		}
		if (bala_data_type_has_type_arguments (type)) {
			_tmp26_ = !any_owned;
		} else {
			_tmp26_ = FALSE;
		}
		if (_tmp26_) {
			GString* _tmp27_;
			_tmp27_ = self->priv->buffer;
			g_string_append_printf (_tmp27_, " transfer-ownership=\"container\"");
		} else {
			gboolean _tmp28_ = FALSE;
			BalaArrayType* _tmp29_;
			_tmp29_ = array_type;
			if (_tmp29_ != NULL) {
				BalaArrayType* _tmp30_;
				BalaDataType* _tmp31_;
				BalaDataType* _tmp32_;
				gboolean _tmp33_;
				gboolean _tmp34_;
				_tmp30_ = array_type;
				_tmp31_ = bala_array_type_get_element_type (_tmp30_);
				_tmp32_ = _tmp31_;
				_tmp33_ = bala_data_type_get_value_owned (_tmp32_);
				_tmp34_ = _tmp33_;
				_tmp28_ = !_tmp34_;
			} else {
				_tmp28_ = FALSE;
			}
			if (_tmp28_) {
				GString* _tmp35_;
				_tmp35_ = self->priv->buffer;
				g_string_append_printf (_tmp35_, " transfer-ownership=\"container\"");
			} else {
				GString* _tmp36_;
				_tmp36_ = self->priv->buffer;
				g_string_append_printf (_tmp36_, " transfer-ownership=\"full\"");
			}
		}
	} else {
		GString* _tmp37_;
		_tmp37_ = self->priv->buffer;
		g_string_append_printf (_tmp37_, " transfer-ownership=\"none\"");
	}
	if (caller_allocates) {
		GString* _tmp38_;
		_tmp38_ = self->priv->buffer;
		g_string_append_printf (_tmp38_, " caller-allocates=\"1\"");
	}
	if (type != NULL) {
		gboolean _tmp40_;
		gboolean _tmp41_;
		_tmp40_ = bala_data_type_get_nullable (type);
		_tmp41_ = _tmp40_;
		_tmp39_ = _tmp41_;
	} else {
		_tmp39_ = FALSE;
	}
	if (_tmp39_) {
		GString* _tmp42_;
		_tmp42_ = self->priv->buffer;
		g_string_append_printf (_tmp42_, " allow-none=\"1\"");
	}
	_tmp44_ = delegate_type;
	if (_tmp44_ != NULL) {
		BalaDelegateType* _tmp45_;
		BalaDelegate* _tmp46_;
		BalaDelegate* _tmp47_;
		gboolean _tmp48_;
		gboolean _tmp49_;
		_tmp45_ = delegate_type;
		_tmp46_ = bala_delegate_type_get_delegate_symbol (_tmp45_);
		_tmp47_ = _tmp46_;
		_tmp48_ = bala_delegate_get_has_target (_tmp47_);
		_tmp49_ = _tmp48_;
		_tmp43_ = _tmp49_;
	} else {
		_tmp43_ = FALSE;
	}
	if (_tmp43_) {
		gint _tmp50_ = 0;
		gint closure_index = 0;
		GString* _tmp54_;
		BalaDelegateType* _tmp55_;
		gboolean _tmp56_;
		gboolean _tmp57_;
		if (g_strcmp0 (tag, "parameter") == 0) {
			_tmp50_ = (*index) + 1;
		} else {
			gint _tmp51_ = 0;
			gboolean _tmp52_;
			gboolean _tmp53_;
			_tmp52_ = bala_data_type_get_value_owned (type);
			_tmp53_ = _tmp52_;
			if (_tmp53_) {
				_tmp51_ = (*index) - 1;
			} else {
				_tmp51_ = *index;
			}
			_tmp50_ = _tmp51_;
		}
		closure_index = _tmp50_;
		_tmp54_ = self->priv->buffer;
		g_string_append_printf (_tmp54_, " closure=\"%i\"", closure_index);
		_tmp55_ = delegate_type;
		_tmp56_ = bala_delegate_type_get_is_called_once (_tmp55_);
		_tmp57_ = _tmp56_;
		if (_tmp57_) {
			GString* _tmp58_;
			_tmp58_ = self->priv->buffer;
			g_string_append (_tmp58_, " scope=\"async\"");
		} else {
			gboolean _tmp59_;
			gboolean _tmp60_;
			_tmp59_ = bala_data_type_get_value_owned (type);
			_tmp60_ = _tmp59_;
			if (_tmp60_) {
				GString* _tmp61_;
				_tmp61_ = self->priv->buffer;
				g_string_append_printf (_tmp61_, " scope=\"notified\" destroy=\"%i\"", closure_index + 1);
			} else {
				GString* _tmp62_;
				_tmp62_ = self->priv->buffer;
				g_string_append (_tmp62_, " scope=\"call\"");
			}
		}
	} else {
		BalaDelegateType* _tmp63_;
		_tmp63_ = delegate_type;
		if (_tmp63_ != NULL) {
			GString* _tmp64_;
			_tmp64_ = self->priv->buffer;
			g_string_append (_tmp64_, " scope=\"call\"");
		}
	}
	_tmp65_ = self->priv->buffer;
	g_string_append_printf (_tmp65_, ">\n");
	_tmp66_ = self->priv->indent;
	self->priv->indent = _tmp66_ + 1;
	bala_gir_writer_write_doc (self, comment);
	if (ellipsis) {
		GString* _tmp67_;
		bala_gir_writer_write_indent (self);
		_tmp67_ = self->priv->buffer;
		g_string_append (_tmp67_, "<varargs/>\n");
	} else {
		if (type != NULL) {
			gint length_param_index = 0;
			length_param_index = -1;
			if (has_array_length) {
				gint _tmp68_ = 0;
				if (g_strcmp0 (tag, "parameter") == 0) {
					_tmp68_ = (*index) + 1;
				} else {
					_tmp68_ = *index;
				}
				length_param_index = _tmp68_;
			}
			bala_gir_writer_write_type (self, type, length_param_index, direction);
		}
	}
	_tmp69_ = self->priv->indent;
	self->priv->indent = _tmp69_ - 1;
	bala_gir_writer_write_indent (self);
	_tmp70_ = self->priv->buffer;
	g_string_append_printf (_tmp70_, "</%s>\n", tag);
	_tmp71_ = *index;
	*index = _tmp71_ + 1;
}

static void
bala_gir_writer_write_ctype_attributes (BalaGIRWriter* self,
                                        BalaTypeSymbol* symbol,
                                        const gchar* suffix,
                                        gboolean symbol_prefix)
{
	GString* _tmp0_;
	gchar* _tmp1_;
	gchar* _tmp2_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (symbol != NULL);
	g_return_if_fail (suffix != NULL);
	_tmp0_ = self->priv->buffer;
	_tmp1_ = bala_get_ccode_name ((BalaCodeNode*) symbol);
	_tmp2_ = _tmp1_;
	g_string_append_printf (_tmp0_, " c:type=\"%s%s\"", _tmp2_, suffix);
	_g_free0 (_tmp2_);
	if (symbol_prefix) {
		GString* _tmp3_;
		gchar* _tmp4_;
		gchar* _tmp5_;
		_tmp3_ = self->priv->buffer;
		_tmp4_ = bala_get_ccode_lower_case_suffix ((BalaSymbol*) symbol);
		_tmp5_ = _tmp4_;
		g_string_append_printf (_tmp3_, " c:symbol-prefix=\"%s\"", _tmp5_);
		_g_free0 (_tmp5_);
	}
}

static void
bala_gir_writer_write_gtype_attributes (BalaGIRWriter* self,
                                        BalaTypeSymbol* symbol,
                                        gboolean symbol_prefix)
{
	GString* _tmp0_;
	gchar* _tmp1_;
	gchar* _tmp2_;
	GString* _tmp3_;
	gchar* _tmp4_;
	gchar* _tmp5_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (symbol != NULL);
	bala_gir_writer_write_ctype_attributes (self, symbol, "", symbol_prefix);
	_tmp0_ = self->priv->buffer;
	_tmp1_ = bala_get_ccode_name ((BalaCodeNode*) symbol);
	_tmp2_ = _tmp1_;
	g_string_append_printf (_tmp0_, " glib:type-name=\"%s\"", _tmp2_);
	_g_free0 (_tmp2_);
	_tmp3_ = self->priv->buffer;
	_tmp4_ = bala_get_ccode_lower_case_prefix ((BalaSymbol*) symbol);
	_tmp5_ = _tmp4_;
	g_string_append_printf (_tmp3_, " glib:get-type=\"%sget_type\"", _tmp5_);
	_g_free0 (_tmp5_);
}

static void
bala_gir_writer_write_type (BalaGIRWriter* self,
                            BalaDataType* type,
                            gint index,
                            BalaParameterDirection direction)
{
	g_return_if_fail (self != NULL);
	g_return_if_fail (type != NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_ARRAY_TYPE)) {
		BalaArrayType* array_type = NULL;
		BalaArrayType* _tmp0_;
		GString* _tmp1_;
		gboolean _tmp2_ = FALSE;
		BalaArrayType* _tmp3_;
		gboolean _tmp4_;
		gboolean _tmp5_;
		const gchar* _tmp18_ = NULL;
		GString* _tmp19_;
		BalaArrayType* _tmp20_;
		BalaDataType* _tmp21_;
		BalaDataType* _tmp22_;
		gchar* _tmp23_;
		gchar* _tmp24_;
		GString* _tmp25_;
		gint _tmp26_;
		BalaArrayType* _tmp27_;
		BalaDataType* _tmp28_;
		BalaDataType* _tmp29_;
		gint _tmp30_;
		GString* _tmp31_;
		_tmp0_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_ARRAY_TYPE, BalaArrayType));
		array_type = _tmp0_;
		bala_gir_writer_write_indent (self);
		_tmp1_ = self->priv->buffer;
		g_string_append_printf (_tmp1_, "<array");
		_tmp3_ = array_type;
		_tmp4_ = bala_array_type_get_fixed_length (_tmp3_);
		_tmp5_ = _tmp4_;
		if (_tmp5_) {
			BalaArrayType* _tmp6_;
			BalaExpression* _tmp7_;
			BalaExpression* _tmp8_;
			_tmp6_ = array_type;
			_tmp7_ = bala_array_type_get_length (_tmp6_);
			_tmp8_ = _tmp7_;
			_tmp2_ = G_TYPE_CHECK_INSTANCE_TYPE (_tmp8_, BALA_TYPE_INTEGER_LITERAL);
		} else {
			_tmp2_ = FALSE;
		}
		if (_tmp2_) {
			BalaIntegerLiteral* lit = NULL;
			BalaArrayType* _tmp9_;
			BalaExpression* _tmp10_;
			BalaExpression* _tmp11_;
			BalaIntegerLiteral* _tmp12_;
			GString* _tmp13_;
			BalaIntegerLiteral* _tmp14_;
			const gchar* _tmp15_;
			const gchar* _tmp16_;
			_tmp9_ = array_type;
			_tmp10_ = bala_array_type_get_length (_tmp9_);
			_tmp11_ = _tmp10_;
			_tmp12_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp11_, BALA_TYPE_INTEGER_LITERAL, BalaIntegerLiteral));
			lit = _tmp12_;
			_tmp13_ = self->priv->buffer;
			_tmp14_ = lit;
			_tmp15_ = bala_integer_literal_get_value (_tmp14_);
			_tmp16_ = _tmp15_;
			g_string_append_printf (_tmp13_, " fixed-size=\"%i\"", atoi (_tmp16_));
			_bala_code_node_unref0 (lit);
		} else {
			if (index != -1) {
				GString* _tmp17_;
				_tmp17_ = self->priv->buffer;
				g_string_append_printf (_tmp17_, " length=\"%i\"", index);
			}
		}
		if (direction == BALA_PARAMETER_DIRECTION_IN) {
			_tmp18_ = "*";
		} else {
			_tmp18_ = "**";
		}
		_tmp19_ = self->priv->buffer;
		_tmp20_ = array_type;
		_tmp21_ = bala_array_type_get_element_type (_tmp20_);
		_tmp22_ = _tmp21_;
		_tmp23_ = bala_get_ccode_name ((BalaCodeNode*) _tmp22_);
		_tmp24_ = _tmp23_;
		g_string_append_printf (_tmp19_, " c:type=\"%s%s\"", _tmp24_, _tmp18_);
		_g_free0 (_tmp24_);
		_tmp25_ = self->priv->buffer;
		g_string_append_printf (_tmp25_, ">\n");
		_tmp26_ = self->priv->indent;
		self->priv->indent = _tmp26_ + 1;
		_tmp27_ = array_type;
		_tmp28_ = bala_array_type_get_element_type (_tmp27_);
		_tmp29_ = _tmp28_;
		bala_gir_writer_write_type (self, _tmp29_, -1, BALA_PARAMETER_DIRECTION_IN);
		_tmp30_ = self->priv->indent;
		self->priv->indent = _tmp30_ - 1;
		bala_gir_writer_write_indent (self);
		_tmp31_ = self->priv->buffer;
		g_string_append_printf (_tmp31_, "</array>\n");
		_bala_code_node_unref0 (array_type);
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_VOID_TYPE)) {
			GString* _tmp32_;
			bala_gir_writer_write_indent (self);
			_tmp32_ = self->priv->buffer;
			g_string_append_printf (_tmp32_, "<type name=\"none\" c:type=\"void\"/>\n");
		} else {
			if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_POINTER_TYPE)) {
				const gchar* _tmp33_ = NULL;
				GString* _tmp34_;
				gchar* _tmp35_;
				gchar* _tmp36_;
				bala_gir_writer_write_indent (self);
				if (direction == BALA_PARAMETER_DIRECTION_IN) {
					_tmp33_ = "";
				} else {
					_tmp33_ = "*";
				}
				_tmp34_ = self->priv->buffer;
				_tmp35_ = bala_get_ccode_name ((BalaCodeNode*) type);
				_tmp36_ = _tmp35_;
				g_string_append_printf (_tmp34_, "<type name=\"gpointer\" c:type=\"%s%s\"/>\n", _tmp36_, _tmp33_);
				_g_free0 (_tmp36_);
			} else {
				if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_DELEGATE_TYPE)) {
					BalaDelegateType* deleg_type = NULL;
					BalaDelegateType* _tmp37_;
					const gchar* _tmp38_ = NULL;
					GString* _tmp39_;
					BalaDelegateType* _tmp40_;
					BalaDelegate* _tmp41_;
					BalaDelegate* _tmp42_;
					gchar* _tmp43_;
					gchar* _tmp44_;
					gchar* _tmp45_;
					gchar* _tmp46_;
					_tmp37_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, BALA_TYPE_DELEGATE_TYPE, BalaDelegateType));
					deleg_type = _tmp37_;
					bala_gir_writer_write_indent (self);
					if (direction == BALA_PARAMETER_DIRECTION_IN) {
						_tmp38_ = "";
					} else {
						_tmp38_ = "*";
					}
					_tmp39_ = self->priv->buffer;
					_tmp40_ = deleg_type;
					_tmp41_ = bala_delegate_type_get_delegate_symbol (_tmp40_);
					_tmp42_ = _tmp41_;
					_tmp43_ = bala_gir_writer_gi_type_name (self, (BalaTypeSymbol*) _tmp42_);
					_tmp44_ = _tmp43_;
					_tmp45_ = bala_get_ccode_name ((BalaCodeNode*) type);
					_tmp46_ = _tmp45_;
					g_string_append_printf (_tmp39_, "<type name=\"%s\" c:type=\"%s%s\"/>\n", _tmp44_, _tmp46_, _tmp38_);
					_g_free0 (_tmp46_);
					_g_free0 (_tmp44_);
					_bala_code_node_unref0 (deleg_type);
				} else {
					BalaTypeSymbol* _tmp47_;
					BalaTypeSymbol* _tmp48_;
					_tmp47_ = bala_data_type_get_type_symbol (type);
					_tmp48_ = _tmp47_;
					if (_tmp48_ != NULL) {
						gchar* type_name = NULL;
						BalaTypeSymbol* _tmp49_;
						BalaTypeSymbol* _tmp50_;
						gchar* _tmp51_;
						gboolean is_array = FALSE;
						gboolean _tmp52_ = FALSE;
						const gchar* _tmp53_;
						const gchar* _tmp55_ = NULL;
						const gchar* _tmp56_ = NULL;
						GString* _tmp57_;
						BalaTypeSymbol* _tmp58_;
						BalaTypeSymbol* _tmp59_;
						gchar* _tmp60_;
						gchar* _tmp61_;
						gchar* _tmp62_;
						gchar* _tmp63_;
						BalaList* type_arguments = NULL;
						BalaList* _tmp64_;
						BalaList* _tmp65_;
						BalaList* _tmp66_;
						gint _tmp67_;
						gint _tmp68_;
						bala_gir_writer_write_indent (self);
						_tmp49_ = bala_data_type_get_type_symbol (type);
						_tmp50_ = _tmp49_;
						_tmp51_ = bala_gir_writer_gi_type_name (self, _tmp50_);
						type_name = _tmp51_;
						is_array = FALSE;
						_tmp53_ = type_name;
						if (g_strcmp0 (_tmp53_, "GLib.Array") == 0) {
							_tmp52_ = TRUE;
						} else {
							const gchar* _tmp54_;
							_tmp54_ = type_name;
							_tmp52_ = g_strcmp0 (_tmp54_, "GLib.PtrArray") == 0;
						}
						if (_tmp52_) {
							is_array = TRUE;
						}
						if (is_array) {
							_tmp55_ = "array";
						} else {
							_tmp55_ = "type";
						}
						if (direction == BALA_PARAMETER_DIRECTION_IN) {
							_tmp56_ = "";
						} else {
							_tmp56_ = "*";
						}
						_tmp57_ = self->priv->buffer;
						_tmp58_ = bala_data_type_get_type_symbol (type);
						_tmp59_ = _tmp58_;
						_tmp60_ = bala_gir_writer_gi_type_name (self, _tmp59_);
						_tmp61_ = _tmp60_;
						_tmp62_ = bala_get_ccode_name ((BalaCodeNode*) type);
						_tmp63_ = _tmp62_;
						g_string_append_printf (_tmp57_, "<%s name=\"%s\" c:type=\"%s%s\"", _tmp55_, _tmp61_, _tmp63_, _tmp56_);
						_g_free0 (_tmp63_);
						_g_free0 (_tmp61_);
						_tmp64_ = bala_data_type_get_type_arguments (type);
						_tmp65_ = _bala_iterable_ref0 (_tmp64_);
						type_arguments = _tmp65_;
						_tmp66_ = type_arguments;
						_tmp67_ = bala_collection_get_size ((BalaCollection*) _tmp66_);
						_tmp68_ = _tmp67_;
						if (_tmp68_ == 0) {
							GString* _tmp69_;
							_tmp69_ = self->priv->buffer;
							g_string_append_printf (_tmp69_, "/>\n");
						} else {
							GString* _tmp70_;
							gint _tmp71_;
							gint _tmp82_;
							const gchar* _tmp83_ = NULL;
							GString* _tmp84_;
							_tmp70_ = self->priv->buffer;
							g_string_append_printf (_tmp70_, ">\n");
							_tmp71_ = self->priv->indent;
							self->priv->indent = _tmp71_ + 1;
							{
								BalaList* _type_argument_list = NULL;
								BalaList* _tmp72_;
								BalaList* _tmp73_;
								gint _type_argument_size = 0;
								BalaList* _tmp74_;
								gint _tmp75_;
								gint _tmp76_;
								gint _type_argument_index = 0;
								_tmp72_ = type_arguments;
								_tmp73_ = _bala_iterable_ref0 (_tmp72_);
								_type_argument_list = _tmp73_;
								_tmp74_ = _type_argument_list;
								_tmp75_ = bala_collection_get_size ((BalaCollection*) _tmp74_);
								_tmp76_ = _tmp75_;
								_type_argument_size = _tmp76_;
								_type_argument_index = -1;
								while (TRUE) {
									gint _tmp77_;
									gint _tmp78_;
									BalaDataType* type_argument = NULL;
									BalaList* _tmp79_;
									gpointer _tmp80_;
									BalaDataType* _tmp81_;
									_type_argument_index = _type_argument_index + 1;
									_tmp77_ = _type_argument_index;
									_tmp78_ = _type_argument_size;
									if (!(_tmp77_ < _tmp78_)) {
										break;
									}
									_tmp79_ = _type_argument_list;
									_tmp80_ = bala_list_get (_tmp79_, _type_argument_index);
									type_argument = (BalaDataType*) _tmp80_;
									_tmp81_ = type_argument;
									bala_gir_writer_write_type (self, _tmp81_, -1, BALA_PARAMETER_DIRECTION_IN);
									_bala_code_node_unref0 (type_argument);
								}
								_bala_iterable_unref0 (_type_argument_list);
							}
							_tmp82_ = self->priv->indent;
							self->priv->indent = _tmp82_ - 1;
							bala_gir_writer_write_indent (self);
							if (is_array) {
								_tmp83_ = "array";
							} else {
								_tmp83_ = "type";
							}
							_tmp84_ = self->priv->buffer;
							g_string_append_printf (_tmp84_, "</%s>\n", _tmp83_);
						}
						_bala_iterable_unref0 (type_arguments);
						_g_free0 (type_name);
					} else {
						if (G_TYPE_CHECK_INSTANCE_TYPE (type, BALA_TYPE_GENERIC_TYPE)) {
							GString* _tmp85_;
							bala_gir_writer_write_indent (self);
							_tmp85_ = self->priv->buffer;
							g_string_append (_tmp85_, "<type name=\"gpointer\" c:type=\"gpointer\"/>\n");
						} else {
							GString* _tmp86_;
							gchar* _tmp87_;
							gchar* _tmp88_;
							bala_gir_writer_write_indent (self);
							_tmp86_ = self->priv->buffer;
							_tmp87_ = bala_code_node_to_string ((BalaCodeNode*) type);
							_tmp88_ = _tmp87_;
							g_string_append_printf (_tmp86_, "<type name=\"%s\"/>\n", _tmp88_);
							_g_free0 (_tmp88_);
						}
					}
				}
			}
		}
	}
}

static gboolean
string_contains (const gchar* self,
                 const gchar* needle)
{
	gchar* _tmp0_;
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (needle != NULL, FALSE);
	_tmp0_ = strstr ((gchar*) self, (gchar*) needle);
	result = _tmp0_ != NULL;
	return result;
}

static gchar*
bala_gir_writer_get_full_gir_name (BalaGIRWriter* self,
                                   BalaSymbol* sym)
{
	gchar* gir_fullname = NULL;
	gchar* _tmp0_;
	const gchar* _tmp1_;
	gchar* gir_name = NULL;
	gchar* _tmp2_;
	gboolean _tmp3_ = FALSE;
	const gchar* _tmp4_;
	const gchar* _tmp6_;
	BalaSymbol* _tmp10_;
	BalaSymbol* _tmp11_;
	const gchar* _tmp12_;
	const gchar* _tmp13_;
	gchar* parent_gir_name = NULL;
	BalaSymbol* _tmp17_;
	BalaSymbol* _tmp18_;
	gchar* _tmp19_;
	const gchar* _tmp20_;
	gchar* _tmp21_ = NULL;
	const gchar* _tmp22_;
	gchar* self_gir_name = NULL;
	gchar* _tmp27_;
	const gchar* _tmp28_;
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (sym != NULL, NULL);
	_tmp0_ = bala_code_node_get_attribute_string ((BalaCodeNode*) sym, "GIR", "fullname", NULL);
	gir_fullname = _tmp0_;
	_tmp1_ = gir_fullname;
	if (_tmp1_ != NULL) {
		result = gir_fullname;
		return result;
	}
	_tmp2_ = bala_code_node_get_attribute_string ((BalaCodeNode*) sym, "GIR", "name", NULL);
	gir_name = _tmp2_;
	_tmp4_ = gir_name;
	if (_tmp4_ == NULL) {
		_tmp3_ = G_TYPE_CHECK_INSTANCE_TYPE (sym, BALA_TYPE_NAMESPACE);
	} else {
		_tmp3_ = FALSE;
	}
	if (_tmp3_) {
		gchar* _tmp5_;
		_tmp5_ = bala_code_node_get_attribute_string ((BalaCodeNode*) sym, "CCode", "gir_namespace", NULL);
		_g_free0 (gir_name);
		gir_name = _tmp5_;
	}
	_tmp6_ = gir_name;
	if (_tmp6_ == NULL) {
		const gchar* _tmp7_;
		const gchar* _tmp8_;
		gchar* _tmp9_;
		_tmp7_ = bala_symbol_get_name (sym);
		_tmp8_ = _tmp7_;
		_tmp9_ = g_strdup (_tmp8_);
		_g_free0 (gir_name);
		gir_name = _tmp9_;
	}
	_tmp10_ = bala_symbol_get_parent_symbol (sym);
	_tmp11_ = _tmp10_;
	if (_tmp11_ == NULL) {
		result = gir_name;
		_g_free0 (gir_fullname);
		return result;
	}
	_tmp12_ = bala_symbol_get_name (sym);
	_tmp13_ = _tmp12_;
	if (_tmp13_ == NULL) {
		BalaSymbol* _tmp14_;
		BalaSymbol* _tmp15_;
		gchar* _tmp16_;
		_tmp14_ = bala_symbol_get_parent_symbol (sym);
		_tmp15_ = _tmp14_;
		_tmp16_ = bala_gir_writer_get_full_gir_name (self, _tmp15_);
		result = _tmp16_;
		_g_free0 (gir_name);
		_g_free0 (gir_fullname);
		return result;
	}
	_tmp17_ = bala_symbol_get_parent_symbol (sym);
	_tmp18_ = _tmp17_;
	_tmp19_ = bala_gir_writer_get_full_gir_name (self, _tmp18_);
	parent_gir_name = _tmp19_;
	_tmp20_ = parent_gir_name;
	if (_tmp20_ == NULL) {
		result = gir_name;
		_g_free0 (parent_gir_name);
		_g_free0 (gir_fullname);
		return result;
	}
	_tmp22_ = gir_name;
	if (g_str_has_prefix (_tmp22_, ".")) {
		const gchar* _tmp23_;
		gchar* _tmp24_;
		_tmp23_ = gir_name;
		_tmp24_ = string_substring (_tmp23_, (glong) 1, (glong) -1);
		_g_free0 (_tmp21_);
		_tmp21_ = _tmp24_;
	} else {
		const gchar* _tmp25_;
		gchar* _tmp26_;
		_tmp25_ = gir_name;
		_tmp26_ = g_strdup (_tmp25_);
		_g_free0 (_tmp21_);
		_tmp21_ = _tmp26_;
	}
	_tmp27_ = g_strdup (_tmp21_);
	self_gir_name = _tmp27_;
	_tmp28_ = parent_gir_name;
	if (string_contains (_tmp28_, ".")) {
		const gchar* _tmp29_;
		const gchar* _tmp30_;
		gchar* _tmp31_;
		_tmp29_ = parent_gir_name;
		_tmp30_ = self_gir_name;
		_tmp31_ = g_strdup_printf ("%s%s", _tmp29_, _tmp30_);
		result = _tmp31_;
		_g_free0 (self_gir_name);
		_g_free0 (_tmp21_);
		_g_free0 (parent_gir_name);
		_g_free0 (gir_name);
		_g_free0 (gir_fullname);
		return result;
	} else {
		const gchar* _tmp32_;
		const gchar* _tmp33_;
		gchar* _tmp34_;
		_tmp32_ = parent_gir_name;
		_tmp33_ = self_gir_name;
		_tmp34_ = g_strdup_printf ("%s.%s", _tmp32_, _tmp33_);
		result = _tmp34_;
		_g_free0 (self_gir_name);
		_g_free0 (_tmp21_);
		_g_free0 (parent_gir_name);
		_g_free0 (gir_name);
		_g_free0 (gir_fullname);
		return result;
	}
	_g_free0 (self_gir_name);
	_g_free0 (_tmp21_);
	_g_free0 (parent_gir_name);
	_g_free0 (gir_name);
	_g_free0 (gir_fullname);
}

static gchar*
bala_gir_writer_gi_type_name (BalaGIRWriter* self,
                              BalaTypeSymbol* type_symbol)
{
	BalaSymbol* parent = NULL;
	BalaSymbol* _tmp0_;
	BalaSymbol* _tmp1_;
	BalaSymbol* _tmp2_;
	BalaSymbol* _tmp3_;
	gchar* _tmp55_;
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (type_symbol != NULL, NULL);
	_tmp0_ = bala_symbol_get_parent_symbol ((BalaSymbol*) type_symbol);
	_tmp1_ = _tmp0_;
	_tmp2_ = _bala_code_node_ref0 (_tmp1_);
	parent = _tmp2_;
	_tmp3_ = parent;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp3_, BALA_TYPE_NAMESPACE)) {
		BalaNamespace* ns = NULL;
		BalaSymbol* _tmp4_;
		BalaNamespace* _tmp5_;
		gchar* _tmp6_ = NULL;
		BalaNamespace* _tmp7_;
		gchar* _tmp8_;
		gchar* ns_gir_name = NULL;
		gchar* _tmp13_;
		const gchar* _tmp14_;
		_tmp4_ = parent;
		_tmp5_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, BALA_TYPE_NAMESPACE) ? ((BalaNamespace*) _tmp4_) : NULL);
		ns = _tmp5_;
		_tmp7_ = ns;
		_tmp8_ = bala_code_node_get_attribute_string ((BalaCodeNode*) _tmp7_, "GIR", "name", NULL);
		_tmp6_ = _tmp8_;
		if (_tmp6_ == NULL) {
			BalaNamespace* _tmp9_;
			const gchar* _tmp10_;
			const gchar* _tmp11_;
			gchar* _tmp12_;
			_tmp9_ = ns;
			_tmp10_ = bala_symbol_get_name ((BalaSymbol*) _tmp9_);
			_tmp11_ = _tmp10_;
			_tmp12_ = g_strdup (_tmp11_);
			_g_free0 (_tmp6_);
			_tmp6_ = _tmp12_;
		}
		_tmp13_ = _tmp6_;
		_tmp6_ = NULL;
		ns_gir_name = _tmp13_;
		_tmp14_ = ns_gir_name;
		if (_tmp14_ != NULL) {
			BalaSourceReference* _tmp15_;
			BalaSourceReference* _tmp16_;
			BalaSourceFile* _tmp17_;
			BalaSourceFile* _tmp18_;
			const gchar* _tmp19_;
			const gchar* _tmp20_;
			_tmp15_ = bala_code_node_get_source_reference ((BalaCodeNode*) type_symbol);
			_tmp16_ = _tmp15_;
			_tmp17_ = bala_source_reference_get_file (_tmp16_);
			_tmp18_ = _tmp17_;
			_tmp19_ = bala_source_file_get_gir_namespace (_tmp18_);
			_tmp20_ = _tmp19_;
			if (_tmp20_ != NULL) {
				BalaGIRWriterGIRNamespace external = {0};
				BalaSourceReference* _tmp21_;
				BalaSourceReference* _tmp22_;
				BalaSourceFile* _tmp23_;
				BalaSourceFile* _tmp24_;
				const gchar* _tmp25_;
				const gchar* _tmp26_;
				BalaSourceReference* _tmp27_;
				BalaSourceReference* _tmp28_;
				BalaSourceFile* _tmp29_;
				BalaSourceFile* _tmp30_;
				const gchar* _tmp31_;
				const gchar* _tmp32_;
				BalaArrayList* _tmp33_;
				BalaGIRWriterGIRNamespace _tmp34_;
				gchar* gir_fullname = NULL;
				gchar* _tmp37_;
				const gchar* _tmp38_;
				gchar* _tmp39_ = NULL;
				gchar* _tmp40_;
				gchar* type_name = NULL;
				gchar* _tmp44_;
				BalaSourceReference* _tmp45_;
				BalaSourceReference* _tmp46_;
				BalaSourceFile* _tmp47_;
				BalaSourceFile* _tmp48_;
				const gchar* _tmp49_;
				const gchar* _tmp50_;
				const gchar* _tmp51_;
				gchar* _tmp52_;
				_tmp21_ = bala_code_node_get_source_reference ((BalaCodeNode*) type_symbol);
				_tmp22_ = _tmp21_;
				_tmp23_ = bala_source_reference_get_file (_tmp22_);
				_tmp24_ = _tmp23_;
				_tmp25_ = bala_source_file_get_gir_namespace (_tmp24_);
				_tmp26_ = _tmp25_;
				_tmp27_ = bala_code_node_get_source_reference ((BalaCodeNode*) type_symbol);
				_tmp28_ = _tmp27_;
				_tmp29_ = bala_source_reference_get_file (_tmp28_);
				_tmp30_ = _tmp29_;
				_tmp31_ = bala_source_file_get_gir_version (_tmp30_);
				_tmp32_ = _tmp31_;
				bala_gir_writer_gir_namespace_init (&external, _tmp26_, _tmp32_);
				_tmp33_ = self->priv->externals;
				_tmp34_ = external;
				if (!bala_collection_contains ((BalaCollection*) _tmp33_, &_tmp34_)) {
					BalaArrayList* _tmp35_;
					BalaGIRWriterGIRNamespace _tmp36_;
					_tmp35_ = self->priv->externals;
					_tmp36_ = external;
					bala_collection_add ((BalaCollection*) _tmp35_, &_tmp36_);
				}
				_tmp37_ = bala_code_node_get_attribute_string ((BalaCodeNode*) type_symbol, "GIR", "fullname", NULL);
				gir_fullname = _tmp37_;
				_tmp38_ = gir_fullname;
				if (_tmp38_ != NULL) {
					result = gir_fullname;
					bala_gir_writer_gir_namespace_destroy (&external);
					_g_free0 (ns_gir_name);
					_g_free0 (_tmp6_);
					_bala_code_node_unref0 (ns);
					_bala_code_node_unref0 (parent);
					return result;
				}
				_tmp40_ = bala_code_node_get_attribute_string ((BalaCodeNode*) type_symbol, "GIR", "name", NULL);
				_tmp39_ = _tmp40_;
				if (_tmp39_ == NULL) {
					const gchar* _tmp41_;
					const gchar* _tmp42_;
					gchar* _tmp43_;
					_tmp41_ = bala_symbol_get_name ((BalaSymbol*) type_symbol);
					_tmp42_ = _tmp41_;
					_tmp43_ = g_strdup (_tmp42_);
					_g_free0 (_tmp39_);
					_tmp39_ = _tmp43_;
				}
				_tmp44_ = _tmp39_;
				_tmp39_ = NULL;
				type_name = _tmp44_;
				_tmp45_ = bala_code_node_get_source_reference ((BalaCodeNode*) type_symbol);
				_tmp46_ = _tmp45_;
				_tmp47_ = bala_source_reference_get_file (_tmp46_);
				_tmp48_ = _tmp47_;
				_tmp49_ = bala_source_file_get_gir_namespace (_tmp48_);
				_tmp50_ = _tmp49_;
				_tmp51_ = type_name;
				_tmp52_ = g_strdup_printf ("%s.%s", _tmp50_, _tmp51_);
				result = _tmp52_;
				_g_free0 (type_name);
				_g_free0 (_tmp39_);
				_g_free0 (gir_fullname);
				bala_gir_writer_gir_namespace_destroy (&external);
				_g_free0 (ns_gir_name);
				_g_free0 (_tmp6_);
				_bala_code_node_unref0 (ns);
				_bala_code_node_unref0 (parent);
				return result;
			} else {
				BalaHashSet* _tmp53_;
				BalaNamespace* _tmp54_;
				_tmp53_ = self->priv->unannotated_namespaces;
				_tmp54_ = ns;
				bala_collection_add ((BalaCollection*) _tmp53_, _tmp54_);
			}
		}
		_g_free0 (ns_gir_name);
		_g_free0 (_tmp6_);
		_bala_code_node_unref0 (ns);
	}
	_tmp55_ = bala_gir_writer_get_full_gir_name (self, (BalaSymbol*) type_symbol);
	result = _tmp55_;
	_bala_code_node_unref0 (parent);
	return result;
}

static gchar*
bala_gir_writer_literal_expression_to_value_string (BalaGIRWriter* self,
                                                    BalaExpression* literal)
{
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (literal != NULL, NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_STRING_LITERAL)) {
		BalaStringLiteral* lit = NULL;
		BalaStringLiteral* _tmp0_;
		BalaStringLiteral* _tmp1_;
		_tmp0_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_STRING_LITERAL) ? ((BalaStringLiteral*) literal) : NULL);
		lit = _tmp0_;
		_tmp1_ = lit;
		if (_tmp1_ != NULL) {
			BalaStringLiteral* _tmp2_;
			gchar* _tmp3_;
			gchar* _tmp4_;
			gchar* _tmp5_;
			gchar* _tmp6_;
			_tmp2_ = lit;
			_tmp3_ = bala_string_literal_eval (_tmp2_);
			_tmp4_ = _tmp3_;
			_tmp5_ = g_markup_escape_text (_tmp4_, (gssize) -1);
			_tmp6_ = _tmp5_;
			_g_free0 (_tmp4_);
			result = _tmp6_;
			_bala_code_node_unref0 (lit);
			return result;
		}
		_bala_code_node_unref0 (lit);
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_CHARACTER_LITERAL)) {
			gchar* _tmp7_;
			_tmp7_ = g_strdup_printf ("%c", (gint) ((gchar) bala_character_literal_get_char (G_TYPE_CHECK_INSTANCE_CAST (literal, BALA_TYPE_CHARACTER_LITERAL, BalaCharacterLiteral))));
			result = _tmp7_;
			return result;
		} else {
			if (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_BOOLEAN_LITERAL)) {
				const gchar* _tmp8_ = NULL;
				gboolean _tmp9_;
				gboolean _tmp10_;
				gchar* _tmp11_;
				_tmp9_ = bala_boolean_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (literal, BALA_TYPE_BOOLEAN_LITERAL, BalaBooleanLiteral));
				_tmp10_ = _tmp9_;
				if (_tmp10_) {
					_tmp8_ = "true";
				} else {
					_tmp8_ = "false";
				}
				_tmp11_ = g_strdup (_tmp8_);
				result = _tmp11_;
				return result;
			} else {
				if (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_REAL_LITERAL)) {
					const gchar* _tmp12_;
					const gchar* _tmp13_;
					gchar* _tmp14_;
					_tmp12_ = bala_real_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (literal, BALA_TYPE_REAL_LITERAL, BalaRealLiteral));
					_tmp13_ = _tmp12_;
					_tmp14_ = g_strdup (_tmp13_);
					result = _tmp14_;
					return result;
				} else {
					if (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_INTEGER_LITERAL)) {
						const gchar* _tmp15_;
						const gchar* _tmp16_;
						gchar* _tmp17_;
						_tmp15_ = bala_integer_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (literal, BALA_TYPE_INTEGER_LITERAL, BalaIntegerLiteral));
						_tmp16_ = _tmp15_;
						_tmp17_ = g_strdup (_tmp16_);
						result = _tmp17_;
						return result;
					} else {
						if (G_TYPE_CHECK_INSTANCE_TYPE (literal, BALA_TYPE_UNARY_EXPRESSION)) {
							BalaUnaryExpression* unary = NULL;
							BalaUnaryExpression* _tmp18_;
							BalaUnaryExpression* _tmp19_;
							BalaUnaryOperator _tmp20_;
							BalaUnaryOperator _tmp21_;
							_tmp18_ = _bala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (literal, BALA_TYPE_UNARY_EXPRESSION, BalaUnaryExpression));
							unary = _tmp18_;
							_tmp19_ = unary;
							_tmp20_ = bala_unary_expression_get_operator (_tmp19_);
							_tmp21_ = _tmp20_;
							if (_tmp21_ == BALA_UNARY_OPERATOR_MINUS) {
								BalaUnaryExpression* _tmp22_;
								BalaExpression* _tmp23_;
								BalaExpression* _tmp24_;
								_tmp22_ = unary;
								_tmp23_ = bala_unary_expression_get_inner (_tmp22_);
								_tmp24_ = _tmp23_;
								if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp24_, BALA_TYPE_REAL_LITERAL)) {
									BalaUnaryExpression* _tmp25_;
									BalaExpression* _tmp26_;
									BalaExpression* _tmp27_;
									const gchar* _tmp28_;
									const gchar* _tmp29_;
									gchar* _tmp30_;
									_tmp25_ = unary;
									_tmp26_ = bala_unary_expression_get_inner (_tmp25_);
									_tmp27_ = _tmp26_;
									_tmp28_ = bala_real_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (_tmp27_, BALA_TYPE_REAL_LITERAL, BalaRealLiteral));
									_tmp29_ = _tmp28_;
									_tmp30_ = g_strconcat ("-", _tmp29_, NULL);
									result = _tmp30_;
									_bala_code_node_unref0 (unary);
									return result;
								} else {
									BalaUnaryExpression* _tmp31_;
									BalaExpression* _tmp32_;
									BalaExpression* _tmp33_;
									_tmp31_ = unary;
									_tmp32_ = bala_unary_expression_get_inner (_tmp31_);
									_tmp33_ = _tmp32_;
									if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp33_, BALA_TYPE_INTEGER_LITERAL)) {
										BalaUnaryExpression* _tmp34_;
										BalaExpression* _tmp35_;
										BalaExpression* _tmp36_;
										const gchar* _tmp37_;
										const gchar* _tmp38_;
										gchar* _tmp39_;
										_tmp34_ = unary;
										_tmp35_ = bala_unary_expression_get_inner (_tmp34_);
										_tmp36_ = _tmp35_;
										_tmp37_ = bala_integer_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (_tmp36_, BALA_TYPE_INTEGER_LITERAL, BalaIntegerLiteral));
										_tmp38_ = _tmp37_;
										_tmp39_ = g_strconcat ("-", _tmp38_, NULL);
										result = _tmp39_;
										_bala_code_node_unref0 (unary);
										return result;
									}
								}
							}
							_bala_code_node_unref0 (unary);
						}
					}
				}
			}
		}
	}
	result = NULL;
	return result;
}

static gboolean
bala_gir_writer_check_accessibility (BalaGIRWriter* self,
                                     BalaSymbol* sym)
{
	gboolean _tmp0_ = FALSE;
	BalaSymbolAccessibility _tmp1_;
	BalaSymbolAccessibility _tmp2_;
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	_tmp1_ = bala_symbol_get_access (sym);
	_tmp2_ = _tmp1_;
	if (_tmp2_ == BALA_SYMBOL_ACCESSIBILITY_PUBLIC) {
		_tmp0_ = TRUE;
	} else {
		BalaSymbolAccessibility _tmp3_;
		BalaSymbolAccessibility _tmp4_;
		_tmp3_ = bala_symbol_get_access (sym);
		_tmp4_ = _tmp3_;
		_tmp0_ = _tmp4_ == BALA_SYMBOL_ACCESSIBILITY_PROTECTED;
	}
	if (_tmp0_) {
		result = TRUE;
		return result;
	}
	result = FALSE;
	return result;
}

static gboolean
bala_gir_writer_is_visibility (BalaGIRWriter* self,
                               BalaSymbol* sym)
{
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	result = bala_code_node_get_attribute_bool ((BalaCodeNode*) sym, "GIR", "visible", TRUE);
	return result;
}

static gboolean
bala_gir_writer_has_namespace (BalaGIRWriter* self,
                               BalaSymbol* sym)
{
	gboolean _tmp0_ = FALSE;
	BalaSymbol* _tmp1_;
	BalaSymbol* _tmp2_;
	BalaSourceReference* _tmp7_;
	BalaSourceReference* _tmp8_;
	const gchar* _tmp9_;
	const gchar* _tmp10_;
	gchar* _tmp11_;
	gchar* _tmp12_;
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	_tmp1_ = bala_symbol_get_parent_symbol (sym);
	_tmp2_ = _tmp1_;
	if (!G_TYPE_CHECK_INSTANCE_TYPE (_tmp2_, BALA_TYPE_NAMESPACE)) {
		_tmp0_ = TRUE;
	} else {
		BalaSymbol* _tmp3_;
		BalaSymbol* _tmp4_;
		const gchar* _tmp5_;
		const gchar* _tmp6_;
		_tmp3_ = bala_symbol_get_parent_symbol (sym);
		_tmp4_ = _tmp3_;
		_tmp5_ = bala_symbol_get_name (_tmp4_);
		_tmp6_ = _tmp5_;
		_tmp0_ = _tmp6_ != NULL;
	}
	if (_tmp0_) {
		result = TRUE;
		return result;
	}
	_tmp7_ = bala_code_node_get_source_reference ((BalaCodeNode*) sym);
	_tmp8_ = _tmp7_;
	_tmp9_ = bala_symbol_get_name (sym);
	_tmp10_ = _tmp9_;
	_tmp11_ = g_strdup_printf ("`%s' must be part of namespace to be included in GIR", _tmp10_);
	_tmp12_ = _tmp11_;
	bala_report_warning (_tmp8_, _tmp12_);
	_g_free0 (_tmp12_);
	result = FALSE;
	return result;
}

BalaGIRWriter*
bala_gir_writer_construct (GType object_type)
{
	BalaGIRWriter* self = NULL;
	self = (BalaGIRWriter*) bala_code_visitor_construct (object_type);
	return self;
}

BalaGIRWriter*
bala_gir_writer_new (void)
{
	return bala_gir_writer_construct (BALA_TYPE_GIR_WRITER);
}

static void
bala_gir_writer_gir_namespace_init (BalaGIRWriterGIRNamespace *self,
                                    const gchar* ns,
                                    const gchar* version)
{
	gchar* _tmp0_;
	gchar* _tmp1_;
	g_return_if_fail (ns != NULL);
	g_return_if_fail (version != NULL);
	memset (self, 0, sizeof (BalaGIRWriterGIRNamespace));
	_tmp0_ = g_strdup (ns);
	_g_free0 ((*self).ns);
	(*self).ns = _tmp0_;
	_tmp1_ = g_strdup (version);
	_g_free0 ((*self).version);
	(*self).version = _tmp1_;
}

static gboolean
bala_gir_writer_gir_namespace_equal (BalaGIRWriterGIRNamespace *self,
                                     BalaGIRWriterGIRNamespace* g)
{
	gboolean _tmp0_ = FALSE;
	const gchar* _tmp1_;
	BalaGIRWriterGIRNamespace _tmp2_;
	const gchar* _tmp3_;
	gboolean result = FALSE;
	g_return_val_if_fail (g != NULL, FALSE);
	_tmp1_ = (*self).ns;
	_tmp2_ = *g;
	_tmp3_ = _tmp2_.ns;
	if (g_strcmp0 (_tmp1_, _tmp3_) == 0) {
		const gchar* _tmp4_;
		BalaGIRWriterGIRNamespace _tmp5_;
		const gchar* _tmp6_;
		_tmp4_ = (*self).version;
		_tmp5_ = *g;
		_tmp6_ = _tmp5_.version;
		_tmp0_ = g_strcmp0 (_tmp4_, _tmp6_) == 0;
	} else {
		_tmp0_ = FALSE;
	}
	result = _tmp0_;
	return result;
}

static void
bala_gir_writer_gir_namespace_copy (const BalaGIRWriterGIRNamespace* self,
                                    BalaGIRWriterGIRNamespace* dest)
{
	const gchar* _tmp0_;
	gchar* _tmp1_;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	_tmp0_ = (*self).ns;
	_tmp1_ = g_strdup (_tmp0_);
	_g_free0 ((*dest).ns);
	(*dest).ns = _tmp1_;
	_tmp2_ = (*self).version;
	_tmp3_ = g_strdup (_tmp2_);
	_g_free0 ((*dest).version);
	(*dest).version = _tmp3_;
}

static void
bala_gir_writer_gir_namespace_destroy (BalaGIRWriterGIRNamespace* self)
{
	_g_free0 ((*self).ns);
	_g_free0 ((*self).version);
}

static BalaGIRWriterGIRNamespace*
bala_gir_writer_gir_namespace_dup (const BalaGIRWriterGIRNamespace* self)
{
	BalaGIRWriterGIRNamespace* dup;
	dup = g_new0 (BalaGIRWriterGIRNamespace, 1);
	bala_gir_writer_gir_namespace_copy (self, dup);
	return dup;
}

static void
bala_gir_writer_gir_namespace_free (BalaGIRWriterGIRNamespace* self)
{
	bala_gir_writer_gir_namespace_destroy (self);
	g_free (self);
}

static GType
bala_gir_writer_gir_namespace_get_type_once (void)
{
	GType bala_gir_writer_gir_namespace_type_id;
	bala_gir_writer_gir_namespace_type_id = g_boxed_type_register_static ("BalaGIRWriterGIRNamespace", (GBoxedCopyFunc) bala_gir_writer_gir_namespace_dup, (GBoxedFreeFunc) bala_gir_writer_gir_namespace_free);
	return bala_gir_writer_gir_namespace_type_id;
}

static GType
bala_gir_writer_gir_namespace_get_type (void)
{
	static volatile gsize bala_gir_writer_gir_namespace_type_id__volatile = 0;
	if (g_once_init_enter (&bala_gir_writer_gir_namespace_type_id__volatile)) {
		GType bala_gir_writer_gir_namespace_type_id;
		bala_gir_writer_gir_namespace_type_id = bala_gir_writer_gir_namespace_get_type_once ();
		g_once_init_leave (&bala_gir_writer_gir_namespace_type_id__volatile, bala_gir_writer_gir_namespace_type_id);
	}
	return bala_gir_writer_gir_namespace_type_id__volatile;
}

static void
bala_gir_writer_class_init (BalaGIRWriterClass * klass,
                            gpointer klass_data)
{
	bala_gir_writer_parent_class = g_type_class_peek_parent (klass);
	((BalaCodeVisitorClass *) klass)->finalize = bala_gir_writer_finalize;
	g_type_class_adjust_private_offset (klass, &BalaGIRWriter_private_offset);
	((BalaGIRWriterClass *) klass)->get_interface_comment = (gchar* (*) (BalaGIRWriter*, BalaInterface*)) bala_gir_writer_real_get_interface_comment;
	((BalaGIRWriterClass *) klass)->get_struct_comment = (gchar* (*) (BalaGIRWriter*, BalaStruct*)) bala_gir_writer_real_get_struct_comment;
	((BalaGIRWriterClass *) klass)->get_enum_comment = (gchar* (*) (BalaGIRWriter*, BalaEnum*)) bala_gir_writer_real_get_enum_comment;
	((BalaGIRWriterClass *) klass)->get_class_comment = (gchar* (*) (BalaGIRWriter*, BalaClass*)) bala_gir_writer_real_get_class_comment;
	((BalaGIRWriterClass *) klass)->get_error_code_comment = (gchar* (*) (BalaGIRWriter*, BalaErrorCode*)) bala_gir_writer_real_get_error_code_comment;
	((BalaGIRWriterClass *) klass)->get_enum_value_comment = (gchar* (*) (BalaGIRWriter*, BalaEnumValue*)) bala_gir_writer_real_get_enum_value_comment;
	((BalaGIRWriterClass *) klass)->get_constant_comment = (gchar* (*) (BalaGIRWriter*, BalaConstant*)) bala_gir_writer_real_get_constant_comment;
	((BalaGIRWriterClass *) klass)->get_error_domain_comment = (gchar* (*) (BalaGIRWriter*, BalaErrorDomain*)) bala_gir_writer_real_get_error_domain_comment;
	((BalaGIRWriterClass *) klass)->get_field_comment = (gchar* (*) (BalaGIRWriter*, BalaField*)) bala_gir_writer_real_get_field_comment;
	((BalaGIRWriterClass *) klass)->get_delegate_comment = (gchar* (*) (BalaGIRWriter*, BalaDelegate*)) bala_gir_writer_real_get_delegate_comment;
	((BalaGIRWriterClass *) klass)->get_method_comment = (gchar* (*) (BalaGIRWriter*, BalaMethod*)) bala_gir_writer_real_get_method_comment;
	((BalaGIRWriterClass *) klass)->get_property_comment = (gchar* (*) (BalaGIRWriter*, BalaProperty*)) bala_gir_writer_real_get_property_comment;
	((BalaGIRWriterClass *) klass)->get_delegate_return_comment = (gchar* (*) (BalaGIRWriter*, BalaDelegate*)) bala_gir_writer_real_get_delegate_return_comment;
	((BalaGIRWriterClass *) klass)->get_signal_return_comment = (gchar* (*) (BalaGIRWriter*, BalaSignal*)) bala_gir_writer_real_get_signal_return_comment;
	((BalaGIRWriterClass *) klass)->get_method_return_comment = (gchar* (*) (BalaGIRWriter*, BalaMethod*)) bala_gir_writer_real_get_method_return_comment;
	((BalaGIRWriterClass *) klass)->get_signal_comment = (gchar* (*) (BalaGIRWriter*, BalaSignal*)) bala_gir_writer_real_get_signal_comment;
	((BalaGIRWriterClass *) klass)->get_parameter_comment = (gchar* (*) (BalaGIRWriter*, BalaParameter*)) bala_gir_writer_real_get_parameter_comment;
	((BalaCodeVisitorClass *) klass)->visit_source_file = (void (*) (BalaCodeVisitor*, BalaSourceFile*)) bala_gir_writer_real_visit_source_file;
	((BalaCodeVisitorClass *) klass)->visit_namespace = (void (*) (BalaCodeVisitor*, BalaNamespace*)) bala_gir_writer_real_visit_namespace;
	((BalaCodeVisitorClass *) klass)->visit_class = (void (*) (BalaCodeVisitor*, BalaClass*)) bala_gir_writer_real_visit_class;
	((BalaCodeVisitorClass *) klass)->visit_struct = (void (*) (BalaCodeVisitor*, BalaStruct*)) bala_gir_writer_real_visit_struct;
	((BalaCodeVisitorClass *) klass)->visit_interface = (void (*) (BalaCodeVisitor*, BalaInterface*)) bala_gir_writer_real_visit_interface;
	((BalaCodeVisitorClass *) klass)->visit_enum = (void (*) (BalaCodeVisitor*, BalaEnum*)) bala_gir_writer_real_visit_enum;
	((BalaCodeVisitorClass *) klass)->visit_enum_value = (void (*) (BalaCodeVisitor*, BalaEnumValue*)) bala_gir_writer_real_visit_enum_value;
	((BalaCodeVisitorClass *) klass)->visit_error_domain = (void (*) (BalaCodeVisitor*, BalaErrorDomain*)) bala_gir_writer_real_visit_error_domain;
	((BalaCodeVisitorClass *) klass)->visit_error_code = (void (*) (BalaCodeVisitor*, BalaErrorCode*)) bala_gir_writer_real_visit_error_code;
	((BalaCodeVisitorClass *) klass)->visit_constant = (void (*) (BalaCodeVisitor*, BalaConstant*)) bala_gir_writer_real_visit_constant;
	((BalaCodeVisitorClass *) klass)->visit_field = (void (*) (BalaCodeVisitor*, BalaField*)) bala_gir_writer_real_visit_field;
	((BalaCodeVisitorClass *) klass)->visit_delegate = (void (*) (BalaCodeVisitor*, BalaDelegate*)) bala_gir_writer_real_visit_delegate;
	((BalaCodeVisitorClass *) klass)->visit_method = (void (*) (BalaCodeVisitor*, BalaMethod*)) bala_gir_writer_real_visit_method;
	((BalaCodeVisitorClass *) klass)->visit_creation_method = (void (*) (BalaCodeVisitor*, BalaCreationMethod*)) bala_gir_writer_real_visit_creation_method;
	((BalaCodeVisitorClass *) klass)->visit_property = (void (*) (BalaCodeVisitor*, BalaProperty*)) bala_gir_writer_real_visit_property;
	((BalaCodeVisitorClass *) klass)->visit_signal = (void (*) (BalaCodeVisitor*, BalaSignal*)) bala_gir_writer_real_visit_signal;
}

static void
bala_gir_writer_instance_init (BalaGIRWriter * self,
                               gpointer klass)
{
	GString* _tmp0_;
	GHashFunc _tmp1_;
	GEqualFunc _tmp2_;
	BalaHashSet* _tmp3_;
	GHashFunc _tmp4_;
	GEqualFunc _tmp5_;
	BalaHashSet* _tmp6_;
	GEqualFunc _tmp7_;
	BalaArrayList* _tmp8_;
	GEqualFunc _tmp9_;
	BalaArrayList* _tmp10_;
	BalaArrayList* _tmp11_;
	self->priv = bala_gir_writer_get_instance_private (self);
	_tmp0_ = g_string_new ("");
	self->priv->buffer = _tmp0_;
	_tmp1_ = g_direct_hash;
	_tmp2_ = g_direct_equal;
	_tmp3_ = bala_hash_set_new (BALA_TYPE_NAMESPACE, (GBoxedCopyFunc) bala_code_node_ref, (GDestroyNotify) bala_code_node_unref, _tmp1_, _tmp2_);
	self->priv->unannotated_namespaces = _tmp3_;
	_tmp4_ = g_direct_hash;
	_tmp5_ = g_direct_equal;
	_tmp6_ = bala_hash_set_new (BALA_TYPE_NAMESPACE, (GBoxedCopyFunc) bala_code_node_ref, (GDestroyNotify) bala_code_node_unref, _tmp4_, _tmp5_);
	self->priv->our_namespaces = _tmp6_;
	_tmp7_ = g_direct_equal;
	_tmp8_ = bala_array_list_new (BALA_TYPE_SYMBOL, (GBoxedCopyFunc) bala_code_node_ref, (GDestroyNotify) bala_code_node_unref, _tmp7_);
	self->priv->hierarchy = _tmp8_;
	_tmp9_ = g_direct_equal;
	_tmp10_ = bala_array_list_new (BALA_TYPE_CODE_NODE, (GBoxedCopyFunc) bala_code_node_ref, (GDestroyNotify) bala_code_node_unref, _tmp9_);
	self->priv->deferred = _tmp10_;
	_tmp11_ = bala_array_list_new (BALA_GIR_WRITER_TYPE_GIR_NAMESPACE, (GBoxedCopyFunc) bala_gir_writer_gir_namespace_dup, (GDestroyNotify) bala_gir_writer_gir_namespace_free, (GEqualFunc) bala_gir_writer_gir_namespace_equal);
	self->priv->externals = _tmp11_;
}

static void
bala_gir_writer_finalize (BalaCodeVisitor * obj)
{
	BalaGIRWriter * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, BALA_TYPE_GIR_WRITER, BalaGIRWriter);
	_bala_code_context_unref0 (self->priv->context);
	_g_free0 (self->priv->directory);
	_g_free0 (self->priv->gir_namespace);
	_g_free0 (self->priv->gir_version);
	_g_free0 (self->priv->gir_shared_library);
	_g_string_free0 (self->priv->buffer);
	_fclose0 (self->priv->stream);
	_bala_iterable_unref0 (self->priv->unannotated_namespaces);
	_bala_iterable_unref0 (self->priv->our_namespaces);
	_bala_iterable_unref0 (self->priv->hierarchy);
	_bala_iterable_unref0 (self->priv->deferred);
	_bala_code_node_unref0 (self->priv->gobject_type);
	_bala_code_node_unref0 (self->priv->ginitiallyunowned_type);
	_bala_code_node_unref0 (self->priv->gtypeinterface_type);
	_bala_code_node_unref0 (self->priv->gtypeinstance_type);
	_bala_code_node_unref0 (self->priv->gtype_type);
	_bala_iterable_unref0 (self->priv->externals);
	BALA_CODE_VISITOR_CLASS (bala_gir_writer_parent_class)->finalize (obj);
}

/**
 * Code visitor generating .gir file for the public interface.
 */
static GType
bala_gir_writer_get_type_once (void)
{
	static const GTypeInfo g_define_type_info = { sizeof (BalaGIRWriterClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) bala_gir_writer_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (BalaGIRWriter), 0, (GInstanceInitFunc) bala_gir_writer_instance_init, NULL };
	GType bala_gir_writer_type_id;
	bala_gir_writer_type_id = g_type_register_static (BALA_TYPE_CODE_VISITOR, "BalaGIRWriter", &g_define_type_info, 0);
	BalaGIRWriter_private_offset = g_type_add_instance_private (bala_gir_writer_type_id, sizeof (BalaGIRWriterPrivate));
	return bala_gir_writer_type_id;
}

GType
bala_gir_writer_get_type (void)
{
	static volatile gsize bala_gir_writer_type_id__volatile = 0;
	if (g_once_init_enter (&bala_gir_writer_type_id__volatile)) {
		GType bala_gir_writer_type_id;
		bala_gir_writer_type_id = bala_gir_writer_get_type_once ();
		g_once_init_leave (&bala_gir_writer_type_id__volatile, bala_gir_writer_type_id);
	}
	return bala_gir_writer_type_id__volatile;
}

static void
_bala_array_destroy (gpointer array,
                     gint array_length,
                     GDestroyNotify destroy_func)
{
	if ((array != NULL) && (destroy_func != NULL)) {
		gint i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}

static void
_bala_array_free (gpointer array,
                  gint array_length,
                  GDestroyNotify destroy_func)
{
	_bala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}

static gint
_bala_array_length (gpointer array)
{
	gint length;
	length = 0;
	if (array) {
		while (((gpointer*) array)[length]) {
			length++;
		}
	}
	return length;
}

